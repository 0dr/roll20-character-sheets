<!-- Set up the Tabs -->
<div class="tab-section">
    <input type="radio" class="tab tab1" name="attr_core-tab" value="1" title="Angel" checked="checked"/> 
    <span class="tab tab1" style='line-height: 40px;'>Angel</span>
    <input type="radio" class="tab tab2" name="attr_core-tab" value="2" title="Demon" /> 
    <span class="tab tab2" style='line-height: 40px;'>Demon</span>
</div>
<div class="main-grid">
	<div class="header-grid">
        <!-- In Nomine logo text -->
        <div class="logo vertical-container" style="grid-column-start:1; grid-row-start:span 2">
            <span class="serif-font vertical-center">In Nomine</span>
        </div>
        <div class="header-entry" style="grid-column-start:2; grid-row-start:1">
            <span class="vertical-center">Name</span>
            <input class="vertical-center" name="attr_name" type="text" title="@{name}"/>
        </div>
        <div class="header-entry" style="grid-column-start:2; grid-row-start:2;">
            <!-- These hidden checkboxes will hide/show the angel/demon content. -->
            <input type="checkbox" class="tab1 hidden" name="attr_core-tab" value="1" title="Angel" checked="checked"/>
            <input type="checkbox" class="tab2 hidden" name="attr_core-tab" value="2" title="Demon" />
            <span class="angel-section vertical-center">Archangel</span>
            <select class="angel-section vertical-center" name="attr_archangel" title="@{archangel}">
                <option value="Blandine">Blandine</option>
                <option value="David">David</option>
                <option value="Dominic">Dominic</option>
                <option value="Eli">Eli</option>
                <option value="Gabriel">Gabriel</option>
                <option value="Janus">Janus</option>
                <option value="Jean">Jean</option>
                <option value="Jordi">Jordi</option>
                <option value="Laurence">Laurence</option>
                <option value="Marc">Marc</option>
                <option value="Michael">Michael</option>
                <option value="Novalis">Novalis</option>
                <option value="Yves">Yves</option>
            </select>
            <span class="demon-section vertical-center">Prince</span>
            <select class="demon-section vertical-center" name="attr_prince" title="@{prince}">
                <option value="Andrealphus">Andrealphus</option>
                <option value="Asmodeus">Asmodeus</option>
                <option value="Baal">Baal</option>
                <option value="Beleth">Beleth</option>
                <option value="Belial">Belial</option>
                <option value="Haagenti">Haagenti</option>
                <option value="Kobal">Kobal</option>
                <option value="Kronos">Kronos</option>
                <option value="Lilith">Lilith</option>
                <option value="Malphas">Malphas</option>
                <option value="Nybbas">Nybbas</option>
                <option value="Saminga">Saminga</option>
                <option value="Valefor">Valefor</option>
                <option value="Vapula">Vapula</option>
            </select>
        </div>
        <div class="header-entry" style="grid-column-start:3; grid-row-start:1">
            <!-- These hidden checkboxes will hide/show the angel/demon content. -->
            <input type="checkbox" class="tab1 hidden" name="attr_core-tab" value="1" title="Angel" checked="checked"/>
            <input type="checkbox" class="tab2 hidden" name="attr_core-tab" value="2" title="Demon" />
            <span class="angel-section vertical-center">Choir</span>
            <select class="angel-section vertical-center" name="attr_choir" title="@{choir}">
                <option value="Cherubim">Cherubim</option>
                <option value="Elohim">Elohim</option>
                <option value="Grigori">Grigori</option>
                <option value="Kyriotates">Kyriotates</option>
                <option value="Malakim">Malakim</option>
                <option value="Mercurians">Mercurians</option>
                <option value="Ofanim">Ofanim</option>
                <option value="Seraphim">Seraphim</option>
            </select>
            <span class="demon-section vertical-center">Band</span>
            <select class="demon-section vertical-center" name="attr_band" title="@{band}">
                <option value="Balseraphs">Balseraphs</option>
                <option value="Djinn">Djinn</option>
                <option value="Calabim">Calabim</option>
                <option value="Habbalah">Habbalah</option>
                <option value="Impudites">Impudites</option>
                <option value="Lilim">Lilim</option>
                <option value="Shedim">Shedim</option>
            </select>
        </div>
        <div class="header-entry" style="grid-column-start:3; grid-row-start:2">
            <span class="vertical-center">Word</span>
            <input class="vertical-center" name="attr_word" type="text" title="@{word}"/>
        </div>
        <div class="header-entry" style="grid-column-start:4; grid-row-start:span 2">
            <span style="justify-self:center;">Essence</span>
            <input class="center-input" name="attr_essence" type="text" style="width:50px;justify-self:center;" title="@{essence}"/>
        </div>
    </div>
    <!-- Core Stats -->
    <div class="attributes-grid">
        <!--============== Corporeal ==============-->
        <div class="corporeal-grid attribute-padding" style="grid-column:1/6;grid-row:1/4" id="corporeal">
            <div class="core-stats-header" style="grid-column:1/7;grid-row:1/2">
                <span class="serif-font">Corporeal</span>
                <input name="attr_corporeal" type="text" title="@{corporeal}"/>
            </div>
            <!-- Strength and Agility Characteristics -->
            <div style="grid-column:1/4;grid-row:2/4;">
                <input class="center-input characteristic" name="attr_strength" type="text" title="@{strength}"/>
                <p>Strength</p>
            </div>
            <div style="grid-column:4/7;grid-row:2/4">
                <input class="center-input characteristic" name="attr_agility" type="text" title="@{agility}"/>
                <p>Agility</p>
            </div>
            <!-- Vessel 1-->
            <div style="grid-column:1/5;grid-row:4/5">
                <input name="attr_vessel1" type="text" title="@{vessel1}"/>
                <p>Vessel</p>
            </div>
            <div style="grid-column:5/6;grid-row:4/5">
                <input name="attr_body1" type="text" title="@{body1}"/>
                <p>Body</p>
            </div>
            <div style="grid-column:6/7;grid-row:4/5">
                <input name="attr_vessel-hits1" type="text" title="@{vessel-hits1}"/>
                <p>Hits</p>
            </div>
            <!-- Vessel 2-->
            <div style="grid-column:1/5;grid-row:5/6">
                <input name="attr_vessel2" type="text" title="@{vessel2}"/>
                <p>Vessel</p>
            </div>
            <div style="grid-column:5/6;grid-row:5/6">
                <input name="attr_body2" type="text" title="@{body2}"/>
                <p>Body</p>
            </div>
            <div style="grid-column:6/7;grid-row:5/6">
                <input name="attr_vessel-hits2" type="text" title="@{vessel-hits2}"/>
                <p>Hits</p>
            </div>
            <!-- Vessel 3-->
            <div style="grid-column:1/5;grid-row:6/7">
                <input name="attr_vessel3" type="text" title="@{vessel3}"/>
                <p>Vessel</p>
            </div>
            <div style="grid-column:5/6;grid-row:6/7">
                <input name="attr_body3" type="text" title="@{body3}"/>
                <p>Body</p>
            </div>
            <div style="grid-column:6/7;grid-row:6/7">
                <input name="attr_vessel-hits3" type="text" title="@{vessel-hits3}"/>
                <p>Hits</p>
            </div>
        </div>
        <!-- Corporeal Textarea -->
        <div class="attribute-padding" style="grid-column:1/6;grid-row-start:4">
            <textarea name="attr_box1" class="large-textarea" title="@{box1}"></textarea>
        </div>
        <!--============== Ethereal ==============-->
        <div class="ethereal-grid attribute-padding" style="grid-column:6/11;grid-row:1/4" id="ethereal">
            <div class="core-stats-header" style="grid-column-start:span 6;grid-row:1/2">
                <span class="serif-font">Ethereal</span>
                <input name="attr_ethereal" type="text" title="@{ethereal}"/>
            </div>
            <!-- Intelligence and Precision Characteristics -->
            <div style="grid-column:1/4;grid-row:2/4;">
                <input class="center-input characteristic" name="attr_intelligence" type="text" title="@{intelligence}"/>
                <p>Intelligence</p>
            </div>
            <div style="grid-column:4/7;grid-row:2/4;">
                <input class="center-input characteristic" name="attr_precision" type="text" title="@{precision}"/>
                <p>Precision</p>
            </div>
            <!-- Mind and Hits -->
            <div style="grid-column:2/3;grid-row:4/5;">
                <input name="attr_mind" type="text" title="@{mind}"/>
                <p>Mind</p>
            </div>
            <div style="grid-column:4/5;grid-row:4/5;">
                <input name="attr_mind-hits" type="text" title="@{mind-hits}"/>
                <p>Hits</p>
            </div>
        </div>
        <!-- Ethereal Textarea -->
        <div class="attribute-padding" style="grid-column:6/11;grid-row-start:4">
            <textarea name="attr_box2" class="large-textarea" title="@{box2}"></textarea>
        </div>
        <!--============== Dissonance ==============-->
        <div class="dissonance" style="grid-column:10/12;grid-row-start:3">
            <input class="center-input" name="attr_dissonance" type="text" title="@{dissonance}"/>
            <p>Dissonance</p>
        </div>
        <!--============== Celestial ==============-->

        <div class="celestial-grid attribute-padding" style="grid-column:11/16;grid-row:1/4" id="celestial">
            <div class="core-stats-header" style="grid-column-start:span 6;grid-row:1/2">
                <span class="serif-font">Celestial</span>
                <input name="attr_celestial" type="text" title="@{celestial}"/>
            </div>
            <!-- Intelligence and Precision Characteristics -->
            <div style="grid-column:1/4;grid-row:2/4;">
                <input class="center-input characteristic" name="attr_will" type="text" title="@{will}"/>
                <p>Will</p>
            </div>
            <div style="grid-column:4/7;grid-row:2/4;">
                <input class="center-input characteristic" name="attr_perception" type="text" title="@{perception}"/>
                <p>Perception</p>
            </div>
            <!-- Mind and Hits -->
            <div style="grid-column:3/4;grid-row:4/5;">
                <input name="attr_soul" type="text" title="@{soul}"/>
                <p>Soul</p>
            </div>
            <div style="grid-column:5/6;grid-row:4/5;">
                <input name="attr_soul-hits" type="text" title="@{soul-hits}"/>
                <p>Hits</p>
            </div>
        </div>
        <!-- Celestial Textarea -->
        <div class="attribute-padding"style="grid-column:11/16;grid-row-start:4">
            <textarea name="attr_box3" class="large-textarea" title="@{box3}"></textarea>
        </div>
        <!-- Other boxes -->
        <div class="attribute-padding" style="grid-column:16/21;grid-row-start:span 2" id="boxes">
            <p>Attunements & Distinctions</p>
            <textarea name="attr_attunements" class="large-textarea" title="@{attunements}" />
            <p>Discord</p>
            <textarea name="attr_discord" class="large-textarea" title="@{discord}" />
        </div>
    </div>
</div>
<!--
    This contains a roll button which I will want to implement later.
<div class="section-demon">
    <button name="roll_action" type="roll" value="&amp;{template:default} {{name=?{Description}}} {{Target attribute=[[(2d6)&lt;?{Attribute}]]}} {{Digito Verificador=[[1d6]]}}"></button>
</div>-->
<div class="footer" /> 

<!-- Sheet workers -->
<script type="text/worker">
    // This sheetworker serves to migrate attributes from any old sheets to the new attribute names.
on("sheet:opened", function() {
    console.log("Checking if attribute migration needed.");
    // This checks to see if any of these 5 attributes are in use, which should be sufficient to tell whether the sheet was used before overhaul.
    getAttrs(["nome","Arcanjo","Coro","Corporeo", "Essencia"], function(values) {
        // Gets the attribute if it exists, uses a default of 0 if not.
        let name = values.nome||0;
        let archangel = values.Arcanjo||0;
        let choir = values.Coro||0;
        let corporeal = values.Corporeo||0;
        let essence = values.Essencia||0;
        // If any of these attributes have a value from an old attribute name, then attributes are migrated.
        if(name != 0 || archangel !=0 || choir != 0 || corporeal != 0 || essence != 0) {
            console.log("Attributes need to be migrated");
            // The names of some choirs are different in Portuguese. Archangel names are identical.
            switch (choir) {
                case "Serafim":
                    choir = "Seraphim";
                    break;
                case "Querubim":
                    choir = "Cherubim";
                    break;
                case "Kyriotetes":
                    choir = "Kyriotates";
                    break;
                case "Mercurianos":
                    choir = "Mercurians";
                    break;
                default:
                    break;
            }
            getAttrs(["Coro","Palavra","Veste1","Veste2","Veste3","Corpo1","Corpo2","Corpo3","Força","Agilidade","Etero","Pontos","Mente","Disonacia","Inteligencia","Precisao","cPontos","Alma","Vontade","Precepcao","Sintonias","Discordias"], function(values) {
                // Set all of the attributes from the old sheet
                // First the 5 test attributes which have already been called, then the rest
                setAttrs({
                    "name":name,
                    "archangel":archangel,
                    "choir":choir,
                    "essence":essence,
                    "corporeal":corporeal, 
                    "word":values.Palavra,
                    "vessel1":values.Veste1,
                    "vessel2":values.Veste2,
                    "vessel3":values.Veste3,
                    "body1":values.Corpo1,
                    "body2":values.Corpo2,
                    "body3":values.Corpo3,
                    "strength":values.Força,
                    "agility":values.Agilidade,
                    "ethereal":values.Etero,
                    "mind-hits":values.Pontos,
                    "mind":values.Mente,
                    "dissonance":values.Disonacia,
                    "intelligence":values.Inteligencia,
                    "precision":values.Precisao,
                    "soul-hits":values.cPontos,
                    "soul":values.Alma,
                    "will":values.Vontade,
                    "perception":values.Precepcao,
                    "attunements":values.Sintonias,
                    "discord":values.Discordias
                });
                console.log("Finished migration of attributes.");
                // Set the key old attribute names of the sheet to 0 to prevent the sheetworker from running again.
                setAttrs({
                    "nome":"0",
                    "Arcanjo":0,
                    "Coro":0,
                    "Corporeo":0,
                    "Essencia":0
                });
            });
        }
        else {
            console.log("No attributes need to be migrated.");
        }
    });
});
</script>
