<!DOCTYPE html>

<script type="text/worker">
	const tabs = [
		"character",
		"combat",
		"magic",
		"notes",
		"options"
	];
	tabs.forEach(tab => {
		on(`clicked:${tab}`, function() {
			var output = {};

			output["sheetTab"] = tab;

			setAttrs(output, {silent: true});
		});
	});

	on("change:character_level", function(eventInfo) {
		var output = {};
		var level = 1;
		if (eventInfo.newValue != undefined || eventInfo.newValue != "")
			level = parseInt(eventInfo.newValue);
		var new_level = level < 1 ? 1 : level;
		const capped_level = new_level > 12 ? 12 : new_level;
		const grade_ranked = Math.floor((capped_level) / 4);

		const grade = new_level == 89 ? "platinum" : new_level > 8 ? "gold" : new_level > 4 ? "silver" : "copper";
		const total_attributes = 7 + grade_ranked;

		output["character_level"] = new_level;
		output["adventuring_grade"] = grade;
		output["total_attributes"] = total_attributes;
		output["mastery_bonus"] = 2 + grade_ranked;

		setAttrs(output, {silent: false});

		getAttrs(["armor_hp", "unarmored_toughness", "added_hp", "attunement_amount", "added_mp", "added_resolve"], function(v) {
			var output = {};

			const armor_hp = parseInt(v["armor_hp"]);
			const unarmored_toughness = v["unarmored_toughness"];
			const added_hp = parseInt(v["added_hp"]);
			const attunement_amount = parseInt(v["attunement_amount"]);
			const added_mp = parseInt(v["added_mp"]);
			const added_resolve = parseInt(v["added_resolve"]);

			var hp_max = 15 + (capped_level - 1) * 2 + added_hp + armor_hp;
			if (unarmored_toughness == "on")
				hp_max = 20 + (capped_level - 1) * 3 + added_hp;

			const mp_max = 15 + (capped_level - 1) * 2 + added_mp + 10 * attunement_amount;
			const resolve_max = 30 + (capped_level - 1) * 4 + added_resolve;

			output["hp_max"] = hp_max;
			output["mp_max"] = mp_max;
			output["resolve_max"] = resolve_max;

			setAttrs(output, {silent: true});
		});


		getAttrs(["added_quirk", "quirk_total"], function(v) {
			var output = {};
			const quirk_total = parseInt(v["quirk_total"]);
			const quirk_max = 2 + grade_ranked + parseInt(v["added_quirk"]);

			output["quirk_points_label"] = `${quirk_total}/${quirk_max}`;

			setAttrs(output, {silent: true});
		});
	});

	on("change:added_resolve", function(eventInfo) {
		getAttrs(["added_resolve", "character_level"], function(v) {
			var output = {};

			const character_level = parseInt(v["character_level"]);
			const capped_level = character_level > 12 ? 12 : character_level;

			const added_resolve = parseInt(v["added_resolve"]);
			const resolve_max = 30 + (capped_level - 1) * 4 + added_resolve;

			output["resolve_max"] = resolve_max;

			setAttrs(output, {silent: true});
		});
	});

	on("change:added_hp change:armor_hp change:unarmored_toughness", function(eventInfo) {
		getAttrs(["added_hp", "armor_hp", "unarmored_toughness", "character_level"], function(v) {
			var output = {};

			const character_level = parseInt(v["character_level"]);
			const capped_level = character_level > 12 ? 12 : character_level;

			const added_hp = parseInt(v["added_hp"]);
			const armor_hp = parseInt(v["armor_hp"]);
			const unarmored_toughness = v["unarmored_toughness"];

			var hp_max = 15 + (capped_level - 1) * 2 + added_hp + armor_hp;
			if (unarmored_toughness == "on")
				hp_max = 20 + (capped_level - 1) * 3 + added_hp;

			output["hp_max"] = hp_max;

			setAttrs(output, {silent: true});
		});
	});

	on("change:added_mp change:attunement_amount", function(eventInfo) {
		getAttrs(["added_mp", "attunement_amount", "character_level"], function(v) {
			var output = {};

			const character_level = parseInt(v["character_level"]);
			const capped_level = character_level > 12 ? 12 : character_level;

			const added_mp = parseInt(v["added_mp"]);
			const attunement_amount = parseInt(v["attunement_amount"]);
			const mp_max = 15 + (capped_level - 1) * 2 + added_mp + 10 * attunement_amount;

			output["mp_max"] = mp_max;

			setAttrs(output, {silent: true});
		});
	});

	on("change:repeating_quirks", function(eventInfo) {
		getSectionIDs("quirks", function(ids) {
			var attrs_to_get = ids.map(id => `repeating_quirks_${id}_quirk_name`).concat(ids.map(id => `repeating_quirks_${id}_quirk_level`));

			getAttrs(attrs_to_get, function(v) {
				var output = {};
				var quirk_value_pair = "";
				var total_quirk_points = 0;

				ids.forEach(id => {
					var quirkName = v[`repeating_quirks_${id}_quirk_name`];
					const quirkLevel = v[`repeating_quirks_${id}_quirk_level`];
					if (quirkName == undefined || quirkName == "")
						quirkName = "Unnamed Quirk";
					total_quirk_points += parseInt(quirkLevel);
					quirk_value_pair += `${quirkName} (Rank ${quirkLevel})\n`;
				});

				quirk_value_pair = quirk_value_pair.trimEnd();

				output["all_quirks"] = quirk_value_pair;
				output["quirk_total"] = total_quirk_points;
				setAttrs(output, {silent: false});
			});
		});
	});

	on("change:quirk_total", function(eventInfo) {
		getAttrs(["added_quirk", "character_level"], function(v) {
			var output = {};

			const character_level = parseInt(v["character_level"]);
			const capped_level = character_level > 12 ? 12 : character_level;
			const grade_ranked = Math.floor((capped_level + 1) / 4);

			const added_quirk = parseInt(v["added_quirk"]);
			const quirk_max = 2 + grade_ranked + added_quirk;

			output["quirk_points_label"] = `${eventInfo.newValue}/${quirk_max}`;

			setAttrs(output, {silent: true});
		});
	});

	on("change:strength change:mastery_bonus", function(eventInfo) {
		getAttrs(["strength", "mastery_bonus", "brute", "brute_bns", "endurance", "endurance_bns", "intimidation", "intimidation_bns"], function(v) {
			var output = {};

			const strength = parseInt(v["strength"]);

			const brute = v["brute"] == "on";
			const endurance = v["endurance"] == "on";
			const intimidation = v["intimidation"] == "on";

			const brute_bns = parseInt(v["brute_bns"]);
			const endurance_bns = parseInt(v["endurance_bns"]);
			const intimidation_bns = parseInt(v["intimidation_bns"]);

			const mastery_bonus = parseInt(v["mastery_bonus"]);

			const brute_total = strength + (brute ? mastery_bonus : 0) + brute_bns;
			const endurance_total = strength + (endurance ? mastery_bonus : 0) + endurance_bns;
			const intimidation_total = strength + (intimidation ? mastery_bonus : 0) + intimidation_bns;

			output["brute_total"] = brute_total;
			output["endurance_total"] = endurance_total;
			output["intimidation_total"] = intimidation_total;

			output["brute_total_label"] = `+${brute_total}`;
			output["endurance_total_label"] = `+${endurance_total}`;
			output["intimidation_total_label"] = `+${intimidation_total}`;

			setAttrs(output, {silent: true});
		});
	});

	on("change:brute change:brute_bns", function(eventInfo) {
		getAttrs(["strength", "mastery_bonus", "brute", "brute_bns"], function(v) {
			var output = {};

			const strength = parseInt(v["strength"]);

			const brute = v["brute"] == "on";
			const brute_bns = parseInt(v["brute_bns"]);

			const mastery_bonus = parseInt(v["mastery_bonus"]);

			const brute_total = strength + (brute ? mastery_bonus : 0) + brute_bns;

			output["brute_total"] = brute_total;
			output["brute_total_label"] = `+${brute_total}`;

			setAttrs(output, {silent: true});
		});
	});

	on("change:endurance change:endurance_bns", function(eventInfo) {
		getAttrs(["strength", "mastery_bonus", "endurance", "endurance_bns"], function(v) {
			var output = {};

			const strength = parseInt(v["strength"]);

			const endurance = v["endurance"] == "on";
			const endurance_bns = parseInt(v["endurance_bns"]);

			const mastery_bonus = parseInt(v["mastery_bonus"]);

			const endurance_total = strength + (endurance ? mastery_bonus : 0) + endurance_bns;

			output["endurance_total"] = endurance_total;
			output["endurance_total_label"] = `+${endurance_total}`;

			setAttrs(output, {silent: true});
		});
	});

	on("change:intimidation change:intimidation_bns", function(eventInfo) {
		getAttrs(["strength", "mastery_bonus", "intimidation", "intimidation_bns"], function(v) {
			var output = {};

			const strength = parseInt(v["strength"]);

			const intimidation = v["intimidation"] == "on";
			const intimidation_bns = parseInt(v["intimidation_bns"]);

			const mastery_bonus = parseInt(v["mastery_bonus"]);

			const intimidation_total = strength + (intimidation ? mastery_bonus : 0) + intimidation_bns;

			output["intimidation_total"] = intimidation_total;
			output["intimidation_total_label"] = `+${intimidation_total}`;

			setAttrs(output, {silent: true});
		});
	});

	on("change:agility change:mastery_bonus", function(eventInfo) {
		getAttrs(["agility", "mastery_bonus", "sports", "sports_bns", "thievery", "thievery_bns", "deception", "deception_bns"], function(v) {
			var output = {};

			const agility = parseInt(v["agility"]);

			const sports = v["sports"] == "on";
			const thievery = v["thievery"] == "on";
			const deception = v["deception"] == "on";

			const sports_bns = parseInt(v["sports_bns"]);
			const thievery_bns = parseInt(v["thievery_bns"]);
			const deception_bns = parseInt(v["deception_bns"]);

			const mastery_bonus = parseInt(v["mastery_bonus"]);

			const sports_total = agility + (sports ? mastery_bonus : 0) + sports_bns;
			const thievery_total = agility + (thievery ? mastery_bonus : 0) + thievery_bns;
			const deception_total = agility + (deception ? mastery_bonus : 0) + deception_bns;

			output["sports_total"] = sports_total;
			output["thievery_total"] = thievery_total;
			output["deception_total"] = deception_total;

			output["sports_total_label"] = `+${sports_total}`;
			output["thievery_total_label"] = `+${thievery_total}`;
			output["deception_total_label"] = `+${deception_total}`;

			setAttrs(output, {silent: true});
		});
	});

	on("change:sports change:sports_bns", function(eventInfo) {
		getAttrs(["agility", "mastery_bonus", "sports", "sports_bns"], function(v) {
			var output = {};

			const agility = parseInt(v["agility"]);

			const sports = v["sports"] == "on";
			const sports_bns = parseInt(v["sports_bns"]);

			const mastery_bonus = parseInt(v["mastery_bonus"]);

			const sports_total = agility + (sports ? mastery_bonus : 0) + sports_bns;

			output["sports_total"] = sports_total;
			output["sports_total_label"] = `+${sports_total}`;

			setAttrs(output, {silent: true});
		});
	});

	on("change:thievery change:thievery_bns", function(eventInfo) {
		getAttrs(["agility", "mastery_bonus", "thievery", "thievery_bns"], function(v) {
			var output = {};

			const agility = parseInt(v["agility"]);

			const thievery = v["thievery"] == "on";
			const thievery_bns = parseInt(v["thievery_bns"]);

			const mastery_bonus = parseInt(v["mastery_bonus"]);

			const thievery_total = agility + (thievery ? mastery_bonus : 0) + thievery_bns;

			output["thievery_total"] = thievery_total;
			output["thievery_total_label"] = `+${thievery_total}`;

			setAttrs(output, {silent: true});
		});
	});

	on("change:deception change:deception_bns", function(eventInfo) {
		getAttrs(["agility", "mastery_bonus", "deception", "deception_bns"], function(v) {
			var output = {};

			const agility = parseInt(v["agility"]);

			const deception = v["deception"] == "on";
			const deception_bns = parseInt(v["deception_bns"]);

			const mastery_bonus = parseInt(v["mastery_bonus"]);

			const deception_total = agility + (deception ? mastery_bonus : 0) + deception_bns;

			output["deception_total"] = deception_total;
			output["deception_total_label"] = `+${deception_total}`;

			setAttrs(output, {silent: true});
		});
	});

	on("change:awareness change:mastery_bonus", function(eventInfo) {
		getAttrs(["awareness", "mastery_bonus", "detect", "detect_bns", "information", "information_bns", "reason", "reason_bns"], function(v) {
			var output = {};

			const awareness = parseInt(v["awareness"]);

			const detect = v["detect"] == "on";
			const information = v["information"] == "on";
			const reason = v["reason"] == "on";

			const detect_bns = parseInt(v["detect_bns"]);
			const information_bns = parseInt(v["information_bns"]);
			const reason_bns = parseInt(v["reason_bns"]);

			const mastery_bonus = parseInt(v["mastery_bonus"]);

			const detect_total = awareness + (detect ? mastery_bonus : 0) + detect_bns;
			const information_total = awareness + (information ? mastery_bonus : 0) + information_bns;
			const reason_total = awareness + (reason ? mastery_bonus : 0) + reason_bns;

			output["detect_total"] = detect_total;
			output["information_total"] = information_total;
			output["reason_total"] = reason_total;

			output["detect_total_label"] = `+${detect_total}`;
			output["information_total_label"] = `+${information_total}`;
			output["reason_total_label"] = `+${reason_total}`;

			setAttrs(output, {silent: true});
		});
	});

	on("change:detect change:detect_bns", function(eventInfo) {
		getAttrs(["awareness", "mastery_bonus", "detect", "detect_bns"], function(v) {
			var output = {};

			const awareness = parseInt(v["awareness"]);

			const detect = v["detect"] == "on";
			const detect_bns = parseInt(v["detect_bns"]);

			const mastery_bonus = parseInt(v["mastery_bonus"]);

			const detect_total = awareness + (detect ? mastery_bonus : 0) + detect_bns;

			output["detect_total"] = detect_total;
			output["detect_total_label"] = `+${detect_total}`;

			setAttrs(output, {silent: true});
		});
	});

	on("change:information change:information_bns", function(eventInfo) {
		getAttrs(["awareness", "mastery_bonus", "information", "information_bns"], function(v) {
			var output = {};

			const awareness = parseInt(v["awareness"]);

			const information = v["information"] == "on";
			const information_bns = parseInt(v["information_bns"]);

			const mastery_bonus = parseInt(v["mastery_bonus"]);

			const information_total = awareness + (information ? mastery_bonus : 0) + information_bns;

			output["information_total"] = information_total;
			output["information_total_label"] = `+${information_total}`;

			setAttrs(output, {silent: true});
		});
	});

	on("change:reason change:reason_bns", function(eventInfo) {
		getAttrs(["awareness", "mastery_bonus", "reason", "reason_bns"], function(v) {
			var output = {};

			const awareness = parseInt(v["awareness"]);

			const reason = v["reason"] == "on";
			const reason_bns = parseInt(v["reason_bns"]);

			const mastery_bonus = parseInt(v["mastery_bonus"]);

			const reason_total = awareness + (reason ? mastery_bonus : 0) + reason_bns;

			output["reason_total"] = reason_total;
			output["reason_total_label"] = `+${reason_total}`;

			setAttrs(output, {silent: true});
		});
	});

	on("change:empathy change:mastery_bonus", function(eventInfo) {
		getAttrs(["empathy", "mastery_bonus", "psychology", "psychology_bns", "artistry", "artistry_bns", "charm", "charm_bns"], function(v) {
			var output = {};

			const empathy = parseInt(v["empathy"]);

			const psychology = v["psychology"] == "on";
			const artistry = v["artistry"] == "on";
			const charm = v["charm"] == "on";

			const psychology_bns = parseInt(v["psychology_bns"]);
			const artistry_bns = parseInt(v["artistry_bns"]);
			const charm_bns = parseInt(v["charm_bns"]);

			const mastery_bonus = parseInt(v["mastery_bonus"]);

			const psychology_total = empathy + (psychology ? mastery_bonus : 0) + psychology_bns;
			const artistry_total = empathy + (artistry ? mastery_bonus : 0) + artistry_bns;
			const charm_total = empathy + (charm ? mastery_bonus : 0) + charm_bns;

			output["psychology_total"] = psychology_total;
			output["artistry_total"] = artistry_total;
			output["charm_total"] = charm_total;

			output["psychology_total_label"] = `+${psychology_total}`;
			output["artistry_total_label"] = `+${artistry_total}`;
			output["charm_total_label"] = `+${charm_total}`;

			setAttrs(output, {silent: true});
		});
	});

	on("change:psychology change:psychology_bns", function(eventInfo) {
		getAttrs(["empathy", "mastery_bonus", "psychology", "psychology_bns"], function(v) {
			var output = {};

			const empathy = parseInt(v["empathy"]);

			const psychology = v["psychology"] == "on";
			const psychology_bns = parseInt(v["psychology_bns"]);

			const mastery_bonus = parseInt(v["mastery_bonus"]);

			const psychology_total = empathy + (psychology ? mastery_bonus : 0) + psychology_bns;

			output["psychology_total"] = psychology_total;
			output["psychology_total_label"] = `+${psychology_total}`;

			setAttrs(output, {silent: true});
		});
	});

	on("change:artistry change:artistry_bns", function(eventInfo) {
		getAttrs(["empathy", "mastery_bonus", "artistry", "artistry_bns"], function(v) {
			var output = {};

			const empathy = parseInt(v["empathy"]);

			const artistry = v["artistry"] == "on";
			const artistry_bns = parseInt(v["artistry_bns"]);

			const mastery_bonus = parseInt(v["mastery_bonus"]);

			const artistry_total = empathy + (artistry ? mastery_bonus : 0) + artistry_bns;

			output["artistry_total"] = artistry_total;
			output["artistry_total_label"] = `+${artistry_total}`;

			setAttrs(output, {silent: true});
		});
	});

	on("change:charm change:charm_bns", function(eventInfo) {
		getAttrs(["empathy", "mastery_bonus", "charm", "charm_bns"], function(v) {
			var output = {};

			const empathy = parseInt(v["empathy"]);

			const charm = v["charm"] == "on";
			const charm_bns = parseInt(v["charm_bns"]);

			const mastery_bonus = parseInt(v["mastery_bonus"]);

			const charm_total = empathy + (charm ? mastery_bonus : 0) + charm_bns;

			output["charm_total"] = charm_total;
			output["charm_total_label"] = `+${charm_total}`;

			setAttrs(output, {silent: true});
		});
	});

	/*
	Arcanist
	Chemist
	Climbing
	Impersonation

	Infiltration
	Mechanic
	Navigation
	Thaumaturgist

	Free Toolkit places
	*/
	on("change:mastery_bonus", function(eventInfo) {
		const mastery_bonus = parseInt(eventInfo.newValue);
		const kit_list = [
			"arcanist",
			"chemist",
			"climbing",
			"impersonation",
			"infiltration",
			"mechanic",
			"navigation",
			"thaumaturgist"
		];
		var attrs_to_get = kit_list.map(kit => `${kit}`).concat(kit_list.map(kit => `${kit}_bns`)).concat(kit_list.map(kit => `${kit}_quality`));
		getAttrs(attrs_to_get, function(v) {
			var output = {};

			for (let i = 0; i < kit_list.length; i++) {
				const kit = kit_list[i];
				const kit_mastered = v[`${kit}`] == "on";
				if (!kit_mastered)
					continue;
				const kit_bns = parseInt(v[`${kit}_bns`]);
				const kit_quality = parseInt(v[`${kit}_quality`]);

				const kit_total = kit_quality + (kit_mastered ? mastery_bonus : 0) + kit_bns;

				output[`${kit}_total`] = kit_total;
				output[`${kit}_total_label`] = `+${kit_total}`;
			}

			setAttrs(output, {silent: true});
		});
	});

	on("change:arcanist change:arcanist_bns change:arcanist_quality", function(eventInfo) {
		getAttrs(["mastery_bonus", "arcanist", "arcanist_bns", "arcanist_quality"], function(v) {
			var output = {};

			const mastery_bonus = parseInt(v["mastery_bonus"]);
			const arcanist = v["arcanist"] == "on";
			const arcanist_bns = parseInt(v["arcanist_bns"]);
			const arcanist_quality = parseInt(v["arcanist_quality"]);

			const arcanist_total = arcanist_quality + (arcanist ? mastery_bonus : 0) + arcanist_bns;

			output["arcanist_total"] = arcanist_total;
			output["arcanist_total_label"] = `+${arcanist_total}`;

			setAttrs(output, {silent: true});
		});
	});

	on("change:chemist change:chemist_bns change:chemist_quality", function(eventInfo) {
		getAttrs(["mastery_bonus", "chemist", "chemist_bns", "chemist_quality"], function(v) {
			var output = {};

			const mastery_bonus = parseInt(v["mastery_bonus"]);
			const chemist = v["chemist"] == "on";
			const chemist_bns = parseInt(v["chemist_bns"]);
			const chemist_quality = parseInt(v["chemist_quality"]);

			const chemist_total = chemist_quality + (chemist ? mastery_bonus : 0) + chemist_bns;

			output["chemist_total"] = chemist_total;
			output["chemist_total_label"] = `+${chemist_total}`;

			setAttrs(output, {silent: true});
		});
	});

	on("change:climbing change:climbing_bns change:climbing_quality", function(eventInfo) {
		getAttrs(["mastery_bonus", "climbing", "climbing_bns", "climbing_quality"], function(v) {
			var output = {};

			const mastery_bonus = parseInt(v["mastery_bonus"]);
			const climbing = v["climbing"] == "on";
			const climbing_bns = parseInt(v["climbing_bns"]);
			const climbing_quality = parseInt(v["climbing_quality"]);

			const climbing_total = climbing_quality + (climbing ? mastery_bonus : 0) + climbing_bns;

			output["climbing_total"] = climbing_total;
			output["climbing_total_label"] = `+${climbing_total}`;

			setAttrs(output, {silent: true});
		});
	});

	on("change:impersonation change:impersonation_bns change:impersonation_quality", function(eventInfo) {
		getAttrs(["mastery_bonus", "impersonation", "impersonation_bns", "impersonation_quality"], function(v) {
			var output = {};

			const mastery_bonus = parseInt(v["mastery_bonus"]);
			const impersonation = v["impersonation"] == "on";
			const impersonation_bns = parseInt(v["impersonation_bns"]);
			const impersonation_quality = parseInt(v["impersonation_quality"]);

			const impersonation_total = impersonation_quality + (impersonation ? mastery_bonus : 0) + impersonation_bns;

			output["impersonation_total"] = impersonation_total;
			output["impersonation_total_label"] = `+${impersonation_total}`;

			setAttrs(output, {silent: true});
		});
	});

	on("change:infiltration change:infiltration_bns change:infiltration_quality", function(eventInfo) {
		getAttrs(["mastery_bonus", "infiltration", "infiltration_bns", "infiltration_quality"], function(v) {
			var output = {};

			const mastery_bonus = parseInt(v["mastery_bonus"]);
			const infiltration = v["infiltration"] == "on";
			const infiltration_bns = parseInt(v["infiltration_bns"]);
			const infiltration_quality = parseInt(v["infiltration_quality"]);

			const infiltration_total = infiltration_quality + (infiltration ? mastery_bonus : 0) + infiltration_bns;

			output["infiltration_total"] = infiltration_total;
			output["infiltration_total_label"] = `+${infiltration_total}`;

			setAttrs(output, {silent: true});
		});
	});

	on("change:mechanic change:mechanic_bns change:mechanic_quality", function(eventInfo) {
		getAttrs(["mastery_bonus", "mechanic", "mechanic_bns", "mechanic_quality"], function(v) {
			var output = {};

			const mastery_bonus = parseInt(v["mastery_bonus"]);
			const mechanic = v["mechanic"] == "on";
			const mechanic_bns = parseInt(v["mechanic_bns"]);
			const mechanic_quality = parseInt(v["mechanic_quality"]);

			const mechanic_total = mechanic_quality + (mechanic ? mastery_bonus : 0) + mechanic_bns;

			output["mechanic_total"] = mechanic_total;
			output["mechanic_total_label"] = `+${mechanic_total}`;

			setAttrs(output, {silent: true});
		});
	});

	on("change:navigation change:navigation_bns change:navigation_quality", function(eventInfo) {
		getAttrs(["mastery_bonus", "navigation", "navigation_bns", "navigation_quality"], function(v) {
			var output = {};

			const mastery_bonus = parseInt(v["mastery_bonus"]);
			const navigation = v["navigation"] == "on";
			const navigation_bns = parseInt(v["navigation_bns"]);
			const navigation_quality = parseInt(v["navigation_quality"]);

			const navigation_total = navigation_quality + (navigation ? mastery_bonus : 0) + navigation_bns;

			output["navigation_total"] = navigation_total;
			output["navigation_total_label"] = `+${navigation_total}`;

			setAttrs(output, {silent: true});
		});
	});

	on("change:thaumaturgist change:thaumaturgist_bns change:thaumaturgist_quality", function(eventInfo) {
		getAttrs(["mastery_bonus", "thaumaturgist", "thaumaturgist_bns", "thaumaturgist_quality"], function(v) {
			var output = {};

			const mastery_bonus = parseInt(v["mastery_bonus"]);
			const thaumaturgist = v["thaumaturgist"] == "on";
			const thaumaturgist_bns = parseInt(v["thaumaturgist_bns"]);
			const thaumaturgist_quality = parseInt(v["thaumaturgist_quality"]);

			const thaumaturgist_total = thaumaturgist_quality + (thaumaturgist ? mastery_bonus : 0) + thaumaturgist_bns;

			output["thaumaturgist_total"] = thaumaturgist_total;
			output["thaumaturgist_total_label"] = `+${thaumaturgist_total}`;

			setAttrs(output, {silent: true});
		});
	});

	on("change:mastery_bonus", function(eventInfo) {
		const mastery_bonus = parseInt(eventInfo.newValue);
		getSectionIDs("toolkits", function(ids) {
			var attrs_to_get = ids.map(id => `repeating_toolkits_${id}_toolkit`).concat(ids.map(id => `repeating_toolkits_${id}_toolkit_bns`)).concat(ids.map(id => `repeating_toolkits_${id}_toolkit_quality`));
			getAttrs(attrs_to_get, function(v) {
				var output = {};

				for (let id of ids) {
					const toolkit = v[`repeating_toolkits_${id}_toolkit`];
					const toolkit_mastered = toolkit == "on";
					if (!toolkit_mastered)
						continue;
					const toolkit_bns = parseInt(v[`repeating_toolkits_${id}_toolkit_bns`]);
					const toolkit_quality = parseInt(v[`repeating_toolkits_${id}_toolkit_quality`]);

					const toolkit_total = toolkit_quality + (toolkit_mastered ? mastery_bonus : 0) + toolkit_bns;

					output[`repeating_toolkits_${id}_toolkit_total`] = toolkit_total;
					output[`repeating_toolkits_${id}_toolkit_total_label`] = `+${toolkit_total}`;
				}

				setAttrs(output, {silent: true});
			});
		});
	});

	on("change:repeating_toolkits", function(eventInfo) {
		getAttrs(["repeating_toolkits_toolkit", "repeating_toolkits_toolkit_bns", "repeating_toolkits_toolkit_quality", "mastery_bonus"], function(v) {
			var output = {};

			const toolkit = v["repeating_toolkits_toolkit"];
			const toolkit_mastered = toolkit == "on";
			const toolkit_bns = parseInt(v["repeating_toolkits_toolkit_bns"]);
			const toolkit_quality = parseInt(v["repeating_toolkits_toolkit_quality"]);
			const mastery_bonus = parseInt(v["mastery_bonus"]);

			const toolkit_total = toolkit_quality + (toolkit_mastered ? mastery_bonus : 0) + toolkit_bns;

			output["repeating_toolkits_toolkit_total"] = toolkit_total;
			output["repeating_toolkits_toolkit_total_label"] = `+${toolkit_total}`;

			setAttrs(output, {silent: true});
		});
	});

	on("change:repeating_traits", function(eventInfo) {
		getAttrs(["repeating_traits_trait_lifeform", "character_lifeform"], function(v) {
			var output = {};

			const lifeform = v["repeating_traits_trait_lifeform"];
			const character_lifeform = v["character_lifeform"];
			if (lifeform != "")
				return;

			output["repeating_traits_trait_lifeform"] = character_lifeform;

			setAttrs(output, {silent: true});
		});

		getSectionIDs("traits", function(ids) {
			var attrs_to_get = ids.map(id => `repeating_traits_${id}_trait_name`).concat(ids.map(id => `repeating_traits_${id}_trait_type`));

			getAttrs(attrs_to_get, function(v) {
				var output = {};
				var trait_value_pair = "";

				for (const id of ids) {
					const traitName = v[`repeating_traits_${id}_trait_name`];
					const traitType = v[`repeating_traits_${id}_trait_type`];
					if (traitName == undefined || traitName == "")
						continue;
					trait_value_pair += `${traitName} (${traitType} trait)\n`;
				}

				trait_value_pair = trait_value_pair.trimEnd();

				output["all_traits"] = trait_value_pair;

				setAttrs(output, {silent: false});
			});
		});
	});

	on("change:repeating_features change:character_primary_class change:character_secondary_class", function(eventInfo) {
		getAttrs(["character_primary_class", "character_secondary_class"], function(v) {
			var output = {};

			const primary_class = v["character_primary_class"].toLowerCase();
			const secondary_class = v["character_secondary_class"].toLowerCase();

			getSectionIDs("features", function(ids) {
				var attrs_to_get =
				ids.map(id => `repeating_features_${id}_feature_name`)
				.concat(ids.map(id => `repeating_features_${id}_feature_level`))
				.concat(ids.map(id => `repeating_features_${id}_feature_class`))
				.concat(ids.map(id => `repeating_features_${id}_feature_discipline`));

				getAttrs(attrs_to_get, function(v) {
					var output = {};
					var primary_features = [];
					var secondary_features = [];

					for (let i = 0; i < ids.length; i++) {
						const id = ids[i];
						const featureClass = v[`repeating_features_${id}_feature_class`];
						const featureDiscipline = v[`repeating_features_${id}_feature_discipline`];

						const featureName = v[`repeating_features_${id}_feature_name`];
						const featureLevel = v[`repeating_features_${id}_feature_level`];

						if ((featureClass == undefined || featureClass == "") && (featureDiscipline == undefined || featureDiscipline == ""))
							continue;

						if ((featureClass != undefined && featureClass != "" && primary_class.includes(featureClass.toLowerCase()))
						|| (featureDiscipline != undefined && featureDiscipline != "" && primary_class.includes(featureDiscipline.toLowerCase()))) {
							primary_features.push({
								feature_discipline: featureDiscipline,
								feature_class: featureClass,
								feature_name: featureName,
								feature_level: featureLevel
							});
						}
						else if ((featureClass != undefined && featureClass != "" && secondary_class.includes(featureClass.toLowerCase()))
							|| (featureDiscipline != undefined && featureDiscipline != "" && secondary_class.includes(featureDiscipline.toLowerCase()))) {
							secondary_features.push({
								feature_discipline: featureDiscipline,
								feature_class: featureClass,
								feature_name: featureName,
								feature_level: featureLevel
							});
						}
					}

					primary_features.sort((a, b) => b.feature_level - a.feature_level);
					secondary_features.sort((a, b) => b.feature_level - a.feature_level);

					var final_string = "";
					if (primary_features.length > 0) {
						final_string += `Primary Class (${primary_features[0].feature_discipline} ${primary_features[0].feature_class}) features\n`;
						for (let feature of primary_features) {
							final_string += `  ${feature.feature_name} (Rank ${feature.feature_level})\n`;
						}
					}
					if (secondary_features.length > 0) {
						final_string += `Secondary Class (${secondary_features[0].feature_discipline} ${secondary_features[0].feature_class}) features\n`;
						for (let feature of secondary_features) {
							final_string += `  ${feature.feature_name} (Rank ${feature.feature_level})\n`;
						}
					}

					output["all_features"] = final_string.trimEnd();

					setAttrs(output, {silent: false});
				});
			});
		});
	});

	on("change:all_quirks change:all_traits change:all_features", function(eventInfo) {
		getAttrs(["all_quirks", "all_traits", "all_features"], function(v) {
			var output = {};

			const all_quirks = v["all_quirks"];
			const all_traits = v["all_traits"];
			const all_features = v["all_features"];

			var all_text = "";
			if (all_quirks != undefined && all_quirks != "")
				all_text += "Quirks\n" + all_quirks.split("\n").map(line => `  ${line}`).join("\n") + "\n\n";
			if (all_traits != undefined && all_traits != "")
				all_text += "Traits\n" + all_traits.split("\n").map(line => `  ${line}`).join("\n") + "\n\n";
			if (all_features != undefined && all_features != "")
				all_text += "Features\n" + all_features.split("\n").map(line => `  ${line}`).join("\n") + "\n\n";

			output["all_quirks_traits_features"] = all_text.trimEnd();

			setAttrs(output, {silent: true});
		});
	});

	on("change:repeating_equipment", function(eventInfo) {
		getSectionIDs("equipment", function(ids) {
			var attrs_to_get = ids.map(id => `repeating_equipment_${id}_equipment_name`).concat(ids.map(id => `repeating_equipment_${id}_equipment_quantity`)).concat(ids.map(id => `repeating_equipment_${id}_equipment_weight`)).concat("added_slots");

			getAttrs(attrs_to_get, function(v) {
				var output = {};
				var equipment_value_pair = "";
				var total_weight = 0;
				const added_slots = parseInt(v["added_slots"]);
				const total_slots = 8 + added_slots;

				for (const id of ids) {
					const equipmentName = v[`repeating_equipment_${id}_equipment_name`];
					const equipmentQuantity = parseInt(v[`repeating_equipment_${id}_equipment_quantity`]);
					if (equipmentName == undefined || equipmentName == "")
						continue;
					equipment_value_pair += `${equipmentName} (${equipmentQuantity})\n`;
				}

				equipment_value_pair = equipment_value_pair.trimEnd();

				output["all_equipment"] = equipment_value_pair;

				for (const id of ids) {
					const equipmentWeight = parseFloat(v[`repeating_equipment_${id}_equipment_weight`]);
					const equipmentQuantity = parseFloat(v[`repeating_equipment_${id}_equipment_quantity`]);
					if (equipmentQuantity == 0 || equipmentWeight == 0)
						continue;
					total_weight += equipmentQuantity * equipmentWeight;
				}

				output["equipment_weight_label"] = `${parseInt(total_weight)}/${total_slots}`;

				setAttrs(output, {silent: false});
			});
		});
	});

	on("change:added_slots", function(eventInfo) {
		getAttrs(["added_slots", "equipment_weight_label"], function(v) {
			var output = {};
			const added_slots = parseInt(v["added_slots"]);
			const total_slots = 8 + added_slots;
			const equipment_weight_label = v["equipment_weight_label"];
			const total_weight = parseInt(equipment_weight_label.split("/")[0]);

			output["equipment_weight_label"] = `${total_weight}/${total_slots}`;

			setAttrs(output, {silent: true});
		});
	});

	on("change:repeating_bonds", function(eventInfo) {
		const valueDelta = eventInfo.newValue != eventInfo.previousValue ? parseInt(eventInfo.newValue) - parseInt(eventInfo.previousValue) : parseInt(eventInfo.newValue);
		var output = {};

		getSectionIDs("bonds", function(ids) {
			getAttrs(["bond_strength", "fond_memories"], function(v) {
				const fond_memories = parseInt(v["fond_memories"]);
				var bond_strength = parseInt(v["bond_strength"]);
				bond_strength += valueDelta;

				const bond_amount = ids.length;

				var bond_label = "";
				bond_label += `Bonds: ${bond_amount}\n`;
				bond_label += `Bond points: ${bond_strength}\n`;
				bond_label += `Fond memories: ${fond_memories}/50`;

				output["bond_strength"] = bond_strength;
				output["bond_amount"] = bond_amount;
				output["bond_amount_label"] = bond_label;

				setAttrs(output, {silent: true});
			});
		});
	});

	var getSectionIDsOrdered = function(sectionName, callback) {
		'use strict';
		getAttrs([`_reporder_${sectionName}`], function(v) {
			getSectionIDs(sectionName, function(idArray) {
				let reporderArray = v[`_reporder_${sectionName}`] ? v[`_reporder_${sectionName}`].toLowerCase().split(',') : [],
					ids = [...new Set(reporderArray.filter(x => idArray.includes(x)).concat(idArray))];
				callback(ids);
			});
		});
	};

	on("change:repeating_ranks change:_reporder:ranks remove:repeating_ranks", function(eventInfo) {
		getSectionIDsOrdered("repeating_ranks", function(ids) {
			var output = {};

			for (var i = 0; i < ids.length; i++) {
				var id = ids[i];

				output[`repeating_ranks_${id}_rank_level`] = i + 1;
				output[`repeating_ranks_${id}_rank_level_label`] = `Rank ${i + 1}`;
			}

			setAttrs(output, {silent: true});

			const name_ranks_attributes = ids.map(id => `repeating_ranks_${id}_rank_name`).concat(ids.map(id => `repeating_ranks_${id}_rank_level`));
			getAttrs(name_ranks_attributes, function(v) {
				var output = {};
				var ranks_value_pair = "";

				for (let i = 0; i < ids.length; i++) {
					const id = ids[i];
					const rankName = v[`repeating_ranks_${id}_rank_name`];
					const rankLevel = v[`repeating_ranks_${id}_rank_level`];
					if (rankName == undefined || rankName == "")
						continue;
					ranks_value_pair += `Level ${rankLevel}: ${rankName}\n`;
				}

				ranks_value_pair = ranks_value_pair.trimEnd();

				output["all_ranks"] = ranks_value_pair;

				setAttrs(output, {silent: true});
			});
		});
	});
</script>

<html>
<div class="charsheet">
	<input type="hidden" class="sheet-tabstoggle" name="attr_sheetTab" value="character" />
	<div class="sheet-header">
		<div>
			<button type="action" class="sheet-tabButton" name="act_character">Character</button>
			<button type="action" class="sheet-tabButton" name="act_combat">Combat</button>
			<button type="action" class="sheet-tabButton" name="act_magic">Magic</button>
			<button type="action" class="sheet-tabButton" name="act_notes">Notes</button>
			<button type="action" class="sheet-tabButton" name="act_options">Options</button>
		</div>
		<div class="sheet-flexGrow sheet-flexEnd">
			<select name="attr_roll_whisper_type" title="Select roll visibility">
				<option value="" title="Rolls are visible by everyone" selected><span>Show rolls</span></option>
				<option value="?{Whisper?|Public Roll,|Whisper Roll,/w gm }" title="Select your roll visibility each time you roll"><span>Ask each time</span></option>
				<option value="/w gm" title="Only you and the GM will see your rolls"><span>Always whisper</span></option>
			</select>
		</div>
	</div>

	<div class="sheet-character sheet-tab">
		<h1>Character</h1>

		<!-- Player Info -->
		<div class="sheet-playerinfo">
			<!-- <div><span>Player Name :</span><input type="text" name="attr_player_name"/></div> -->
			<div>
				<div style="display: flex; flex: 1 0 auto;"><span>Character Name :</span><input type="text" name="attr_character_name"/></div>
				<div style="flex-shrink: 0; width: 183px;">
					<span>Level :</span><input type="number" name="attr_character_level" style="text-align: end;" value="1" />
					<span>(</span><input type="number" name="attr_character_xp" /><span>) exp</span>
				</div>
			</div>
			<div>
				<div style="display: flex; flex: 1 0 auto;"><span>Lifeform :</span><input type="text" name="attr_character_lifeform"/></div>
				<div style="flex-shrink: 0; width: 183px; display: flex;">
					<span style="flex-shrink: 0;">Grade :</span>
					<input type="hidden" class="sheet-adventuringRank" name="attr_adventuring_grade" value="copper" />
					<span class="sheet-adventuringRank sheet-replicateInput" name="attr_adventuring_grade"></span>
				</div>
			</div>
			<div><span>⬖ Primary Class :</span><input type="text" name="attr_character_primary_class"/></div>
			<div><span>⬗ Secondary Class :</span><input type="text" name="attr_character_secondary_class"/></div>
		</div>

		<!-- Quirks -->
		<div class="sheet-botSpace">
			<input type="hidden" name="attr_quirk_total" value="0" />
			<input type="hidden" name="attr_quirk_points_label" value="0/2" />
			<div style="display: flex; flex-flow: column wrap; justify-content: stretch;">
				<div class="sheet-sectionTitle" style="display: flex; flex: 1 1 auto;">
					<span class="sheet-sectionTitle">Character quirks</span>
					<input type="checkbox" name="attr_quirk_fold" class="sheet-folder" />
					<span class="sheet-folder"></span>
					<span class="sheet-sectionTitle" style="flex: 1 0 auto; text-align: end;" name="attr_quirk_points_label"></span>
				</div>
				<input type="hidden" name="attr_quirk_fold" class="sheet-folder" />
				<div style="flex-flow: column wrap;" class="sheet-foldable">
					<!-- Quirks (repeating sections) -->
					<fieldset class="repeating_quirks" style="flex-flow: row wrap;">
						<!-- Name + Lvl + foldable section -->
						<div>
							<div>
								<input type="text" name="attr_quirk_name" title="Quirk name" placeholder="Quirk name" />
								<input type="number" name="attr_quirk_level" title="Quirk level" value="1" />
								<input type="checkbox" name="attr_quirk_fold" class="sheet-folder" />
								<span class="sheet-folder"></span>
							</div>
							<!-- Text area for quirk description -->
							<input type="hidden" name="attr_quirk_fold" class="sheet-folder" />
							<div class="sheet-foldable">
								<textarea name="attr_quirk_description" style="width: 100%;" title="Quirk deception" placeholder="Quirk deception"></textarea>
							</div>
						</div>
					</fieldset>
				</div>
				<div class="sheet-reverseFoldable sheet-sectionContainer">
					<input type="hidden" name="attr_all_quirks" />
					<span class="sheet-replicateInput sheet-contentSummary" name="attr_all_quirks"></span>
				</div>
			</div>
		</div>

		<!-- Resolve HP MP -->
		<div>
			<div>
				<table>
					<tr>
						<th>Hit Points</th>
						<th>Mind Points</th>
					</tr>
					<tr>
						<td>
							<div class="diagonal"></div>
							<div class="top-left"><input type="number" name="attr_hp_current" placeholder="0"></div>
							<div class="bottom-right"><input type="number" name="attr_hp_max" placeholder="0"></div>
						</td>
						<td>
							<div class="diagonal"></div>
							<div class="top-left"><input type="number" name="attr_mp_current" placeholder="0"></div>
							<div class="bottom-right"><input type="number" name="attr_mp_max" placeholder="0"></div>
						</td>
					</tr>
				</table>
			</div>
			<!-- Resolve HP MP -->
			<div  style="display: flex; flex-flow: row wrap; gap: 4px; justify-content: space-evenly;">
				<div class="sheet-guardPoint">
					<div class="sheet-sectionTitle">
						<span>Spirit</span>
						<div>
							<input type="checkbox" name="attr_spirit1" />
							<input type="checkbox" name="attr_spirit2" />
							<input type="checkbox" name="attr_spirit3" />
							<input type="checkbox" name="attr_spirit4" />
							<input type="checkbox" name="attr_spirit5" />
						</div>
					</div>
					<div class="sheet-sectionTitle">
						<span>Resolve Points</span>
						<input type="checkbox" name="attr_resolve_fold" class="sheet-folder" />
						<span class="sheet-folder"></span>
					</div>
					<div class="sheet-extendedCounterPoint">
						<input type="hidden" name="attr_resolve_fold" class="sheet-folder" />
						<div class="sheet-counterPoint">
							<div class="sheet-inputPoint">
								<input type="number" name="attr_resolve_current" value="30" />
							</div>
							<div>
								<span>Max Resolve</span>
								<input type="hidden" name="attr_resolve_max" value="30" />
								<span class="sheet-replicateInput" name="attr_resolve_max"></span>
							</div>
						</div>
						<div class="sheet-foldable">
							<div>
								<span>Max Resolve Bonus</span>
								<input type="number" name="attr_added_resolve" value="0" />
							</div>
						</div>
					</div>
				</div>
				<div class="sheet-guardPoint">
					<div class="sheet-sectionTitle">
						<span>Barrier</span>
						<div>
							<input type="checkbox" name="attr_barrier1" />
							<input type="checkbox" name="attr_barrier2" />
							<input type="checkbox" name="attr_barrier3" />
						</div>
					</div>
					<div class="sheet-sectionTitle">
						<span>Hit Points</span>
						<input type="checkbox" name="attr_hp_fold" class="sheet-folder" />
						<span class="sheet-folder"></span>
					</div>
					<div class="sheet-extendedCounterPoint">
						<input type="hidden" name="attr_hp_fold" class="sheet-folder" />
						<div class="sheet-counterPoint">
							<div class="sheet-inputPoint">
								<input type="number" name="attr_hp_current" value="15" />
							</div>
							<div>
								<span>Max HP</span>
								<input type="hidden" name="attr_hp_max" value="15" />
								<span class="sheet-replicateInput" name="attr_hp_max"></span>
							</div>
						</div>
						<div class="sheet-foldable">
							<div>
								<span>Unarmored Toughness</span>
								<input type="checkbox" name="attr_unarmored_toughness" />
							</div>
							<div>
								<span>Armor HP</span>
								<input type="number" name="attr_armor_hp" value="0" />
							</div>
							<div>
								<span>Max HP Bonus</span>
								<input type="number" name="attr_added_hp" value="0" />
							</div>
						</div>
					</div>
				</div>
				<div class="sheet-guardPoint">
					<div class="sheet-sectionTitle">
						<span>Spellglyphs</span>
						<div>
							<input type="checkbox" name="attr_glyph1" />
							<input type="checkbox" name="attr_glyph2" />
							<input type="checkbox" name="attr_glyph3" />
						</div>
					</div>
					<div class="sheet-sectionTitle">
						<span>Mind Points</span>
						<input type="checkbox" name="attr_mp_fold" class="sheet-folder" />
						<span class="sheet-folder"></span>
					</div>
					<div class="sheet-extendedCounterPoint">
						<input type="hidden" name="attr_mp_fold" class="sheet-folder" />
						<div class="sheet-counterPoint">
							<div class="sheet-inputPoint">
								<input type="number" name="attr_mp_current" value="15" />
							</div>
							<div>
								<span>Max MP</span>
								<input type="hidden" name="attr_mp_max" value="15" />
								<span class="sheet-replicateInput" name="attr_mp_max"></span>
							</div>
						</div>
						<div class="sheet-foldable">
							<div>
								<span>Max MP Bonus</span>
								<input type="number" name="attr_added_mp" value="0" />
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<!-- Stat pills -->
		<div class="sheet-botSpace" style="align-items: center; flex-flow: row wrap; justify-content: space-evenly;">
			<!-- Fond memories -->
			<div class="sheet-statPill">
				<div class="sheet-sectionTitle">
					<span>Fond</span>
					<span style="font-size: small;">Memories</span>
				</div>
				<div>
					<input type="number" style="text-align: center;" name="attr_fond_memories" value="0" />
					<div style="display: flex;
					flex-flow: column;
					height: auto;
					border: 0;
					border-radius: 0;
					padding: 0;
					margin-right: 2px;">
						<span>Max</span>
						<span style="text-align: center; font-weight: bold;">50</span>
					</div>
				</div>
			</div>
			<!-- Mastery bonus -->
			<div class="sheet-statPill">
				<div class="sheet-sectionTitle">
					<span style="font-size: small;">Mastery</span>
					<span>Bonus</span>
				</div>
				<div>
					<span style="font-size: x-large; font-weight: bold;">+</span>
					<input type="hidden" name="attr_mastery_bonus" value="2" />
					<span class="sheet-replicateInput" name="attr_mastery_bonus" style="width: 3em;"></span>
				</div>
			</div>
			<!-- Destiny End Points -->
			<div class="sheet-statPill">
				<div class="sheet-sectionTitle">
					<span>Destiny's</span>
					<span style="font-size: small;">End Points</span>
				</div>
				<div>
					<input type="number" style="text-align: center;" name="attr_destiny_current" value="0" />
					<div style="display: flex;
					flex-flow: column;
					height: auto;
					border: 0;
					border-radius: 0;
					padding: 0;
					margin-right: 2px;">
						<span>Max</span>
						<span style="text-align: center; font-weight: bold;">12</span>
					</div>
				</div>
			</div>
		</div>

		<!-- Comps and Toolkits -->
		<div class="sheet-botSpace" style="flex-flow: row wrap; gap: 4px;">
			<!-- Attributes & Skills tableau -->
			<div class="sheet-attributeTable">
				<!-- Header -->
				<div class="sheet-sectionTitle">
					<span class="sheet-sectionTitle" style="width: 148px; flex: 0 0 auto;">Attributes</span>
					<span class="sheet-sectionTitle" style="width: 120px; flex: 1 0 auto;">Skills</span>
					<span class="sheet-sectionTitle" style="width: 45.5px; flex: 1 0 auto;">BNS</span>
				</div>
				<div>
					<!--
						Strength
							Brute
							Endurance
							Intimidation
						Agility
							Sports
							Thievery
							Deception
						Awareness
							Detect
							Information
							Reason
						Empathy
							Psychology
							Artistry
							Charm
					-->
					<!-- Strength -->
					<div class="sheet-abilityBlock">
						<div class="sheet-statBlock">
							<input type="number" name="attr_strength" value="0" />
							<button type="roll" name="act_rollStrength">
								<span>Strength</span>
							</button>
						</div>
						<div class="sheet-compBlock">
							<div class="sheet-compLine">
								<span>+</span>
								<input type="checkbox" name="attr_brute" />
								<span>Brute</span>
								<input type="number" name="attr_brute_bns" value="0" />
								<input type="hidden" name="attr_brute_total" value="0" />
								<input type="hidden" name="attr_brute_total_label" value="0" />
								<button type="roll" name="act_rollBrute" value="@{roll_whisper_type}">
									<span name="attr_brute_total_label"></span>
								</button>
							</div>
							<div class="sheet-compLine">
								<span>+</span>
								<input type="checkbox" name="attr_endurance" />
								<span>Endurance</span>
								<input type="number" name="attr_endurance_bns" value="0" />
								<input type="hidden" name="attr_endurance_total" value="0" />
								<input type="hidden" name="attr_endurance_total_label" value="0" />
								<button type="roll" name="act_rollEndurance">
									<span name="attr_endurance_total_label"></span>
								</button>
							</div>
							<div class="sheet-compLine">
								<span>+</span>
								<input type="checkbox" name="attr_intimidation" />
								<span>Intimidation</span>
								<input type="number" name="attr_intimidation_bns" value="0" />
								<input type="hidden" name="attr_intimidation_total" value="0" />
								<input type="hidden" name="attr_intimidation_total_label" value="0" />
								<button type="roll" name="act_rollIntimidation">
									<span name="attr_intimidation_total_label"></span>
								</button>
							</div>
						</div>
					</div>
					<!-- Agility -->
					<div class="sheet-abilityBlock">
						<div class="sheet-statBlock">
							<input type="number" name="attr_agility" value="0" />
							<button type="roll" name="act_rollAgility">
								<span>Agility</span>
							</button>
						</div>
						<div class="sheet-compBlock">
							<div class="sheet-compLine">
								<span>+</span>
								<input type="checkbox" name="attr_sports" />
								<span>Sports</span>
								<input type="number" name="attr_sports_bns" value="0" />
								<input type="hidden" name="attr_sports_total" value="0" />
								<input type="hidden" name="attr_sports_total_label" value="0" />
								<button type="roll" name="act_rollSports">
									<span name="attr_sports_total_label"></span>
								</button>
							</div>
							<div class="sheet-compLine">
								<span>+</span>
								<input type="checkbox" name="attr_thievery" />
								<span>Thievery</span>
								<input type="number" name="attr_thievery_bns" value="0" />
								<input type="hidden" name="attr_thievery_total" value="0" />
								<input type="hidden" name="attr_thievery_total_label" value="0" />
								<button type="roll" name="act_rollThievery">
									<span name="attr_thievery_total_label"></span>
								</button>
							</div>
							<div class="sheet-compLine">
								<span>+</span>
								<input type="checkbox" name="attr_deception" />
								<span>Deception</span>
								<input type="number" name="attr_deception_bns" value="0" />
								<input type="hidden" name="attr_deception_total" value="0" />
								<input type="hidden" name="attr_deception_total_label" value="0" />
								<button type="roll" name="act_rollDeception">
									<span name="attr_deception_total_label"></span>
								</button>
							</div>
						</div>
					</div>
					<!-- Awareness -->
					<div class="sheet-abilityBlock">
						<div class="sheet-statBlock">
							<input type="number" name="attr_awareness" value="0" />
							<button type="roll" name="act_rollAwareness">
								<span>Awareness</span>
							</button>
						</div>
						<div class="sheet-compBlock">
							<div class="sheet-compLine">
								<span>+</span>
								<input type="checkbox" name="attr_detect" />
								<span>Detect</span>
								<input type="number" name="attr_detect_bns" value="0" />
								<input type="hidden" name="attr_detect_total" value="0" />
								<input type="hidden" name="attr_detect_total_label" value="0" />
								<button type="roll" name="act_rollDetect">
									<span name="attr_detect_total_label"></span>
								</button>
							</div>
							<div class="sheet-compLine">
								<span>+</span>
								<input type="checkbox" name="attr_information" />
								<span>Information</span>
								<input type="number" name="attr_information_bns" value="0" />
								<input type="hidden" name="attr_information_total" value="0" />
								<input type="hidden" name="attr_information_total_label" value="0" />
								<button type="roll" name="act_rollInformation">
									<span name="attr_information_total_label"></span>
								</button>
							</div>
							<div class="sheet-compLine">
								<span>+</span>
								<input type="checkbox" name="attr_reason" />
								<span>Reason</span>
								<input type="number" name="attr_reason_bns" value="0" />
								<input type="hidden" name="attr_reason_total" value="0" />
								<input type="hidden" name="attr_reason_total_label" value="0" />
								<button type="roll" name="act_rollReason">
									<span name="attr_reason_total_label"></span>
								</button>
							</div>
						</div>
					</div>
					<!-- Empathy -->
					<div class="sheet-abilityBlock">
						<div class="sheet-statBlock">
							<input type="number" name="attr_empathy" value="0" />
							<button type="roll" name="act_rollEmpathy">
								<span>Empathy</span>
							</button>
						</div>
						<div class="sheet-compBlock">
							<div class="sheet-compLine">
								<span>+</span>
								<input type="checkbox" name="attr_psychology" />
								<span>Psychology</span>
								<input type="number" name="attr_psychology_bns" value="0" />
								<input type="hidden" name="attr_psychology_total" value="0" />
								<input type="hidden" name="attr_psychology_total_label" value="0" />
								<button type="roll" name="act_rollPsychology">
									<span name="attr_psychology_total_label"></span>
								</button>
							</div>
							<div class="sheet-compLine">
								<span>+</span>
								<input type="checkbox" name="attr_artistry" />
								<span>Artistry</span>
								<input type="number" name="attr_artistry_bns" value="0" />
								<input type="hidden" name="attr_artistry_total" value="0" />
								<input type="hidden" name="attr_artistry_total_label" value="0" />
								<button type="roll" name="act_rollArtistry">
									<span name="attr_artistry_total_label"></span>
								</button>
							</div>
							<div class="sheet-compLine">
								<span>+</span>
								<input type="checkbox" name="attr_charm" />
								<span>Charm</span>
								<input type="number" name="attr_charm_bns" value="0" />
								<input type="hidden" name="attr_charm_total" value="0" />
								<input type="hidden" name="attr_charm_total_label" value="0" />
								<button type="roll" name="act_rollCharm">
									<span name="attr_charm_total_label"></span>
								</button>
							</div>
						</div>
					</div>
				</div>
			</div>
			<!-- Toolkits -->
			<div class="sheet-toolkitTable">
				<div class="sheet-sectionTitle">
					<span class="sheet-sectionTitle" style="flex: 4 0 auto;">Toolkits</span>
					<span class="sheet-sectionTitle" style="flex: 2 0 auto;">Quality</span>
					<span class="sheet-sectionTitle" style="flex: 1 0 auto;">BNS</span>
				</div>
				<div>
					<!--
						Arcanist
						Chemist
						Climbing
						Impersonation

						Infiltration
						Mechanic
						Navigation
						Thaumaturgist

						Free Toolkit places
					-->
					<!-- Arcanist -->
					<div class="sheet-toolkitBlock">
						<span>Arcanist kit</span>
						<input type="number" name="attr_arcanist_quality" value="0" />
						<span>+</span>
						<input type="checkbox" name="attr_arcanist" />
						<input type="number" name="attr_arcanist_bns" value="0" />
						<input type="hidden" name="attr_arcanist_total" value="0" />
						<input type="hidden" name="attr_arcanist_total_label" value="+0" />
						<button type="roll" name="act_rollArcanist">
							<span name="attr_arcanist_total_label"></span>
						</button>
					</div>
					<!-- Chemist -->
					<div class="sheet-toolkitBlock">
						<span>Chemist kit</span>
						<input type="number" name="attr_chemist_quality" value="0" />
						<span>+</span>
						<input type="checkbox" name="attr_chemist" />
						<input type="number" name="attr_chemist_bns" value="0" />
						<input type="hidden" name="attr_chemist_total" value="0" />
						<input type="hidden" name="attr_chemist_total_label" value="+0" />
						<button type="roll" name="act_rollChemist">
							<span name="attr_chemist_total_label"></span>
						</button>
					</div>
					<!-- Climbing -->
					<div class="sheet-toolkitBlock">
						<span>Climbing kit</span>
						<input type="number" name="attr_climbing_quality" value="0" />
						<span>+</span>
						<input type="checkbox" name="attr_climbing" />
						<input type="number" name="attr_climbing_bns" value="0" />
						<input type="hidden" name="attr_climbing_total" value="0" />
						<input type="hidden" name="attr_climbing_total_label" value="+0" />
						<button type="roll" name="act_rollClimbing">
							<span name="attr_climbing_total_label"></span>
						</button>
					</div>
					<!-- Impersonation -->
					<div class="sheet-toolkitBlock" style="margin-bottom: 6px;">
						<span>Impersonation kit</span>
						<input type="number" name="attr_impersonation_quality" value="0" />
						<span>+</span>
						<input type="checkbox" name="attr_impersonation" />
						<input type="number" name="attr_impersonation_bns" value="0" />
						<input type="hidden" name="attr_impersonation_total" value="0" />
						<input type="hidden" name="attr_impersonation_total_label" value="+0" />
						<button type="roll" name="act_rollImpersonation">
							<span name="attr_impersonation_total_label"></span>
						</button>
					</div>
					<!-- Infiltration -->
					<div class="sheet-toolkitBlock">
						<span>Infiltration kit</span>
						<input type="number" name="attr_infiltration_quality" value="0" />
						<span>+</span>
						<input type="checkbox" name="attr_infiltration" />
						<input type="number" name="attr_infiltration_bns" value="0" />
						<input type="hidden" name="attr_infiltration_total" value="0" />
						<input type="hidden" name="attr_infiltration_total_label" value="+0" />
						<button type="roll" name="act_rollInfiltration">
							<span name="attr_infiltration_total_label"></span>
						</button>
					</div>
					<!-- Mechanic -->
					<div class="sheet-toolkitBlock">
						<span>Mechanic kit</span>
						<input type="number" name="attr_mechanic_quality" value="0" />
						<span>+</span>
						<input type="checkbox" name="attr_mechanic" />
						<input type="number" name="attr_mechanic_bns" value="0" />
						<input type="hidden" name="attr_mechanic_total" value="0" />
						<input type="hidden" name="attr_mechanic_total_label" value="+0" />
						<button type="roll" name="act_rollMechanic">
							<span name="attr_mechanic_total_label"></span>
						</button>
					</div>
					<!-- Navigation -->
					<div class="sheet-toolkitBlock">
						<span>Navigation kit</span>
						<input type="number" name="attr_navigation_quality" value="0" />
						<span>+</span>
						<input type="checkbox" name="attr_navigation" />
						<input type="number" name="attr_navigation_bns" value="0" />
						<input type="hidden" name="attr_navigation_total" value="0" />
						<input type="hidden" name="attr_navigation_total_label" value="+0" />
						<button type="roll" name="act_rollNavigation">
							<span name="attr_navigation_total_label"></span>
						</button>
					</div>
					<!-- Thaumaturgist -->
					<div class="sheet-toolkitBlock" style="margin-bottom: 6px;">
						<span>Thaumaturgist kit</span>
						<input type="number" name="attr_thaumaturgist_quality" value="0" />
						<span>+</span>
						<input type="checkbox" name="attr_thaumaturgist" />
						<input type="number" name="attr_thaumaturgist_bns" value="0" />
						<input type="hidden" name="attr_thaumaturgist_total" value="0" />
						<input type="hidden" name="attr_thaumaturgist_total_label" value="+0" />
						<button type="roll" name="act_rollThaumaturgist">
							<span name="attr_thaumaturgist_total_label"></span>
						</button>
					</div>
					<!-- Free Toolkit places -->
					<fieldset class="repeating_toolkits">
						<div>
							<div class="sheet-toolkitBlock">
								<input type="text" name="attr_toolkit_name" placeholder="Toolkit name" />
								<input type="number" name="attr_toolkit_quality" value="0" />
								<span>+</span>
								<input type="checkbox" name="attr_toolkit" />
								<input type="number" name="attr_toolkit_bns" value="0" />
								<input type="hidden" name="attr_toolkit_total" value="0" />
								<input type="hidden" name="attr_toolkit_total_label" value="+0" />
								<button type="roll" name="act_rollToolkit">
									<span name="attr_toolkit_total_label"></span>
								</button>
							</div>
						</div>
					</fieldset>
				</div>
			</div>
		</div>

		<!-- Traits & stuff -->
		<div style="display: flex; flex-flow: row wrap; gap: 4px; justify-content: stretch;">
			<!-- Traits & Features -->
			<div style="flex-flow: column; flex: 1 1 auto;">
				<div class="sheet-sectionTitle">
					<span class="sheet-sectionTitle" style="flex: 1 1 auto;">Traits & Features</span>
					<input type="checkbox" name="attr_all_traits_fold" class="sheet-folder" />
					<span class="sheet-folder"></span>
				</div>
				<input type="hidden" name="attr_all_traits_fold" class="sheet-folder" />
				<div class="sheet-sectionContainer sheet-foldable" style="gap: 4px;">
					<div>
						<!-- Quirks -->
						<!-- as a repeating section -->
						<div class="sheet-sectionTitle">
							<span class="sheet-sectionTitle">Quirks</span>
							<input type="checkbox" name="attr_quirk_trait_fold" class="sheet-folder" />
							<span class="sheet-folder"></span>
						</div>
						<input type="hidden" name="attr_quirk_trait_fold" class="sheet-folder" />
						<div class="sheet-foldable sheet-sectionContainer">
							<fieldset class="repeating_quirks">
								<div>
									<div>
										<input type="text" name="attr_quirk_name" title="Quirk name" placeholder="Quirk name" />
										<input type="number" name="attr_quirk_level" title="Quirk level" value="1" />
										<input type="checkbox" name="attr_quirk_fold" class="sheet-folder" />
										<span class="sheet-folder"></span>
									</div>
									<!-- Text area for quirk description -->
									<input type="hidden" name="attr_quirk_fold" class="sheet-folder" />
									<div class="sheet-foldable">
										<textarea name="attr_quirk_description" style="width: 100%;"></textarea>
									</div>
								</div>
							</fieldset>
						</div>
						<div class="sheet-reverseFoldable sheet-sectionContainer">
							<input type="hidden" name="attr_all_quirks" />
							<span class="sheet-replicateInput sheet-contentSummary" name="attr_all_quirks"></span>
						</div>
					</div>
					<div>
						<!-- Traits -->
						<!-- as a repeating section -->
						<div class="sheet-sectionTitle">
							<span class="sheet-sectionTitle">Lifeform traits</span>
							<input type="checkbox" name="attr_trait_fold" class="sheet-folder" />
							<span class="sheet-folder"></span>
						</div>
						<input type="hidden" name="attr_trait_fold" class="sheet-folder" />
						<div class="sheet-foldable sheet-sectionContainer">
							<fieldset class="repeating_traits">
								<div>
									<div class="sheet-repeatingTrait">
										<div>
											<input type="text" name="attr_trait_name" title="Trait name" placeholder="Trait name" />
											<input type="text" name="attr_trait_lifeform" title="Lifeform" placeholder="Lifeform" />
											<input type="checkbox" name="attr_trait_fold" class="sheet-folder" />
											<span class="sheet-folder"></span>
										</div>
										<!-- Text area for trait description -->
										<input type="hidden" name="attr_trait_fold" class="sheet-folder" />
										<div class="sheet-foldable">
											<select name="attr_trait_type" title="Trait type">
												<option value="major">Major</option>
												<option value="minor">Minor</option>
												<option value="xtra">Xtra</option>
											</select>
											<textarea name="attr_trait_description" style="width: 100%;" placeholder="Trait description"></textarea>
										</div>
									</div>
								</div>
							</fieldset>
						</div>
						<div class="sheet-reverseFoldable sheet-sectionContainer">
							<input type="hidden" name="attr_all_traits" />
							<span class="sheet-replicateInput sheet-contentSummary" name="attr_all_traits"></span>
						</div>
					</div>
					<!-- Features -->
					<!-- as a repeating section -->
					<div>
						<div class="sheet-sectionTitle">
							<span class="sheet-sectionTitle">Discipline & Class features</span>
							<input type="checkbox" name="attr_feature_fold" class="sheet-folder" />
							<span class="sheet-folder"></span>
						</div>
						<input type="hidden" name="attr_feature_fold" class="sheet-folder" />
						<div class="sheet-foldable sheet-sectionContainer">
							<fieldset class="repeating_features">
								<div>
									<div class="sheet-repeatingFeature">
										<div>
											<input type="text" name="attr_feature_name" title="Feature name" placeholder="Feature name" />
											<input type="text" name="attr_feature_discipline" title="Feature discipline" placeholder="Discipline" />
											<input type="checkbox" name="attr_feature_fold" class="sheet-folder" />
											<span class="sheet-folder"></span>
										</div>
										<!-- Text area for feature description -->
										<input type="hidden" name="attr_feature_fold" class="sheet-folder" />
										<div class="sheet-foldable">
											<div>
												<input type="text" name="attr_feature_class" title="Class" placeholder="Class" />
												<input type="number" name="attr_feature_level" title="Feature level" value="1" />
											</div>
											<textarea name="attr_feature_description" style="width: 100%;" placeholder="Feature description"></textarea>
										</div>
									</div>
								</div>
							</fieldset>
						</div>
						<div class="sheet-reverseFoldable sheet-sectionContainer">
							<input type="hidden" name="attr_all_features" />
							<span class="sheet-replicateInput sheet-contentSummary" name="attr_all_features"></span>
						</div>
					</div>
				</div>
				<input type="hidden" name="attr_all_quirks_traits_features" />
				<div class="sheet-reverseFoldable sheet-sectionContainer">
					<span class="sheet-replicateInput sheet-contentSummary" name="attr_all_quirks_traits_features"></span>
				</div>
			</div>

			<!-- Character Equipment -->
			<div style="flex-flow: column; flex: 1 1 auto;">
				<div class="sheet-sectionTitle">
					<span class="sheet-sectionTitle">Equipment</span>
					<div style="flex: 1 0 auto; display: flex; justify-content: center; gap: 4px;">
						<span class="sheet-sectionTitle">Cred</span>
						<input type="number" name="attr_equipment_cred" value="0" />
					</div>
					<input type="hidden" name="attr_equipment_weight_label" value="0/8" />
					<span class="sheet-sectionTitle" name="attr_equipment_weight_label"></span>
					<input type="checkbox" name="attr_equipment_fold" class="sheet-folder" />
					<span class="sheet-folder"></span>
				</div>
				<input type="hidden" name="attr_equipment_fold" class="sheet-folder" />
				<div class="sheet-sectionContainer sheet-foldable">
					<fieldset class="repeating_equipment">
						<div>
							<div class="sheet-repeatingEquipment">
								<div>
									<input type="text" name="attr_equipment_name" title="Equipment name" placeholder="Equipment name" />
									<input type="number" name="attr_equipment_weight" title="Equipment weight" value="0" />
									<input type="number" name="attr_equipment_quantity" title="Equipment quantity" value="1" />
									<input type="checkbox" name="attr_equipment_fold" class="sheet-folder" />
									<span class="sheet-folder"></span>
								</div>
								<!-- Text area for equipment description -->
								<input type="hidden" name="attr_equipment_fold" class="sheet-folder" />
								<div class="sheet-foldable">
									<textarea name="attr_equipment_description" style="width: 100%;" placeholder="Equipment description"></textarea>
								</div>
							</div>
						</div>
					</fieldset>
				</div>
				<div class="sheet-reverseFoldable sheet-sectionContainer">
					<input type="hidden" name="attr_all_equipment" />
					<span class="sheet-replicateInput sheet-contentSummary" name="attr_all_equipment"></span>
				</div>
			</div>
		</div>
	</div>

	<div class="sheet-combat sheet-tab">
		<h1>Combat</h1>

		<!-- Player Info -->
		<div class="sheet-playerinfo sheet-botSpace">
			<!-- <div><span>Player Name :</span><input type="text" name="attr_player_name"/></div> -->
			<div>
				<div style="display: flex; flex: 1 0 auto;"><span>Character Name :</span><input type="text" name="attr_character_name"/></div>
				<div style="flex-shrink: 0; width: 183px;">
					<span>Level :</span><input type="number" name="attr_character_level" style="text-align: end;" value="1" />
					<span>(</span><input type="number" name="attr_character_xp" /><span>) exp</span>
				</div>
			</div>
			<div>
				<div style="display: flex; flex: 1 0 auto;"><span>Lifeform :</span><input type="text" name="attr_character_lifeform"/></div>
				<div style="flex-shrink: 0; width: 183px; display: flex;">
					<span style="flex-shrink: 0;">Grade :</span>
					<input type="hidden" class="sheet-adventuringRank" name="attr_adventuring_grade" value="copper" />
					<span class="sheet-adventuringRank sheet-replicateInput" name="attr_adventuring_grade"></span>
				</div>
			</div>
			<div><span>⬖ Primary Class :</span><input type="text" name="attr_character_primary_class"/></div>
			<div><span>⬗ Secondary Class :</span><input type="text" name="attr_character_secondary_class"/></div>
		</div>

		<!-- Stat pills -->
		<div style="align-items: center; flex-flow: row wrap; justify-content: space-evenly;">
			<!-- Fond memories -->
			<div class="sheet-statPill">
				<div class="sheet-sectionTitle">
					<span>Fond</span>
					<span style="font-size: small;">Memories</span>
				</div>
				<div>
					<input type="number" style="text-align: center;" name="attr_fond_memories" value="0" />
					<div style="display: flex;
					flex-flow: column;
					height: auto;
					border: 0;
					border-radius: 0;
					padding: 0;
					margin-right: 2px;">
						<span>Max</span>
						<span style="text-align: center; font-weight: bold;">50</span>
					</div>
				</div>
			</div>
			<!-- Mastery bonus -->
			<div class="sheet-statPill">
				<div class="sheet-sectionTitle">
					<span style="font-size: small;">Mastery</span>
					<span>Bonus</span>
				</div>
				<div>
					<span style="font-size: x-large; font-weight: bold;">+</span>
					<input type="hidden" name="attr_mastery_bonus" value="2" />
					<span class="sheet-replicateInput" name="attr_mastery_bonus" style="width: 3em;"></span>
				</div>
			</div>
			<!-- Destiny End Points -->
			<div class="sheet-statPill">
				<div class="sheet-sectionTitle">
					<span>Destiny's</span>
					<span style="font-size: small;">End Points</span>
				</div>
				<div>
					<input type="number" style="text-align: center;" name="attr_destiny_current" value="0" />
					<div style="display: flex;
					flex-flow: column;
					height: auto;
					border: 0;
					border-radius: 0;
					padding: 0;
					margin-right: 2px;">
						<span>Max</span>
						<span style="text-align: center; font-weight: bold;">12</span>
					</div>
				</div>
			</div>
		</div>

		<!-- Combat stats -->
		<div>
			<!-- Resolve HP MP -->
			<div>
				<div  style="display: flex; flex-flow: row wrap; gap: 4px; justify-content: space-evenly;">
					<div class="sheet-guardPoint">
						<div class="sheet-sectionTitle">
							<span>Spirit</span>
							<div>
								<input type="checkbox" name="attr_spirit1" />
								<input type="checkbox" name="attr_spirit2" />
								<input type="checkbox" name="attr_spirit3" />
								<input type="checkbox" name="attr_spirit4" />
								<input type="checkbox" name="attr_spirit5" />
							</div>
						</div>
						<div class="sheet-sectionTitle">
							<span>Resolve Points</span>
							<input type="checkbox" name="attr_resolve_fold" class="sheet-folder" />
							<span class="sheet-folder"></span>
						</div>
						<div class="sheet-extendedCounterPoint">
							<input type="hidden" name="attr_resolve_fold" class="sheet-folder" />
							<div class="sheet-counterPoint">
								<div class="sheet-inputPoint">
									<input type="number" name="attr_resolve_current" value="30" />
								</div>
								<div>
									<span>Max Resolve</span>
									<input type="hidden" name="attr_resolve_max" value="30" />
									<span class="sheet-replicateInput" name="attr_resolve_max"></span>
								</div>
							</div>
							<div class="sheet-foldable">
								<div>
									<span>Max Resolve Bonus</span>
									<input type="number" name="attr_added_resolve" value="0" />
								</div>
							</div>
						</div>
					</div>
					<div class="sheet-guardPoint">
						<div class="sheet-sectionTitle">
							<span>Barrier</span>
							<div>
								<input type="checkbox" name="attr_barrier1" />
								<input type="checkbox" name="attr_barrier2" />
								<input type="checkbox" name="attr_barrier3" />
							</div>
						</div>
						<div class="sheet-sectionTitle">
							<span>Hit Points</span>
							<input type="checkbox" name="attr_hp_fold" class="sheet-folder" />
							<span class="sheet-folder"></span>
						</div>
						<div class="sheet-extendedCounterPoint">
							<input type="hidden" name="attr_hp_fold" class="sheet-folder" />
							<div class="sheet-counterPoint">
								<div class="sheet-inputPoint">
									<input type="number" name="attr_hp_current" value="15" />
								</div>
								<div>
									<span>Max HP</span>
									<input type="hidden" name="attr_hp_max" value="15" />
									<span class="sheet-replicateInput" name="attr_hp_max"></span>
								</div>
							</div>
							<div class="sheet-foldable">
								<div>
									<span>Unarmored Toughness</span>
									<input type="checkbox" name="attr_unarmored_toughness" />
								</div>
								<div>
									<span>Armor HP</span>
									<input type="number" name="attr_armor_hp" value="0" />
								</div>
								<div>
									<span>Max HP Bonus</span>
									<input type="number" name="attr_added_hp" value="0" />
								</div>
							</div>
						</div>
					</div>
					<div class="sheet-guardPoint">
						<div class="sheet-sectionTitle">
							<span>Spellglyphs</span>
							<div>
								<input type="checkbox" name="attr_glyph1" />
								<input type="checkbox" name="attr_glyph2" />
								<input type="checkbox" name="attr_glyph3" />
							</div>
						</div>
						<div class="sheet-sectionTitle">
							<span>Mind Points</span>
							<input type="checkbox" name="attr_mp_fold" class="sheet-folder" />
							<span class="sheet-folder"></span>
						</div>
						<div class="sheet-extendedCounterPoint">
							<input type="hidden" name="attr_mp_fold" class="sheet-folder" />
							<div class="sheet-counterPoint">
								<div class="sheet-inputPoint">
									<input type="number" name="attr_mp_current" value="15" />
								</div>
								<div>
									<span>Max MP</span>
									<input type="hidden" name="attr_mp_max" value="15" />
									<span class="sheet-replicateInput" name="attr_mp_max"></span>
								</div>
							</div>
							<div class="sheet-foldable">
								<div>
									<span>Max MP Bonus</span>
									<input type="number" name="attr_added_mp" value="0" />
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>

			<div>
				<!-- Defense -->
				<!-- Fortitude -->
				<!-- Willpower -->
			</div>

			<div>
				<!-- Turn speed -->
				<div>

				</div>
				<!-- Movement -->
				<div>

				</div>
			</div>

			<!-- Combat Actions -->
			<div>
				<!-- Major Action is flex 1 height wise -->
				<div>

				</div>
				<!-- Minor Action is flex 0 height wise -->
				<div>

				</div>
			</div>
		</div>

		<!-- Combat options-->
		<div class="sheet-botSpace">
			<!-- Combat masteries -->
			<div></div>
			<!-- Attacks & Effects -->
			<div></div>
		</div>

		<!-- Quirks, Traits, Features -->
		<div style="flex-flow: column;">
			<div class="sheet-sectionTitle">
				<span class="sheet-sectionTitle" style="flex: 1 1 auto;">Traits & Features</span>
				<input type="checkbox" name="attr_all_traits_fold" class="sheet-folder" />
				<span class="sheet-folder"></span>
			</div>
			<input type="hidden" name="attr_all_traits_fold" class="sheet-folder" />
			<div class="sheet-sectionContainer sheet-foldable" style="gap: 4px;">
				<div>
					<!-- Quirks -->
					<!-- as a repeating section -->
					<div class="sheet-sectionTitle">
						<span class="sheet-sectionTitle">Quirks</span>
						<input type="checkbox" name="attr_quirk_trait_fold" class="sheet-folder" />
						<span class="sheet-folder"></span>
					</div>
					<input type="hidden" name="attr_quirk_trait_fold" class="sheet-folder" />
					<div class="sheet-foldable sheet-sectionContainer">
						<fieldset class="repeating_quirks">
							<div>
								<div>
									<input type="text" name="attr_quirk_name" title="Quirk name" placeholder="Quirk name" />
									<input type="number" name="attr_quirk_level" title="Quirk level" value="1" />
									<input type="checkbox" name="attr_quirk_fold" class="sheet-folder" />
									<span class="sheet-folder"></span>
								</div>
								<!-- Text area for quirk description -->
								<input type="hidden" name="attr_quirk_fold" class="sheet-folder" />
								<div class="sheet-foldable">
									<textarea name="attr_quirk_description" style="width: 100%;"></textarea>
								</div>
							</div>
						</fieldset>
					</div>
					<div class="sheet-reverseFoldable sheet-sectionContainer">
						<input type="hidden" name="attr_all_quirks" />
						<span class="sheet-replicateInput sheet-contentSummary" name="attr_all_quirks"></span>
					</div>
				</div>
				<div>
					<!-- Traits -->
					<!-- as a repeating section -->
					<div class="sheet-sectionTitle">
						<span class="sheet-sectionTitle">Lifeform traits</span>
						<input type="checkbox" name="attr_trait_fold" class="sheet-folder" />
						<span class="sheet-folder"></span>
					</div>
					<input type="hidden" name="attr_trait_fold" class="sheet-folder" />
					<div class="sheet-foldable sheet-sectionContainer">
						<fieldset class="repeating_traits">
							<div>
								<div class="sheet-repeatingTrait">
									<div>
										<input type="text" name="attr_trait_name" title="Trait name" placeholder="Trait name" />
										<input type="text" name="attr_trait_lifeform" title="Lifeform" placeholder="Lifeform" />
										<input type="checkbox" name="attr_trait_fold" class="sheet-folder" />
										<span class="sheet-folder"></span>
									</div>
									<!-- Text area for trait description -->
									<input type="hidden" name="attr_trait_fold" class="sheet-folder" />
									<div class="sheet-foldable">
										<select name="attr_trait_type" title="Trait type">
											<option value="major">Major</option>
											<option value="minor">Minor</option>
											<option value="xtra">Xtra</option>
										</select>
										<textarea name="attr_trait_description" style="width: 100%;" placeholder="Trait description"></textarea>
									</div>
								</div>
							</div>
						</fieldset>
					</div>
					<div class="sheet-reverseFoldable sheet-sectionContainer">
						<input type="hidden" name="attr_all_traits" />
						<span class="sheet-replicateInput sheet-contentSummary" name="attr_all_traits"></span>
					</div>
				</div>
				<!-- Features -->
				<!-- as a repeating section -->
				<div>
					<div class="sheet-sectionTitle">
						<span class="sheet-sectionTitle">Discipline & Class features</span>
						<input type="checkbox" name="attr_feature_fold" class="sheet-folder" />
						<span class="sheet-folder"></span>
					</div>
					<input type="hidden" name="attr_feature_fold" class="sheet-folder" />
					<div class="sheet-foldable sheet-sectionContainer">
						<fieldset class="repeating_features">
							<div>
								<div class="sheet-repeatingFeature">
									<div>
										<input type="text" name="attr_feature_name" title="Feature name" placeholder="Feature name" />
										<input type="text" name="attr_feature_discipline" title="Feature discipline" placeholder="Discipline" />
										<input type="checkbox" name="attr_feature_fold" class="sheet-folder" />
										<span class="sheet-folder"></span>
									</div>
									<!-- Text area for feature description -->
									<input type="hidden" name="attr_feature_fold" class="sheet-folder" />
									<div class="sheet-foldable">
										<div>
											<input type="text" name="attr_feature_class" title="Class" placeholder="Class" />
											<input type="number" name="attr_feature_level" title="Feature level" value="1" />
										</div>
										<textarea name="attr_feature_description" style="width: 100%;" placeholder="Feature description"></textarea>
									</div>
								</div>
							</div>
						</fieldset>
					</div>
					<div class="sheet-reverseFoldable sheet-sectionContainer">
						<input type="hidden" name="attr_all_features" />
						<span class="sheet-replicateInput sheet-contentSummary" name="attr_all_features"></span>
					</div>
				</div>
			</div>
			<input type="hidden" name="attr_all_quirks_traits_features" />
			<div class="sheet-reverseFoldable sheet-sectionContainer">
				<span class="sheet-replicateInput sheet-contentSummary" name="attr_all_quirks_traits_features"></span>
			</div>
		</div>
	</div>

	<div class="sheet-magic sheet-tab">
		<h1>Magic</h1>

		<div>
			<div></div>
			<div>
				<div class="sheet-sectionTitle">
					<span class="sheet-sectionTitle">Castable spells</span>
					<input type="checkbox" name="attr_spellcasting_fold" class="sheet-folder" />
					<span class="sheet-folder"></span>
				</div>
				<input type="hidden" name="attr_spellcasting_fold" class="sheet-folder" />
				<div class="sheet-sectionContainer sheet-foldable">
					<!-- Arcane Spells -->
					<div>
						<div class="sheet-sectionTitle">
							<span class="sheet-sectionTitle">Arcane Spells</span>
							<input type="checkbox" name="attr_arcane_spells_fold" class="sheet-folder" />
							<span class="sheet-folder"></span>
						</div>
						<input type="hidden" name="attr_arcane_spells_fold" class="sheet-folder" />
						<div class="sheet-sectionContainer sheet-foldable">
							<fieldset class="repeating_spells">
								<div class="sheet-repeatingSpell">
									<input type="hidden" name="attr_spell_rank_0" value="0" />
									<input type="hidden" name="attr_spell_rank_1" value="0" />
									<input type="hidden" name="attr_spell_rank_2" value="0" />
									<input type="hidden" name="attr_spell_rank_3" value="0" />
									<div class="sheet-spellName">
										<input type="text" name="attr_spell_name" title="Spell name" placeholder="Spell name" />
										<input type="checkbox" name="attr_spell_name_fold" class="sheet-folder" />
										<span class="sheet-folder"></span>
									</div>
									<input type="hidden" name="attr_spell_name_fold" class="sheet-folder" />
									<div class="sheet-spellContainer sheet-foldable">
										<div>
											<input type="text" name="attr_spell_attunement" title="Spell attunement" placeholder="Attunement" />
											<select name="attr_spell_glyph" title="Glyph">
												<option value="0">Yes</option>
												<option value="1">No</option>
											</select>
											<div>
												<span>Requirement:</span>
												<input type="text" name="attr_spell_requirement" title="Spell requirement" placeholder="Mov, Verb, M.Wpn" value="Mov, Verb, M.Wpn" />
											</div>
											<select name="attr_spell_action" title="Action">
												<option value="0">Major</option>
												<option value="1">Minor</option>
												<option value="2">Free</option>
												<option value="3">Instant</option>
											</select>
											<textarea name="attr_spell_effect" placeholder="Spell effect"></textarea>
											<div>
												<span>Levels</span>
												<input type="checkbox" name="attr_spell_rank_0" />
												<input type="checkbox" name="attr_spell_rank_1" />
												<input type="checkbox" name="attr_spell_rank_2" />
												<input type="checkbox" name="attr_spell_rank_3" />
											</div>
										</div>
										<div class="sheet-spellRank">
											<div class="sheet-spellTitle">
												<span class="sheet-spellTitle">Rank 0</span>
												<span class="sheet-spellSubTitle">(Level 1+)</span>
												<span class="sheet-spellTitle">MP:</span>
												<input type="number" class="sheet-foldable" name="attr_spell_rank_zero_mp" title="Spell MP" value="1" />
												<span class="sheet-spellTitle sheet-reverseFoldable" name="attr_spell_rank_zero_mp"></span>
												<input type="checkbox" name="attr_spell_zero_fold" class="sheet-folder" />
												<span class="sheet-folder"></span>
											</div>
											<input type="hidden" name="attr_spell_zero_fold" class="sheet-folder" />
											<div class="sheet-foldable">
												<div>
													<input type="text" name="attr_spell_rank_zero_range" title="Spell range" placeholder="0-3" />
													<input type="text" name="attr_spell_rank_zero_duration" title="Spell target" placeholder="5 min (Focus)" />
												</div>
												<div>
													<textarea name="attr_spell_rank_zero_description" placeholder="Spell description"></textarea>
												</div>
											</div>
										</div>
										<div class="sheet-spellRank">
											<div class="sheet-spellTitle">
												<span class="sheet-spellTitle">Rank 1</span>
												<span class="sheet-spellSubTitle">(Level 1+)</span>
												<span class="sheet-spellTitle">MP:</span>
												<input type="number" class="sheet-foldable" name="attr_spell_rank_one_mp" title="Spell MP" value="2" />
												<span class="sheet-spellTitle sheet-reverseFoldable" name="attr_spell_rank_one_mp"></span>
												<input type="checkbox" name="attr_spell_rank_one_fold" class="sheet-folder" />
												<span class="sheet-folder"></span>
											</div>
											<input type="hidden" name="attr_spell_rank_one_fold" class="sheet-folder" />
											<div class="sheet-foldable">
												<div>
													<input type="text" name="attr_spell_rank_one_range" title="Spell range" placeholder="0-3" />
													<input type="text" name="attr_spell_rank_one_duration" title="Spell target" placeholder="5 min (Focus)" />
												</div>
												<div>
													<textarea name="attr_spell_rank_one_description" placeholder="Spell description"></textarea>
												</div>
											</div>
										</div>
										<div class="sheet-spellRank">
											<div class="sheet-spellTitle">
												<span class="sheet-spellTitle">Rank 2</span>
												<span class="sheet-spellSubTitle">(Level 5+)</span>
												<span class="sheet-spellTitle">MP:</span>
												<input type="number" class="sheet-foldable" name="attr_spell_rank_two_mp" title="Spell MP" value="3" />
												<span class="sheet-spellTitle sheet-reverseFoldable" name="attr_spell_rank_two_mp"></span>
												<input type="checkbox" name="attr_spell_rank_two_fold" class="sheet-folder" />
												<span class="sheet-folder"></span>
											</div>
											<input type="hidden" name="attr_spell_rank_two_fold" class="sheet-folder" />
											<div class="sheet-foldable">
												<div>
													<input type="text" name="attr_spell_rank_two_range" title="Spell range" placeholder="0-3" />
													<input type="text" name="attr_spell_rank_two_duration" title="Spell target" placeholder="5 min (Focus)" />
												</div>
												<div>
													<textarea name="attr_spell_rank_two_description" placeholder="Spell description"></textarea>
												</div>
											</div>
										</div>
										<div class="sheet-spellRank">
											<div class="sheet-spellTitle">
												<span class="sheet-spellTitle">Rank 3</span>
												<span class="sheet-spellSubTitle">(Level 9+)</span>
												<span class="sheet-spellTitle">MP:</span>
												<input type="number" class="sheet-foldable" name="attr_spell_rank_three_mp" title="Spell MP" value="4" />
												<span class="sheet-spellTitle sheet-reverseFoldable" name="attr_spell_rank_three_mp"></span>
												<input type="checkbox" name="attr_spell_rank_three_fold" class="sheet-folder" />
												<span class="sheet-folder"></span>
											</div>
											<input type="hidden" name="attr_spell_rank_three_fold" class="sheet-folder" />
											<div class="sheet-foldable">
												<div>
													<input type="text" name="attr_spell_rank_three_range" title="Spell range" placeholder="0-3" />
													<input type="text" name="attr_spell_rank_three_duration" title="Spell target" placeholder="5 min (Focus)" />
												</div>
												<div>
													<textarea name="attr_spell_rank_three_description" placeholder="Spell description"></textarea>
												</div>
											</div>
										</div>
									</div>
								</div>
							</fieldset>
						</div>
					</div>

					<!-- Cosmic Spells -->
					<div>
						<div class="sheet-sectionTitle">
							<span class="sheet-sectionTitle">Cosmic Spells</span>
							<input type="checkbox" name="attr_cosmic_spells_fold" class="sheet-folder" />
							<span class="sheet-folder"></span>
						</div>
						<input type="hidden" name="attr_cosmic_spells_fold" class="sheet-folder" />
						<div class="sheet-sectionContainer sheet-foldable">
							<fieldset class="repeating_spells">
								<div class="sheet-repeatingSpell">
									<input type="hidden" name="attr_spell_rank_0" value="0" />
									<input type="hidden" name="attr_spell_rank_1" value="0" />
									<input type="hidden" name="attr_spell_rank_2" value="0" />
									<input type="hidden" name="attr_spell_rank_3" value="0" />
									<div class="sheet-spellName">
										<input type="text" name="attr_spell_name" title="Spell name" placeholder="Spell name" />
										<input type="checkbox" name="attr_spell_name_fold" class="sheet-folder" />
										<span class="sheet-folder"></span>
									</div>
									<input type="hidden" name="attr_spell_name_fold" class="sheet-folder" />
									<div class="sheet-spellContainer sheet-foldable">
										<div>
											<input type="text" name="attr_spell_attunement" title="Spell attunement" placeholder="Attunement" />
											<select name="attr_spell_glyph" title="Glyph">
												<option value="0">Yes</option>
												<option value="1">No</option>
											</select>
											<div>
												<span>Requirement:</span>
												<input type="text" name="attr_spell_requirement" title="Spell requirement" placeholder="Mov, Verb, M.Wpn" value="Mov, Verb, M.Wpn" />
											</div>
											<select name="attr_spell_action" title="Action">
												<option value="0">Major</option>
												<option value="1">Minor</option>
												<option value="2">Free</option>
												<option value="3">Instant</option>
											</select>
											<textarea name="attr_spell_effect" placeholder="Spell effect"></textarea>
											<div>
												<span>Levels</span>
												<input type="checkbox" name="attr_spell_rank_0" />
												<input type="checkbox" name="attr_spell_rank_1" />
												<input type="checkbox" name="attr_spell_rank_2" />
												<input type="checkbox" name="attr_spell_rank_3" />
											</div>
										</div>
										<div class="sheet-spellRank">
											<div class="sheet-spellTitle">
												<span class="sheet-spellTitle">Rank 0</span>
												<span class="sheet-spellSubTitle">(Level 1+)</span>
												<span class="sheet-spellTitle">MP:</span>
												<input type="number" class="sheet-foldable" name="attr_spell_rank_zero_mp" title="Spell MP" value="1" />
												<span class="sheet-spellTitle sheet-reverseFoldable" name="attr_spell_rank_zero_mp"></span>
												<input type="checkbox" name="attr_spell_zero_fold" class="sheet-folder" />
												<span class="sheet-folder"></span>
											</div>
											<input type="hidden" name="attr_spell_zero_fold" class="sheet-folder" />
											<div class="sheet-foldable">
												<div>
													<input type="text" name="attr_spell_rank_zero_range" title="Spell range" placeholder="0-3" />
													<input type="text" name="attr_spell_rank_zero_duration" title="Spell target" placeholder="5 min (Focus)" />
												</div>
												<div>
													<textarea name="attr_spell_rank_zero_description" placeholder="Spell description"></textarea>
												</div>
											</div>
										</div>
										<div class="sheet-spellRank">
											<div class="sheet-spellTitle">
												<span class="sheet-spellTitle">Rank 1</span>
												<span class="sheet-spellSubTitle">(Level 1+)</span>
												<span class="sheet-spellTitle">MP:</span>
												<input type="number" class="sheet-foldable" name="attr_spell_rank_one_mp" title="Spell MP" value="2" />
												<span class="sheet-spellTitle sheet-reverseFoldable" name="attr_spell_rank_one_mp"></span>
												<input type="checkbox" name="attr_spell_rank_one_fold" class="sheet-folder" />
												<span class="sheet-folder"></span>
											</div>
											<input type="hidden" name="attr_spell_rank_one_fold" class="sheet-folder" />
											<div class="sheet-foldable">
												<div>
													<input type="text" name="attr_spell_rank_one_range" title="Spell range" placeholder="0-3" />
													<input type="text" name="attr_spell_rank_one_duration" title="Spell target" placeholder="5 min (Focus)" />
												</div>
												<div>
													<textarea name="attr_spell_rank_one_description" placeholder="Spell description"></textarea>
												</div>
											</div>
										</div>
										<div class="sheet-spellRank">
											<div class="sheet-spellTitle">
												<span class="sheet-spellTitle">Rank 2</span>
												<span class="sheet-spellSubTitle">(Level 5+)</span>
												<span class="sheet-spellTitle">MP:</span>
												<input type="number" class="sheet-foldable" name="attr_spell_rank_two_mp" title="Spell MP" value="3" />
												<span class="sheet-spellTitle sheet-reverseFoldable" name="attr_spell_rank_two_mp"></span>
												<input type="checkbox" name="attr_spell_rank_two_fold" class="sheet-folder" />
												<span class="sheet-folder"></span>
											</div>
											<input type="hidden" name="attr_spell_rank_two_fold" class="sheet-folder" />
											<div class="sheet-foldable">
												<div>
													<input type="text" name="attr_spell_rank_two_range" title="Spell range" placeholder="0-3" />
													<input type="text" name="attr_spell_rank_two_duration" title="Spell target" placeholder="5 min (Focus)" />
												</div>
												<div>
													<textarea name="attr_spell_rank_two_description" placeholder="Spell description"></textarea>
												</div>
											</div>
										</div>
										<div class="sheet-spellRank">
											<div class="sheet-spellTitle">
												<span class="sheet-spellTitle">Rank 3</span>
												<span class="sheet-spellSubTitle">(Level 9+)</span>
												<span class="sheet-spellTitle">MP:</span>
												<input type="number" class="sheet-foldable" name="attr_spell_rank_three_mp" title="Spell MP" value="4" />
												<span class="sheet-spellTitle sheet-reverseFoldable" name="attr_spell_rank_three_mp"></span>
												<input type="checkbox" name="attr_spell_rank_three_fold" class="sheet-folder" />
												<span class="sheet-folder"></span>
											</div>
											<input type="hidden" name="attr_spell_rank_three_fold" class="sheet-folder" />
											<div class="sheet-foldable">
												<div>
													<input type="text" name="attr_spell_rank_three_range" title="Spell range" placeholder="0-3" />
													<input type="text" name="attr_spell_rank_three_duration" title="Spell target" placeholder="5 min (Focus)" />
												</div>
												<div>
													<textarea name="attr_spell_rank_three_description" placeholder="Spell description"></textarea>
												</div>
											</div>
										</div>
									</div>
								</div>
							</fieldset>
						</div>
					</div>

					<!-- High Spells -->
					<div>
						<div class="sheet-sectionTitle">
							<span class="sheet-sectionTitle">High Spells</span>
							<input type="checkbox" name="attr_high_spells_fold" class="sheet-folder" />
							<span class="sheet-folder"></span>
						</div>
						<input type="hidden" name="attr_high_spells_fold" class="sheet-folder" />
						<div class="sheet-sectionContainer sheet-foldable">
							<fieldset class="repeating_spells">
								<div class="sheet-repeatingSpell">
									<div class="sheet-spellName">
										<input type="text" name="attr_spell_name" title="Spell name" placeholder="Spell name" />
										<input type="checkbox" name="attr_spell_name_fold" class="sheet-folder" />
										<span class="sheet-folder"></span>
									</div>
									<input type="hidden" name="attr_spell_name_fold" class="sheet-folder" />
									<div class="sheet-spellContainer sheet-foldable">
										<div>
											<input type="text" name="attr_spell_attunement" title="Spell attunement" placeholder="Attunement" />
											<select name="attr_spell_glyph" title="Glyph">
												<option value="0">Yes</option>
												<option value="1">No</option>
											</select>
											<div>
												<span>Requirement:</span>
												<input type="text" name="attr_spell_requirement" title="Spell requirement" placeholder="Mov, Verb, S.Catalyst" value="Mov, Verb, S.Catalyst" />
											</div>
											<select name="attr_spell_action" title="Action">
												<option value="0">Major</option>
												<option value="1">Minor</option>
												<option value="2">Free</option>
												<option value="3">Instant</option>
											</select>
											<textarea name="attr_spell_situation" placeholder="Rare casting situation"></textarea>
											<textarea name="attr_spell_effect" placeholder="Spell effect"></textarea>
										</div>
										<div class="sheet-spellRank">
											<div class="sheet-spellTitle">
												<span class="sheet-spellTitle">Rank 4</span>
												<span class="sheet-spellSubTitle">(Spirit tokens: 3)</span>
												<span class="sheet-spellTitle">MP:</span>
												<input type="number" class="sheet-foldable" name="attr_spell_rank_zero_mp" title="Spell MP" value="0" />
												<span class="sheet-spellTitle sheet-reverseFoldable" name="attr_spell_rank_zero_mp"></span>
												<input type="checkbox" name="attr_spell_zero_fold" class="sheet-folder" />
												<span class="sheet-folder"></span>
											</div>
											<input type="hidden" name="attr_spell_zero_fold" class="sheet-folder" />
											<div class="sheet-foldable">
												<div>
													<input type="text" name="attr_spell_rank_zero_range" title="Spell range" placeholder="0-3" />
													<input type="text" name="attr_spell_rank_zero_duration" title="Spell target" placeholder="5 min (Focus)" />
												</div>
												<div>
													<textarea name="attr_spell_rank_zero_description" placeholder="Spell description"></textarea>
												</div>
											</div>
										</div>
									</div>
								</div>
							</fieldset>
						</div>
					</div>
				</div>
				<div class="sheet-reverseFoldable sheet-sectionContainer">
					<input type="hidden" name="attr_all_spells" />
					<span class="sheet-replicateInput sheet-contentSummary" name="attr_all_spells"></span>
				</div>
			</div>
		</div>
	</div>

	<div class="sheet-notes sheet-tab">
		<h1>Notes</h1>

		<div style="display: flex; flex-flow: row wrap; gap: 4px;">
			<!-- Details -->
				<!-- Background -->
				<!-- Personality -->
				<!-- Appearance -->
				<!-- Goals -->
				<!-- Beliefs -->
				<!-- Relationships -->
					<!-- Family -->
					<!-- Friends -->
					<!-- Enemies -->
				<!-- Hobbies -->
				<!-- Secrets -->
				<!-- Fears -->
				<!-- Hometown -->
				<!-- Current Residence -->
				<!-- Occupation -->

			<!-- Fond Memories & Bonds -->
			<!-- Equipement -->
			<!-- Class Ranks list -->

			<!-- Details -->
			<div class="sheet-details">
				<div class="sheet-sectionTitle">
					<span class="sheet-sectionTitle" style="flex: 1 1 auto;">Details</span>
					<input type="checkbox" name="attr_all_details_fold" class="sheet-folder" />
					<span class="sheet-folder"></span>
				</div>
				<input type="hidden" name="attr_all_details_fold" class="sheet-folder" />
				<div class="sheet-sectionContainer sheet-foldable" style="gap: 4px;">
					<div>
						<div class="sheet-sectionTitle">
							<span class="sheet-sectionTitle">Background</span>
							<input type="checkbox" name="attr_background_fold" class="sheet-folder" />
							<span class="sheet-folder"></span>
						</div>
						<input type="hidden" name="attr_background_fold" class="sheet-folder" />
						<div class="sheet-foldable sheet-sectionContainer">
							<textarea name="attr_background" style="width: 100%;"></textarea>
						</div>
					</div>
					<div>
						<div class="sheet-sectionTitle">
							<span class="sheet-sectionTitle">Personality</span>
							<input type="checkbox" name="attr_personality_fold" class="sheet-folder" />
							<span class="sheet-folder"></span>
						</div>
						<input type="hidden" name="attr_personality_fold" class="sheet-folder" />
						<div class="sheet-foldable sheet-sectionContainer">
							<textarea name="attr_personality" style="width: 100%;"></textarea>
						</div>
					</div>
					<div>
						<div class="sheet-sectionTitle">
							<span class="sheet-sectionTitle">Appearance</span>
							<input type="checkbox" name="attr_appearance_fold" class="sheet-folder" />
							<span class="sheet-folder"></span>
						</div>
						<input type="hidden" name="attr_appearance_fold" class="sheet-folder" />
						<div class="sheet-foldable sheet-sectionContainer">
							<textarea name="attr_appearance" style="width: 100%;"></textarea>
						</div>
					</div>
					<div>
						<div class="sheet-sectionTitle">
							<span class="sheet-sectionTitle">Goals</span>
							<input type="checkbox" name="attr_goals_fold" class="sheet-folder" />
							<span class="sheet-folder"></span>
						</div>
						<input type="hidden" name="attr_goals_fold" class="sheet-folder" />
						<div class="sheet-foldable sheet-sectionContainer">
							<textarea name="attr_goals" style="width: 100%;"></textarea>
						</div>
					</div>
					<div>
						<div class="sheet-sectionTitle">
							<span class="sheet-sectionTitle">Beliefs</span>
							<input type="checkbox" name="attr_beliefs_fold" class="sheet-folder" />
							<span class="sheet-folder"></span>
						</div>
						<input type="hidden" name="attr_beliefs_fold" class="sheet-folder" />
						<div class="sheet-foldable sheet-sectionContainer">
							<textarea name="attr_beliefs" style="width: 100%;"></textarea>
						</div>
					</div>
					<div>
						<div class="sheet-sectionTitle">
							<span class="sheet-sectionTitle">Relationships</span>
							<input type="checkbox" name="attr_relationships_fold" class="sheet-folder" />
							<span class="sheet-folder"></span>
						</div>
						<input type="hidden" name="attr_relationships_fold" class="sheet-folder" />
						<div class="sheet-foldable sheet-sectionContainer" style="gap: 4px;">
							<div>
								<span style="font-weight: bold;">Family</span>
								<textarea name="attr_family" style="width: 100%;"></textarea>
							</div>
							<div>
								<span style="font-weight: bold;">Friends</span>
								<textarea name="attr_friends" style="width: 100%;"></textarea>
							</div>
							<div>
								<span style="font-weight: bold;">Enemies</span>
								<textarea name="attr_enemies" style="width: 100%;"></textarea>
							</div>
						</div>
					</div>
					<div>
						<div class="sheet-sectionTitle">
							<span class="sheet-sectionTitle">Hobbies</span>
							<input type="checkbox" name="attr_hobbies_fold" class="sheet-folder" />
							<span class="sheet-folder"></span>
						</div>
						<input type="hidden" name="attr_hobbies_fold" class="sheet-folder" />
						<div class="sheet-foldable sheet-sectionContainer">
							<textarea name="attr_hobbies" style="width: 100%;"></textarea>
						</div>
					</div>
					<div>
						<div class="sheet-sectionTitle">
							<span class="sheet-sectionTitle">Secrets</span>
							<input type="checkbox" name="attr_secrets_fold" class="sheet-folder" />
							<span class="sheet-folder"></span>
						</div>
						<input type="hidden" name="attr_secrets_fold" class="sheet-folder" />
						<div class="sheet-foldable sheet-sectionContainer">
							<textarea name="attr_secrets" style="width: 100%;"></textarea>
						</div>
					</div>
					<div>
						<div class="sheet-sectionTitle">
							<span class="sheet-sectionTitle">Fears</span>
							<input type="checkbox" name="attr_fears_fold" class="sheet-folder" />
							<span class="sheet-folder"></span>
						</div>
						<input type="hidden" name="attr_fears_fold" class="sheet-folder" />
						<div class="sheet-foldable sheet-sectionContainer">
							<textarea name="attr_fears" style="width: 100%;"></textarea>
						</div>
					</div>
					<div>
						<div class="sheet-sectionTitle">
							<span class="sheet-sectionTitle">Hometown</span>
							<input type="checkbox" name="attr_hometown_fold" class="sheet-folder" />
							<span class="sheet-folder"></span>
						</div>
						<input type="hidden" name="attr_hometown_fold" class="sheet-folder" />
						<div class="sheet-foldable sheet-sectionContainer">
							<textarea name="attr_hometown" style="width: 100%;"></textarea>
						</div>
					</div>
					<div>
						<div class="sheet-sectionTitle">
							<span class="sheet-sectionTitle">Current Residence</span>
							<input type="checkbox" name="attr_residence_fold" class="sheet-folder" />
							<span class="sheet-folder"></span>
						</div>
						<input type="hidden" name="attr_residence_fold" class="sheet-folder" />
						<div class="sheet-foldable sheet-sectionContainer">
							<textarea name="attr_residence" style="width: 100%;"></textarea>
						</div>
					</div>
					<div>
						<div class="sheet-sectionTitle">
							<span class="sheet-sectionTitle">Occupation</span>
							<input type="checkbox" name="attr_occupation_fold" class="sheet-folder" />
							<span class="sheet-folder"></span>
						</div>
						<input type="hidden" name="attr_occupation_fold" class="sheet-folder" />
						<div class="sheet-foldable sheet-sectionContainer">
							<textarea name="attr_occupation" style="width: 100%;"></textarea>
						</div>
					</div>
				</div>
				<div class="sheet-reverseFoldable sheet-sectionContainer">
					<span class="sheet-replicateInput sheet-contentSummary"></span>
				</div>
			</div>

			<!-- Fond Memories & Bonds -->
			<div>
				<input type="hidden" name="attr_bond_amount" value="0" />
				<input type="hidden" name="attr_bond_strength" value="0" />
				<input type="hidden" name="attr_bond_amount_label" value="Bonds: 0
Bond points: 0
Fond memories: 0/50" />
				<div class="sheet-sectionTitle">
					<span class="sheet-sectionTitle" style="flex: 1 1 auto;">Fond Memories & Bonds</span>
					<input type="checkbox" name="attr_all_fond_memories_fold" class="sheet-folder" />
					<span class="sheet-folder"></span>
				</div>
				<div>
					<input type="hidden" name="attr_all_fond_memories_fold" class="sheet-folder" />
					<div class="sheet-sectionContainer sheet-foldable" style="gap: 4px;">
						<div>
							<div class="sheet-sectionTitle">
								<span class="sheet-sectionTitle" style="font-size: small;">Fond Memories</span>
							</div>
							<div class="sheet-sectionContainer" style="flex-flow: row;">
								<input type="number" name="attr_fond_memories" style="text-align: end; flex: 1 1 auto;" value="0" />
								<span>/50</span>
							</div>
						</div>
						<div>
							<div class="sheet-sectionTitle">
								<span class="sheet-sectionTitle" style="font-size: small;">Bonds</span>
							</div>
							<div class="sheet-sectionContainer" style="gap: 4px;">
								<fieldset class="repeating_bonds">
									<div class="sheet-repeatingBond">
										<div>
											<input type="text" name="attr_bond_name" title="Bond name" placeholder="Bond name" />
											<input type="number" name="attr_bond_level" style="text-align: end;" title="Bond level" value="1" />
											<input type="checkbox" name="attr_bond_fold" class="sheet-folder" />
											<span class="sheet-folder"></span>
										</div>
										<!-- Text area for bond description -->
										<input type="hidden" name="attr_bond_fold" class="sheet-folder" />
										<div class="sheet-foldable" style="flex-flow: column wrap;">
											<input type="text" name="attr_bond_type" title="Bond type" placeholder="Bond type" />
											<textarea name="attr_bond_description" style="width: 100%;" placeholder="Bond description"></textarea>
										</div>
									</div>
								</fieldset>
							</div>
						</div>
					</div>
					<div class="sheet-reverseFoldable sheet-sectionContainer">
						<span class="sheet-replicateInput sheet-contentSummary" name="attr_bond_amount_label"></span>
					</div>
				</div>
			</div>

			<!-- Equipement -->
			<div style="flex-flow: column; flex: 1 1 auto;">
				<div class="sheet-sectionTitle">
					<span class="sheet-sectionTitle">Equipment</span>
					<div style="flex: 1 0 auto; display: flex; justify-content: center; gap: 4px;">
						<span class="sheet-sectionTitle">Cred</span>
						<input type="number" name="attr_equipment_cred" value="0" />
					</div>
					<input type="hidden" name="attr_equipment_weight_label" value="0/8" />
					<span class="sheet-sectionTitle" name="attr_equipment_weight_label"></span>
					<input type="checkbox" name="attr_equipment_fold" class="sheet-folder" />
					<span class="sheet-folder"></span>
				</div>
				<input type="hidden" name="attr_equipment_fold" class="sheet-folder" />
				<div class="sheet-sectionContainer sheet-foldable">
					<fieldset class="repeating_equipment">
						<div>
							<div class="sheet-repeatingEquipment">
								<div>
									<input type="text" name="attr_equipment_name" title="Equipment name" placeholder="Equipment name" />
									<input type="number" name="attr_equipment_weight" title="Equipment weight" value="0" />
									<input type="number" name="attr_equipment_quantity" title="Equipment quantity" value="1" />
									<input type="checkbox" name="attr_equipment_fold" class="sheet-folder" />
									<span class="sheet-folder"></span>
								</div>
								<!-- Text area for equipment description -->
								<input type="hidden" name="attr_equipment_fold" class="sheet-folder" />
								<div class="sheet-foldable">
									<textarea name="attr_equipment_description" style="width: 100%;" placeholder="Equipment description"></textarea>
								</div>
							</div>
						</div>
					</fieldset>
				</div>
				<div class="sheet-reverseFoldable sheet-sectionContainer">
					<input type="hidden" name="attr_all_equipment" />
					<span class="sheet-replicateInput sheet-contentSummary" name="attr_all_equipment"></span>
				</div>
			</div>

			<!-- Class Ranks list -->
			<div>
				<div class="sheet-sectionTitle">
					<span class="sheet-sectionTitle" style="flex: 1 1 auto;">Class Ranks</span>
					<input type="checkbox" name="attr_all_class_ranks_fold" class="sheet-folder" />
					<span class="sheet-folder"></span>
				</div>
				<input type="hidden" name="attr_all_class_ranks_fold" class="sheet-folder" />
				<div class="sheet-sectionContainer sheet-foldable" style="gap: 4px;">
					<fieldset class="repeating_ranks">
						<div class="sheet-repeatingRank">
							<div>
								<input type="text" name="attr_rank_name" title="Discipline / Class" placeholder="Discipline / Class" style="flex: 1 1 auto;" />
								<input type="hidden" name="attr_rank_level" />
								<input type="hidden" name="attr_rank_level_label" />
								<span style="font-weight: bold;" name="attr_rank_level_label"></span>
								<input type="checkbox" name="attr_rank_fold" class="sheet-folder" />
								<span class="sheet-folder"></span>
							</div>
							<!-- Text area for rank description -->
							<input type="hidden" name="attr_rank_fold" class="sheet-folder" />
							<div class="sheet-foldable">
								<textarea name="attr_rank_description" style="width: 100%;" placeholder="Rank description"></textarea>
							</div>
						</div>
					</fieldset>
				</div>
				<div class="sheet-reverseFoldable sheet-sectionContainer">
					<input type="hidden" name="attr_all_ranks" />
					<span class="sheet-replicateInput sheet-contentSummary" name="attr_all_ranks"></span>
				</div>
			</div>

			<!-- Notes -->
			<div style="flex: 1 1 auto;">
				<div class="sheet-sectionTitle">
					<span class="sheet-sectionTitle" style="flex: 1 1 auto;">Notes</span>
					<input type="checkbox" name="attr_all_notes_fold" class="sheet-folder" />
					<span class="sheet-folder"></span>
				</div>
				<input type="hidden" name="attr_all_notes_fold" class="sheet-folder" />
				<div class="sheet-sectionContainer sheet-foldable">
					<fieldset class="repeating_notes">
						<div class="sheet-repeatingNote">
							<div>
								<input type="text" name="attr_note_name" title="Note name" placeholder="Note name" />
								<input type="checkbox" name="attr_note_fold" class="sheet-folder" />
								<span class="sheet-folder"></span>
							</div>
							<!-- Text area for note description -->
							<input type="hidden" name="attr_note_fold" class="sheet-folder" />
							<div class="sheet-foldable">
								<textarea name="attr_note_description" placeholder="Note description"></textarea>
							</div>
						</div>
					</fieldset>
				</div>
				<div class="sheet-reverseFoldable sheet-sectionContainer">
					<span class="sheet-replicateInput sheet-contentSummary"></span>
				</div>
			</div>
		</div>
	</div>

	<div class="sheet-options sheet-tab">
		<h1>Options</h1>
		<input type="number" name="attr_attunement_amount" value="0" />
		<input type="number" name="attr_added_quirk" value="0" />
		<input type="number" name="attr_added_slots" value="0" />
	</div>
</div>

<rolltemplate class="sheet-rolltemplate-generic">
	<div class="sheet-template-container">
		<div class="sheet-template-header"><h1>{{charName}} {{rollName}}</h1></div>
		<div class="sheet-template-contents">
			<div class="sheet-template-row">{{rollName}}{{subLabel}} = {{total}}</div>
		</div>
	</div>
</rolltemplate>
</html>
