<!DOCTYPE html>

<script type="text/worker">
	const tabs = [
		"character",
		"combat",
		"magic",
		"notes"
	];
	tabs.forEach(tab => {
		on(`clicked:${tab}`, function() {
			var output = {};

			output["sheetTab"] = tab;

			setAttrs(output, {silent: true});
		});
	});

	on("change:character_level", function() {
		getAttrs(["character_level"], function(v) {
			var output = {};
			var level = parseInt(v["character_level"]);

			output["character_level"] = level < 1 ? 1 : level;
			output["adventuring_grade"] = level > 8 ? "gold" : level > 4 ? "silver" : "copper";

			setAttrs(output, {silent: true});
		});
	});
</script>

<html>
<div class="charsheet">
	<input type="hidden" class="sheet-tabstoggle" name="attr_sheetTab" value="character" />
	<div class="sheet-header">
		<div>
			<button type="action" class="sheet-tabButton" name="act_character">Character</button>
			<button type="action" class="sheet-tabButton" name="act_combat">Combat</button>
			<button type="action" class="sheet-tabButton" name="act_magic">Magic</button>
			<button type="action" class="sheet-tabButton" name="act_notes">Notes</button>
		</div>
		<div class="sheet-flexGrow sheet-flexEnd">
			<select name="attr_rollWhisperType" title="Select roll visibility">
				<option value="" title="Rolls are visible by everyone" selected><span>Show rolls</span></option>
				<option value="?{Whisper?|Public Roll,|Whisper Roll,/w gm }" title="Select your roll visibility each time you roll"><span>Ask each time</span></option>
				<option value="/w gm" title="Only you and the GM will see your rolls"><span>Always whisper</span></option>
			</select>
		</div>
	</div>

	<div class="sheet-character sheet-tab">
		<h1>Character</h1>

		<!-- Player Info -->
		<div class="sheet-playerinfo">
			<div><span>Player Name :</span><input type="text" name="attr_player_name"/></div>
			<div>
				<div style="display: flex; flex-grow: 1; flex-shrink: 0;"><span>Character Name :</span><input type="text" name="attr_character_name"/></div>
				<div style="flex-shrink: 0; width: 183px;">
					<span>Level :</span><input type="number" name="attr_character_level" value="1">
					<span>(</span><input type="number" name="attr_character_xp" /><span>) exp</span>
				</div>
			</div>
			<div>
				<div style="display: flex; flex-grow: 1; flex-shrink: 0;"><span>Lifeform :</span><input type="text" name="attr_character_lifeform"/></div>
				<div style="flex-shrink: 0; width: 183px; display: flex;">
					<span style="flex-shrink: 0;">Grade :</span>
					<input type="hidden" class="sheet-adventuringRank" name="attr_adventuring_grade" value="copper" />
					<span class="sheet-adventuringRank" name="attr_adventuring_grade"/>
				</div>
			</div>
			<div><span>⬖ Primary Class :</span><input type="text" name="attr_character_primary_class"/></div>
			<div><span>⬗ Secondary Class :</span><input type="text" name="attr_character_secondary_class"/></div>
		</div>

		<div>
			<span class="sheet-section-title">Character quirks</span>
			<!-- Quirks (repeating sections) -->
			<fieldset class="repeating_quirks" style="flex-flow: row wrap;">
				<!-- Name + Lvl + foldable section -->
				<div>
					<div>
						<input type="text" name="attr_quirk_name" title="Quirk name" placeholder="Quirk name" />
						<input type="number" name="attr_quirk_level" title="Quirk level" value="1" />
						<!-- TODO : Fold arrow -->
						<input type="checkbox" name="attr_quirk_fold" class="sheet-folder" />
						<span class="sheet-folder"></span>
					</div>
					<!-- Text area for quirk description -->
					<!-- TODO: Add fold arrow for quirk description -->
					<input type="hidden" name="attr_quirk_fold" class="sheet-folder" />
					<div class="sheet-foldable">
						<textarea name="attr_quirk_description" style="width: 100%;"></textarea>
					</div>
				</div>
			</fieldset>
		</div>

		<!-- Character Stats -->
		<div>
			<div>
				<!-- HP/MP -->
				<div></div>
				<!-- Destiny End Points -->
				<div></div>
			</div>
			<div>
				<!-- Mastery bonus -->
				<div></div>
			</div>
			<div>
				<!-- Attributes & Skills tableau -->
				<div></div>
				<!-- Toolkits -->
				<div></div>
			</div>
		</div>

		<!-- Character Equipment -->
		<div>
			<!-- Title & Slots -->
			<div></div>
			<!-- Creds -->
			<div></div>
			<div>
				<!-- Weapons -->
				<div></div>
				<!-- Armor -->
				<div></div>
			</div>
			<div>
				<!-- Accessories -->
				<div></div>
				<!-- Tools -->
				<div></div>
				<!-- Consumables -->
				<div></div>
			</div>
		</div>

		<!-- Traits & Features -->
		<div>
			<!-- Traits -->
			<!-- as a repeating section -->
			<div></div>
			<!-- Features -->
			<!-- as a repeating section -->
			<div></div>
		</div>
	</div>

	<div class="sheet-combat sheet-tab">
		<h1>Combat</h1>
	</div>

	<div class="sheet-magic sheet-tab">
		<h1>Magic</h1>
	</div>

	<div class="sheet-notes sheet-tab">
		<h1>Notes</h1>
	</div>
</div>

<rolltemplate class="sheet-rolltemplate-generic">
	<div class="sheet-template-container">
		<div class="sheet-template-header"><h1>{{charName}} {{rollName}}</h1></div>
		<div class="sheet-template-contents">
			<div class="sheet-template-row">{{rollName}}{{subLabel}} = {{total}}</div>
		</div>
	</div>
</rolltemplate>
</html>
