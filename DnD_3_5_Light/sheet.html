<div class="sheet-container">
    <div class="sheet-line sheet-header">
        <div class="sheet-w1"></div>
        <div class="sheet-w4 sheet-colu sheet-name">
            <input type="text" class="sheet-visible-input" name="attr_character_name">
            <label class="sheet-label">Nom</label>
        </div>
        <div class="sheet-w6 sheet-colu sheet-charbox">
            <div class="sheet-line">
                <div class="sheet-colu sheet-w8">
                    <input type="text" class="sheet-visible-input" name="attr_class_level">
                    <label class="sheet-label">Classes & Niveaux</label>
                </div>
                <div class="sheet-colu sheet-w3">
                    <input type="text" class="sheet-visible-input" name="attr_alignement">
                    <label class="sheet-label">Alignement</label>
                </div>
            </div>
            <div class="sheet-line">
                <div class="sheet-colu sheet-w3">
                    <input type="text" class="sheet-visible-input" name="attr_race">
                    <label class="sheet-label">Race</label>
                </div>
                <div class="sheet-colu sheet-w2">
                    <input type="text" class="sheet-visible-input" name="attr_sexe">
                    <label class="sheet-label">Sexe</label>
                </div>
                <div class="sheet-colu sheet-w2">
                    <input type="text" class="sheet-visible-input" name="attr_peau">
                    <label class="sheet-label">Peau</label>
                </div>
                <div class="sheet-colu sheet-w2">
                    <input type="text" class="sheet-visible-input" name="attr_cheveux">
                    <label class="sheet-label">Cheveux</label>
                </div>
                <div class="sheet-colu sheet-w2">
                    <input type="text" class="sheet-visible-input" name="attr_yeux">
                    <label class="sheet-label">Yeux</label>
                </div>
            </div>
        </div>
        <div class="sheet-w1 sheet-charend"></div>
    </div>
    <input type="hidden" class="sheet-tabstoggle" name="attr_sheetTab" value="main"/>
    <input type="hidden" class="sheet-charactertoogle" name="attr_characterType" value="pc"/>
    <div class="sheet-line sheet-justify-end">
        <button type="action" name="act_character" class="sheet-button0">Principal</button>
        <button type="action" name="act_journal" class="sheet-button1">Bio</button>
        <button type="action" name="act_spells" class="sheet-button2">Sorts</button>
        <button type="action" name="act_configuration" class="sheet-button3">Configuration</button>
    </div>
    <div class="sheet-line sheet-npc">
        <div class="sheet-colu sheet-w6">
            <div class="sheet-colu sheet-cadre sheet-npc-colu">
                <h4 class="sheet-h4">Caractéristiques</h4>
                <div class="sheet-line sheet-justify-center">
                    <div class="sheet-colu sheet-w2">
                        <button type="roll" value="&{template:main} {{titre=Test de Force}} {{subtitle=@{character_name} }} {{Jet=[[1d20+@{for_mod}]]}}"
                                class="sheet-button-label sheet-text-center">FOR
                        </button>
                        <input type="number" class="sheet-w12 sheet-visible-input" name="attr_for_base">
                    </div>
                    <div class="sheet-colu sheet-w2">
                        <button type="roll" value="&{template:main} {{titre=Test de Dextérité}} {{subtitle=@{character_name} }} {{Jet=[[1d20+@{dex_mod}]]}}"
                                class="sheet-button-label sheet-text-center">DEX
                        </button>
                        <input type="number" class="sheet-w12 sheet-visible-input" name="attr_dex_base">
                    </div>
                    <div class="sheet-colu sheet-w2">
                        <button type="roll" value="&{template:main} {{titre=Test de Constitution}} {{subtitle=@{character_name} }} {{Jet=[[1d20+@{con_mod}]]}}"
                                class="sheet-button-label sheet-text-center">CON
                        </button>
                        <input type="number" class="sheet-w12 sheet-visible-input" name="attr_con_base">
                    </div>
                    <div class="sheet-colu sheet-w2">
                        <button type="roll" value="&{template:main} {{titre=Test d'Intelligence}} {{subtitle=@{character_name} }} {{Jet=[[1d20+@{int_mod}]]}}"
                                class="sheet-button-label sheet-text-center">INT
                        </button>
                        <input type="number" class="sheet-w12 sheet-visible-input" name="attr_int_base">
                    </div>
                    <div class="sheet-colu sheet-w2">
                        <button type="roll" value="&{template:main} {{titre=Test de Sagesse}} {{subtitle=@{character_name} }} {{Jet=[[1d20+@{sag_mod}]]}}"
                                class="sheet-button-label sheet-text-center">SAG
                        </button>
                        <input type="number" class="sheet-w12 sheet-visible-input" name="attr_sag_base">
                    </div>
                    <div class="sheet-colu sheet-w2">
                        <button type="roll" value="&{template:main} {{titre=Test de Charisme}} {{subtitle=@{character_name} }} {{Jet=[[1d20+@{cha_mod}]]}}"
                                class="sheet-button-label sheet-text-center">CHA
                        </button>
                        <input type="number" class="sheet-w12 sheet-visible-input" name="attr_cha_base">
                    </div>
                </div>
                <br>
                <h4 class="sheet-h4">Points de vie</h4>
                <div class="sheet-line sheet-justify-center sheet-align-center">

                    <input type="number" class="sheet-visible-input sheet-w2" name="attr_pv" placeholder="actuel">
                    /
                    <input type="number" class="sheet-visible-input sheet-w2" name="attr_pv_max" placeholder="max.">
                    (
                    <input type="number" class="sheet-visible-input sheet-w2" name="attr_pv_temp" placeholder="temp.">
                    )
                    <input type="text" class="sheet-visible-input sheet-w6" name="attr_pv_desc" placeholder="12d8+42">
                </div>
                <br/>
                <h4 class="sheet-h4">Classe d'armure</h4>
                <div class="sheet-line sheet-align-center">
                    <button type="roll"
                            value="&{template:main} {{titre=Classe d'armure}} {{subtitle=@{character_name} }} {{CA=@{npc_ca} }}{{description=@{npc_ca_text} }}"
                            class="sheet-button-label sheet-w3 sheet-text-right">Normal :
                    </button>
                    <input type="number" class="sheet-w2 sheet-visible-input" name="attr_npc_ca">
                    <input type="text" class="sheet-w7 sheet-visible-input" name="attr_npc_ca_text">
                </div>
                <div class="sheet-line sheet-align-center">
                    <button type="roll"
                            value="&{template:main} {{titre=Classe d'armure pris au dépourvu}} {{subtitle=@{character_name} }} {{CA=@{npc_caff} }}{{description=@{npc_caff_text} }}"
                            class="sheet-button-label sheet-w3 sheet-text-right">Au dépourvu :
                    </button>
                    <input type="number" class="sheet-w2 sheet-visible-input" name="attr_npc_caff">
                    <input type="text" class="sheet-w7 sheet-visible-input" name="attr_npc_caff_text">
                </div>
                <div class="sheet-line sheet-align-center">
                    <button type="roll"
                            value="&{template:main} {{titre=Classe d'armure de contact}} {{subtitle=@{character_name} }} {{CA=@{npc_cat} }}{{description=@{npc_cat_text} }}"
                            class="sheet-button-label sheet-w3 sheet-text-right">De contact :
                    </button>
                    <input type="number" class="sheet-w2 sheet-visible-input" name="attr_npc_cat">
                    <input type="text" class="sheet-w7 sheet-visible-input" name="attr_npc_cat_text">
                </div>
                <br>
                <h4 class="sheet-h4">Jets de sauvegarde</h4>
                <div class="sheet-line sheet-save">
                    <label class="sheet-label sheet-w3">Base</label>
                    <label class="sheet-label sheet-w3">Mod.</label>
                    <label class="sheet-label sheet-w6"></label>
                </div>
                <div class="sheet-line sheet-save">
                    <input type="number" class="sheet-input sheet-w3" name="attr_ref_base">
                    <input type="number" class="sheet-input sheet-w3" name="attr_ref_mod">
                    <input type="hidden" name="attr_ref_roll_value"
                           value="&{template:main} {{titre=Test de Réflexes}} {{subtitle=@{character_name} }} {{Jet=[[1d20+@{dex_mod}+@{ref_base}+@{ref_mod}]]}}">
                    <button type="roll" name="attr_ref_roll" value="@{ref_roll_value}"
                            class="sheet-button-label sheet-bold sheet-w6">Réflexes
                    </button>
                </div>
                <div class="sheet-line sheet-save">
                    <input type="number" class="sheet-input sheet-w3" name="attr_vig_base">
                    <input type="number" class="sheet-input sheet-w3" name="attr_vig_mod">
                    <input type="hidden" name="attr_vig_roll_value"
                           value="&{template:main} {{titre=Test de Vigueur}} {{subtitle=@{character_name} }} {{Jet=[[1d20+@{con_mod}+@{vig_base}+@{vig_mod}]]}}">
                    <button type="roll" name="attr_vig_roll" value="@{vig_roll_value}"
                            class="sheet-button-label sheet-bold sheet-w6">Vigueur
                    </button>
                </div>
                <div class="sheet-line sheet-save">
                    <input type="number" class="sheet-input sheet-w3" name="attr_vol_base">
                    <input type="number" class="sheet-input sheet-w3" name="attr_vol_mod">
                    <input type="hidden" name="attr_vol_roll_value"
                           value="&{template:main} {{titre=Test de Volonté}} {{subtitle=@{character_name} }} {{Jet=[[1d20+@{sag_mod}+@{vol_base}+@{vol_mod}]]}}">
                    <button type="roll" name="attr_vol_roll" value="@{vol_roll_value}"
                            class="sheet-button-label sheet-bold sheet-w6">Volonté
                    </button>
                </div>
            </div>
            <div class="sheet-colu sheet-cadre sheet-npc-colu">
                <h4 class="sheet-h4">Capacités spécifiques</h4>
                <fieldset class="repeating_npc-capacite">
                    <div class="sheet-trait">
                        <input class="sheet-options-flag" type="checkbox" name="attr_options-flag"
                               checked><span>y</span>
                        <div class="sheet-line sheet-align-center">
                            <button name="attr_roll" type="roll" value="@{rollvalue}"
                                    class="sheet-button-label sheet-bold sheet-text-left">
                                <span name="attr_name"></span>&nbsp;
                            </button>
                            <input type="hidden" name="attr_rollvalue"
                                   value="&{template:main} {{titre=@{name}}} {{subtitle=@{character_name}}} {{description=@{description}}}">
                        </div>
                        <div class="sheet-colu sheet-options-options sheet-border-bottom">
                            <div class="sheet-line">
                                <label class="sheet-label sheet-text-right sheet-w3"> Nom : </label>
                                <input type="text" class="sheet-visible-input sheet-w9 " name="attr_name">
                            </div>
                            <label class="sheet-label">Description</label>
                            <textarea class="sheet-textarea" name="attr_description"></textarea>
                        </div>
                    </div>
                </fieldset>
                <br>
                <h4 class="sheet-h4">Divers & Notes</h4>
                <div class="sheet-line sheet-align-center sheet-justify-start">
                    <label class="sheet-label sheet-text-right sheet-w1">CR : </label>
                    <div class="sheet-w2">
                        <input type="text" class="sheet-visible-input sheet-text-left" name="attr_npc_cr">
                    </div>
                    <div>(</div>
                    <div class="sheet-w3">
                        <input type="text" class="sheet-visible-input sheet-text-left" name="attr_npc_xp">
                    </div>
                    <div>XP)</div>
                </div>
                <label class="sheet-label">Notes:</label>
                <textarea class="sheet-textarea" name="attr_npc_notes"></textarea>
            </div>
        </div>
        <div class="sheet-colu sheet-w6">
            <div class="sheet-colu sheet-cadre sheet-traits sheet-npc-colu">
                <h4 class="sheet-h4">Actions spécifiques</h4>
                <fieldset class="repeating_npc-actions">
                    <div class="sheet-trait">
                        <input class="sheet-options-flag" type="checkbox" name="attr_options-flag"
                               checked><span>y</span>
                        <div class="sheet-line sheet-align-center">
                            <button name="attr_roll" type="roll" value="@{rollvalue}"
                                    class="sheet-button-label sheet-bold sheet-text-left">
                                <span name="attr_name"></span>&nbsp;
                            </button>
                            <input type="hidden" name="attr_rollvalue"
                                   value="&{template:main} {{titre=@{name}}} {{subtitle=@{character_name}}} {{description=@{description}}}">
                        </div>
                        <div class="sheet-colu sheet-options-options sheet-border-bottom">
                            <div class="sheet-line">
                                <label class="sheet-label sheet-text-right sheet-w3"> Nom : </label>
                                <input type="text" class="sheet-visible-input sheet-w9 " name="attr_name">
                            </div>
                            <label class="sheet-label">Description</label>
                            <textarea class="sheet-textarea" name="attr_description"></textarea>
                        </div>
                    </div>
                </fieldset>
                <h4 class="sheet-h4">Attaques</h4>
                <div class="sheet-line">
                    <div class="sheet-line sheet-w8">
                        <label class="sheet-label-secondary sheet-w7">Nom</label>
                        <label class="sheet-label-secondary sheet-w5 sheet-text-center">Att</label>
                    </div>
                    <label class="sheet-label-secondary sheet-w4 sheet-text-center">Dégats</label>
                </div>
                <fieldset class="repeating_attaques">
                    <div class="sheet-attq">
                        <input class="sheet-options-flag" type="checkbox" name="attr_options-flag" checked><span>y</span>
                        <div class="sheet-line sheet-align-center">
                            <input type="hidden" name="attr_atq-roll-val"
                                   value="&{template:main} {{titre=Attaque avec @{name}}} {{subtitle=@{character_name}}} {{Attaque=[[1d20+@{bba}+@{atq-carac-val}+@{atq-bonus}+@{atq-bonus-2}]]}} {{Dégats=[[@{dgt-base}+@{dgt-carac-val}+@{dgt-bonus}]]}}">
                            <button type="roll" name="attr_atq-roll" value="@{atq-roll-val}"
                                    class="sheet-gray-line sheet-line sheet-bold sheet-w8 sheet-button-label">
                                <span class="sheet-w7" name="attr_name"></span>
                                <span class="sheet-w5 sheet-text-center" name="attr_atq-total"></span>
                            </button>
                            <input type="hidden" name="attr_dgt-roll-val"
                                   value="&{template:main} {{titre=Dégats de @{name}}} {{subtitle=@{character_name}}} {{Dégats=[[@{dgt-base}+@{dgt-carac-val}+@{dgt-bonus}]]}}">
                            <button type="roll" name="attr_attqdgtroll" value="@{dgt-roll-val}"
                                    class="sheet-gray-line sheet-line sheet-bold sheet-w4 sheet-justify-center sheet-button-label">
                                <span name="attr_degats"></span>
                            </button>
                        </div>
                        <div class="sheet-colu sheet-options-options sheet-border-bottom sheet-align-center">
                            <div class="sheet-line sheet-align-center">
                                <label class="attq-label sheet-w3">Nom :</label>
                                <input type="text" class="visible-input sheet-text-left sheet-w9" name="attr_name">
                            </div>
                            <div class="sheet-line sheet-align-center">
                                <label class="attq-label sheet-w3">Atq :</label>
                                <select class="sheet-w3" name="attr_atq-carac">
                                    <option value="-">-</option>
                                    <option value="FOR">FOR</option>
                                    <option value="DEX">DEX</option>
                                </select>
                                +
                                <input type="number" class="sheet-visible-input sheet-w2" name="attr_atq-bonus">
                                +
                                <input type="number" class="sheet-visible-input sheet-w2" name="attr_atq-bonus-2">
                                <input type="hidden" name="attr_atq-total">
                                <input type="hidden" name="attr_atq-carac-val">
                                <input type="hidden" name="attr_degats">
                                <input type="hidden" name="attr_dgt-carac-val">
                            </div>
                            <div class="sheet-line sheet-align-center">
                                <label class="attq-label sheet-w3">Dgt :</label>
                                <input type="text" class="sheet-visible-input sheet-w3" name="attr_dgt-base"
                                       placeholder="1d4">
                                +
                                <select class="sheet-w3" name="attr_dgt-carac">
                                    <option value="-">-</option>
                                    <option value="FOR">FOR</option>
                                    <option value="DEX">DEX</option>
                                    <option value="1,5FOR">1,5 x FOR</option>
                                    <option value="1/2FOR">1/2 xFOR</option>
                                </select>
                                +
                                <input type="number" class="sheet-visible-input sheet-w2" name="attr_dgt-bonus">
                            </div>
                            <div class="sheet-line sheet-align-center">
                                <label class="sheet-attq-label sheet-w3">Portée :</label>
                                <input type="text" class="visible-input sheet-text-left sheet-w9" name="attr_range">
                            </div>
                            <div class="sheet-colu sheet-w12">
                                <label class="sheet-skill-label sheet-w3">Notes :</label>
                                <input type="text" class="visible-input" name="attr_notes">
                            </div>
                        </div>
                    </div>
                </fieldset>
                <div class="sheet-line">
                    <label class="sheet-label-secondary sheet-w3">BBA :</label>
                    <input type="number" class="sheet-visible-input sheet-w9 " name="attr_bba">
                </div>
            </div>
            <div class="sheet-colu sheet-cadre sheet-npc-colu">
                <h4 class="sheet-h4">Compétences</h4>
                <div class="sheet-npc-skills">
                    <fieldset class="repeating_skills">
                        <div class="sheet-skill">
                            <input class="sheet-options-flag" type="checkbox" name="attr_options-flag"
                                   checked><span>y</span>
                            <div class="sheet-line sheet-align-center">
                                <div class="sheet-w12">
                                    <input type="hidden" name="attr_skillrollvalue"
                                           value="&{template:main} {{titre=Test de '@{name}'}} {{subtitle=@{character_name} }} {{Jet=[[1d20+@{total}]]}}">
                                    <button name="attr_skillroll" type="roll" value="@{skillrollvalue}"
                                            class="sheet-button-label sheet-text-left">
                                        <span name="attr_name"></span>&nbsp;<span name="attr_caracname"></span>,&nbsp;&nbsp;
                                    </button>
                                </div>
                            </div>
                            <div class="sheet-colu sheet-options-options sheet-border-bottom">
                                <div class="sheet-line sheet-align-center">
                                    <label class="sheet-skill-label sheet-w4">Nom :</label>
                                    <input type="text" class="visible-input" name="attr_name">
                                </div>
                                <div class="sheet-line sheet-align-center">
                                    <label class="sheet-skill-label sheet-w4">Rangs :</label>
                                    <input type="number" class="sheet-visible-input sheet-w8" name="attr_ranks">
                                </div>
                                <div class="sheet-line sheet-align-center">
                                    <label class="sheet-skill-label sheet-w4">Carac :</label>
                                    <select class="w8" name="attr_carac">
                                        <option value="@{for_mod}">Force</option>
                                        <option value="@{dex_mod}">Dextérité</option>
                                        <option value="@{con_mod}">Constitution</option>
                                        <option value="@{int_mod}">Intelligence</option>
                                        <option value="@{sag_mod}">Sagesse</option>
                                        <option value="@{cha_mod}">Charisme</option>
                                    </select>
                                    <input type="hidden" name="attr_caracname">
                                </div>
                                <div class="sheet-line sheet-align-center">
                                    <label class="sheet-skill-label sheet-w4">Mod :</label>
                                    <input type="number" class="sheet-visible-input sheet-w8" name="attr_mod">
                                </div>
                                <div class="sheet-line sheet-align-center">
                                    <label class="sheet-skill-label sheet-w8">Malus d'armure :</label>
                                    <input type="checkbox" class="sheet-visible-input sheet-w4"
                                           name="attr_has_armor_malus">
                                </div>
                                <div class="sheet-colu">
                                    <label class="sheet-skill-label sheet-w4">Notes :</label>
                                    <input type="text" class="visible-input" name="attr_notes">
                                </div>
                            </div>
                        </div>
                    </fieldset>
                </div>
            </div>
        </div>
    </div>
    <div class="sheet-line sheet-character">
        <div class="sheet-colu sheet-w4">
            <div class="sheet-line sheet-align-start">
                <!-- ATTRIBUTES !-->
                <div class="sheet-colu sheet-attributes">
                    <div class="sheet-colu sheet-attribute">
                        <button type="roll" value="&{template:main} {{titre=Test de Force}} {{subtitle=@{character_name} }} {{Jet=[[1d20+@{for_mod}]]}}"
                                class="sheet-button-label">FORCE
                        </button>
                        <input type="text" class="sheet-input" name="attr_for_mod" readonly>
                        <input type="number" class="sheet-input" name="attr_for_base">
                    </div>
                    <div class="sheet-colu sheet-attribute">
                        <button type="roll" value="&{template:main} {{titre=Test de Dextérité}} {{subtitle=@{character_name} }} {{Jet=[[1d20+@{dex_mod}]]}}"
                                class="sheet-button-label">DEXTÉRITE
                        </button>
                        <input type="text" class="sheet-input" name="attr_dex_mod" readonly>
                        <input type="number" class="sheet-input" name="attr_dex_base">
                    </div>
                    <div class="sheet-colu sheet-attribute">
                        <button type="roll" value="&{template:main} {{titre=Test de Constitution}} {{subtitle=@{character_name} }} {{Jet=[[1d20+@{con_mod}]]}}"
                                class="sheet-button-label">CONSTIT
                        </button>
                        <input type="text" class="sheet-input" name="attr_con_mod" readonly>
                        <input type="number" class="sheet-input" name="attr_con_base">
                    </div>
                    <div class="sheet-colu sheet-attribute">
                        <button type="roll" value="&{template:main} {{titre=Test d'intelligence}} {{subtitle=@{character_name} }} {{Jet=[[1d20+@{int_mod}]]}}"
                                class="sheet-button-label">INTEL
                        </button>
                        <input type="text" class="sheet-input" name="attr_int_mod" readonly>
                        <input type="number" class="sheet-input" name="attr_int_base">
                    </div>
                    <div class="sheet-colu sheet-attribute">
                        <button type="roll" value="&{template:main} {{titre=Test de Sagesse}} {{subtitle=@{character_name} }} {{Jet=[[1d20+@{sag_mod}]]}}"
                                class="sheet-button-label">SAGESSE
                        </button>
                        <input type="text" class="sheet-input" name="attr_sag_mod" readonly>
                        <input type="number" class="sheet-input" name="attr_sag_base">
                    </div>
                    <div class="sheet-colu sheet-attribute">
                        <button type="roll" value="&{template:main} {{titre=Test de Charisme}} {{subtitle=@{character_name} }} {{Jet=[[1d20+@{cha_mod}]]}}"
                                class="sheet-button-label">CHARISME
                        </button>
                        <input type="text" class="sheet-input" name="attr_cha_mod" readonly>
                        <input type="number" class="sheet-input" name="attr_cha_base">
                    </div>
                </div>
                <!-- JDS & Compétences !-->
                <div class="sheet-colu sheet-wa">
                    <div class="sheet-saves sheet-cadre sheet-colu">
                        <h4 class="sheet-h4">Jets de sauvegardes</h4>
                        <div class="sheet-line sheet-save">
                            <label class="sheet-label sheet-w3">Base</label>
                            <label class="sheet-label sheet-w3">Mod.</label>
                            <label class="sheet-label sheet-w6"></label>
                        </div>
                        <div class="sheet-line sheet-save">
                            <input type="number" class="sheet-input sheet-w3" name="attr_ref_base">
                            <input type="number" class="sheet-input sheet-w3" name="attr_ref_mod">
                            <input type="hidden" name="attr_ref_roll_value"
                                   value="&{template:main} {{titre=Test de Réflexes}} {{subtitle=@{character_name} }} {{Jet=[[1d20+@{dex_mod}+@{ref_base}+@{ref_mod}]]}}">
                            <button type="roll" name="attr_ref_roll" value="@{ref_roll_value}"
                                    class="sheet-button-label sheet-bold sheet-w6">Réflexes
                            </button>
                        </div>
                        <div class="sheet-line sheet-save">
                            <input type="number" class="sheet-input sheet-w3" name="attr_vig_base">
                            <input type="number" class="sheet-input sheet-w3" name="attr_vig_mod">
                            <input type="hidden" name="attr_vig_roll_value"
                                   value="&{template:main} {{titre=Test de Vigueur}} {{subtitle=@{character_name} }} {{Jet=[[1d20+@{con_mod}+@{vig_base}+@{vig_mod}]]}}">
                            <button type="roll" name="attr_vig_roll" value="@{vig_roll_value}"
                                    class="sheet-button-label sheet-bold sheet-w6">Vigueur
                            </button>
                        </div>
                        <div class="sheet-line sheet-save">
                            <input type="number" class="sheet-input sheet-w3" name="attr_vol_base">
                            <input type="number" class="sheet-input sheet-w3" name="attr_vol_mod">
                            <input type="hidden" name="attr_vol_roll_value"
                                   value="&{template:main} {{titre=Test de Volonté}} {{subtitle=@{character_name} }} {{Jet=[[1d20+@{sag_mod}+@{vol_base}+@{vol_mod}]]}}">
                            <button type="roll" name="attr_vol_roll" value="@{vol_roll_value}"
                                    class="sheet-button-label sheet-bold sheet-w6">Volonté
                            </button>
                        </div>
                    </div>
                    <div class="sheet-skills sheet-cadre sheet-colu">
                        <h4 class="sheet-h4">Compétences</h4>
                        <div class="sheet-colu">
                            <div class="sheet-line">
                                <label class="sheet-label sheet-w3">Total</label>
                                <label class="sheet-label sheet-w9">Nom</label>
                            </div>
                            <input type="hidden" name="attr_skills_malus">
                            <fieldset class="repeating_skills">
                                <div class="sheet-skill">
                                    <input class="sheet-options-flag" type="checkbox" name="attr_options-flag"
                                           checked><span>y</span>
                                    <div class="sheet-line sheet-align-center">
                                        <input type="number" class="sheet-input sheet-w2" name="attr_total" value="0" readonly>
                                        <div class="wa">
                                            <input type="hidden" name="attr_skillrollvalue"
                                                   value="&{template:main} {{titre=Test de '@{name}'}} {{subtitle=@{character_name} }} {{Jet=[[1d20+@{total}]]}}">
                                            <button name="attr_skillroll" type="roll" value="@{skillrollvalue}"
                                                    class="sheet-button-label sheet-bold sheet-text-left">
                                                <span name="attr_name"></span>&nbsp;<span name="attr_caracname"></span>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="sheet-colu sheet-options-options sheet-border-bottom">
                                        <div class="sheet-line sheet-align-center">
                                            <label class="sheet-skill-label sheet-w4">Nom :</label>
                                            <input type="text" class="visible-input" name="attr_name">
                                        </div>
                                        <div class="sheet-line sheet-align-center">
                                            <label class="sheet-skill-label sheet-w4">Rangs :</label>
                                            <input type="number" class="sheet-visible-input sheet-w8" name="attr_ranks">
                                        </div>
                                        <div class="sheet-line sheet-align-center">
                                            <label class="sheet-skill-label sheet-w4">Carac :</label>
                                            <select class="w8" name="attr_carac">
                                                <option value="@{for_mod}">Force</option>
                                                <option value="@{dex_mod}">Dextérité</option>
                                                <option value="@{con_mod}">Constitution</option>
                                                <option value="@{int_mod}">Intelligence</option>
                                                <option value="@{sag_mod}">Sagesse</option>
                                                <option value="@{cha_mod}">Charisme</option>
                                            </select>
                                            <input type="hidden" name="attr_caracname">
                                        </div>
                                        <div class="sheet-line sheet-align-center">
                                            <label class="sheet-skill-label sheet-w4">Mod :</label>
                                            <input type="number" class="sheet-visible-input sheet-w8" name="attr_mod">
                                        </div>
                                        <div class="sheet-line sheet-align-center">
                                            <label class="sheet-skill-label sheet-w8">Malus d'armure :</label>
                                            <input type="checkbox" class="sheet-visible-input sheet-w4" name="attr_has_armor_malus">
                                        </div>
                                        <div class="sheet-colu">
                                            <label class="sheet-skill-label sheet-w4">Notes :</label>
                                            <input type="text" class="visible-input" name="attr_notes">
                                        </div>
                                    </div>
                                </div>
                            </fieldset>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Autres Maitrises !-->
            <div class="sheet-colu sheet-masteries sheet-cadre-b">
                <h4 class="sheet-h4">Maitrises</h4>
                <div class="sheet-line">
                    <label class="sheet-label sheet-text-center sheet-w4">Type</label>
                    <label class="sheet-label sheet-text-left sheet-wa">Description</label>
                    <span class="sheet-picto sheet-invisible">w</span>

                </div>
                <fieldset class="repeating_masteries">
                    <div class="sheet-line">
                        <input type="text" class="sheet-visible-input sheet-text-center sheet-w4"
                               name="attr_mastery-type">
                        <input type="text" class="sheet-visible-input sheet-wa" name="attr_mastery-desc">
                        <input type="hidden" name="attr_masteryrollvalue"
                               value="&{template:main} {{titre=Maitrise (@{mastery-type})}} {{subtitle=@{character_name} }} {{description=@{mastery-desc}}}">
                        <button name="attr_skillroll" type="roll" value="@{masteryrollvalue}"
                                class="sheet-button-roll sheet-picto">w
                        </button>
                    </div>
                </fieldset>

            </div>
        </div>
        <div class="sheet-colu sheet-w4">
            <div class="sheet-colu sheet-gray-bg-b">
                <!-- AC Récapitulatif !-->
                <div class="sheet-line sheet-AC-Recap">
                    <div class="w4 sheet-AC">
                        <input type="number" class="sheet-input" name="attr_ac_tot" readonly>
                        <label class="sheet-label">Classe d'armure</label>
                    </div>
                    <div class="w4 sheet-AC">
                        <input type="number" class="sheet-input" name="attr_ac_tot_ff" readonly>
                        <label class="sheet-label">Pris au Dépourvu</label>
                    </div>
                    <div class="w4 sheet-AC">
                        <input type="number" class="sheet-input" name="attr_ac_tot_t" readonly>
                        <label class="sheet-label">CA de<br>contact</label>
                    </div>
                </div>
                <!-- Init Rd Vitesse  !-->
                <div class="sheet-line sheet-stats">
                    <div class="w4 sheet-stat">
                        <input type="number" class="sheet-input" name="attr_init_tot" step="0.01" readonly>
                        <input type="hidden" name="attr_init_rol_value" value="&{template:main} {{titre=Initiative}} {{subtitle=@{character_name}}} {{Jet=[[1D20+@{init_tot} &{tracker}]]}}">
                        <button name="attr_init_roll" type="roll" value="@{init_rol_value}"
                                class="sheet-button-label sheet-bold sheet-text-center">
                            Initiative
                        </button>
                    </div>
                    <div class="w4 sheet-stat">
                        <input type="number" class="sheet-input" name="attr_rd">
                        <label class="sheet-label">RD</label>
                    </div>
                    <div class="w4 sheet-stat">
                        <input type="number" class="sheet-input" name="attr_vit">
                        <label class="sheet-label">Vitesse</label>
                    </div>
                </div>

                <div class="sheet-colu sheet-HP sheet-cadre-ct">
                    <div class="sheet-line sheet-justify-center sheet-align-center">
                        <label class="sheet-label-secondary sheet-text-right sheet-w6">Points de vie max</label>
                        <input type="number" class="sheet-visible-input sheet-w6" name="attr_pv_max">
                    </div>
                    <input type="number" class="sheet-input" name="attr_pv">
                    <h4 class="sheet-h4">Points de vies Actuels</h4>
                </div>
                <div class="sheet-colu sheet-HP sheet-cadre-cb">
                    <input type="number" class="sheet-input" name="attr_pv_tmp">
                    <h4 class="sheet-h4">Points de vies temporaires</h4>
                </div>
            </div>
            <!-- Attaques -->
            <div class="sheet-colu sheet-attaques sheet-cadre-b">
                <div class="sheet-line">
                    <div class="sheet-line sheet-w8">
                        <label class="sheet-label-secondary sheet-w7">Nom</label>
                        <label class="sheet-label-secondary sheet-w5 sheet-text-center">Att</label>
                    </div>
                    <label class="sheet-label-secondary sheet-w4 sheet-text-center">Dégats</label>
                </div>
                <fieldset class="repeating_attaques">
                    <div class="sheet-attq">
                        <input class="sheet-options-flag" type="checkbox" name="attr_options-flag" checked><span>y</span>
                        <div class="sheet-line sheet-align-center">
                            <input type="hidden" name="attr_atq-roll-val"
                                   value="&{template:main} {{titre=Attaque avec @{name}}} {{subtitle=@{character_name}}} {{Attaque=[[1d20+@{bba}+@{atq-carac-val}+@{atq-bonus}+@{atq-bonus-2}]]}} {{Dégats=[[@{dgt-base}+@{dgt-carac-val}+@{dgt-bonus}]]}}">
                            <button type="roll" name="attr_atq-roll" value="@{atq-roll-val}"
                                    class="sheet-gray-line sheet-line sheet-bold sheet-w8 sheet-button-label">
                                <span class="sheet-w7" name="attr_name"></span>
                                <span class="sheet-w5 sheet-text-center" name="attr_atq-total"></span>
                            </button>
                            <input type="hidden" name="attr_dgt-roll-val"
                                   value="&{template:main} {{titre=Dégats de @{name}}} {{subtitle=@{character_name}}} {{Dégats=[[@{dgt-base}+@{dgt-carac-val}+@{dgt-bonus}]]}}">
                            <button type="roll" name="attr_attqdgtroll" value="@{dgt-roll-val}"
                                    class="sheet-gray-line sheet-line sheet-bold sheet-w4 sheet-justify-center sheet-button-label">
                                <span name="attr_degats"></span>
                            </button>
                        </div>
                        <div class="sheet-colu sheet-options-options sheet-border-bottom sheet-align-center">
                            <div class="sheet-line sheet-align-center">
                                <label class="attq-label sheet-w3">Nom :</label>
                                <input type="text" class="visible-input sheet-text-left sheet-w9" name="attr_name">
                            </div>
                            <div class="sheet-line sheet-align-center">
                                <label class="attq-label sheet-w3">Atq :</label>
                                <select class="sheet-w3" name="attr_atq-carac">
                                    <option value="-">-</option>
                                    <option value="FOR">FOR</option>
                                    <option value="DEX">DEX</option>
                                </select>
                                +
                                <input type="number" class="sheet-visible-input sheet-w2" name="attr_atq-bonus">
                                +
                                <input type="number" class="sheet-visible-input sheet-w2" name="attr_atq-bonus-2">
                                <input type="hidden" name="attr_atq-total">
                                <input type="hidden" name="attr_atq-carac-val">
                                <input type="hidden" name="attr_degats">
                                <input type="hidden" name="attr_dgt-carac-val">
                            </div>
                            <div class="sheet-line sheet-align-center">
                                <label class="attq-label sheet-w3">Dgt :</label>
                                <input type="text" class="sheet-visible-input sheet-w3" name="attr_dgt-base"
                                       placeholder="1d4">
                                +
                                <select class="sheet-w3" name="attr_dgt-carac">
                                    <option value="-">-</option>
                                    <option value="FOR">FOR</option>
                                    <option value="DEX">DEX</option>
                                    <option value="1,5FOR">1,5 x FOR</option>
                                    <option value="1/2FOR">1/2 xFOR</option>
                                </select>
                                +
                                <input type="number" class="sheet-visible-input sheet-w2" name="attr_dgt-bonus">
                            </div>
                            <div class="sheet-line sheet-align-center">
                                <label class="sheet-attq-label sheet-w3">Portée :</label>
                                <input type="text" class="visible-input sheet-text-left sheet-w9" name="attr_range">
                            </div>
                            <div class="sheet-colu sheet-w12">
                                <label class="sheet-skill-label sheet-w3">Notes :</label>
                                <input type="text" class="visible-input" name="attr_notes">
                            </div>
                        </div>
                    </div>
                </fieldset>
                <div class="sheet-line">
                    <label class="sheet-label-secondary sheet-w3">BBA :</label>
                    <input type="number" class="sheet-visible-input sheet-w9 " name="attr_bba">
                </div>
                <h4 class="sheet-h4">Attaques</h4>
            </div>
            <!-- Inventaire -->
            <div class="sheet-colu sheet-inventory-list sheet-cadre-b">
                <!-- Capacités Raciales -->
                <fieldset class="repeating_inventaire">
                    <div class="sheet-inventory">
                        <input class="sheet-options-flag" type="checkbox" name="attr_options-flag"
                               checked><span>y</span>
                        <div class="sheet-line sheet-align-center">
                            <button name="attr_skillroll" type="roll" value="@{rollvalue}"
                                    class="sheet-button-label  sheet-text-left">
                                <span class="sheet-bold" span name="attr_btn-bold-text"> </span> <span name="attr_btn-text"></span>
                            </button>
                            <input type="hidden" name="attr_btn-text"/>
                            <input type="hidden" name="attr_btn-bold-text" val="Nouvel objet"/>
                            <input type="hidden" name="attr_rollvalue"
                                   value="&{template:main} {{titre=@{name}}} {{subtitle=@{character_name}}} {{Quantité=@{qte}}} {{Poids=@{poids}kg}} {{description=@{description}}}">
                        </div>
                        <div class="sheet-colu sheet-options-options sheet-border-bottom">
                            <div class="sheet-line">
                                <label class="sheet-label sheet-text-right sheet-w3"> Nom : </label>
                                <input type="text" class="sheet-visible-input sheet-w9 " name="attr_name">
                            </div>
                            <div class="sheet-line">
                                <label class="sheet-label sheet-text-right sheet-w3"> Qté : </label>
                                <input type="number" class="sheet-visible-input sheet-w9 " name="attr_qte">
                            </div>
                            <div class="sheet-line">
                                <label class="sheet-label sheet-text-right sheet-w3"> Poids : </label>
                                <input type="number" class="sheet-visible-input sheet-w9 " name="attr_poids">
                            </div>
                            <label class="sheet-label">Description</label>
                            <textarea class="sheet-textarea" name="attr_description"></textarea>
                        </div>
                    </div>
                </fieldset>
                <h4 class="sheet-h4">Inventaire</h4>
            </div>
            <!-- Armures -->
            <div class="sheet-colu sheet-masteries sheet-cadre-b">
                <div class="sheet-armor sheet-colu">
                    <input class="sheet-options-flag" type="checkbox" name="attr_armor_options-flag"
                           checked><span>y</span>
                    <div class="sheet-line sheet-align-center sheet-options-display">
                        <label class="sheet-w12 sheet-label sheet-text-left  ">
                            <span class="sheet-bold">Armure :</span> <span name="attr_armor_name"></span>&nbsp;
                        </label>
                    </div>
                    <div class="sheet-colu sheet-options-options">
                        <label class="sheet-w12 sheet-label sheet-text-left  ">
                            <span class="sheet-bold">Armure</span>
                        </label>
                        <div class="sheet-line sheet-justify-center">
                            <label class="sheet-label sheet-text-right sheet-w3">Nom:</label>
                            <input type="text" class="sheet-visible-input sheet-w9 " name="attr_armor_name">
                        </div>
                        <div class="sheet-line sheet-gap05">
                            <div class="sheet-colu sheet-w4">
                                <input type="number" class="sheet-visible-input sheet-w12" name="attr_armor_bonus">
                                <label class="sheet-label sheet-text-center">Bonus</label>
                            </div>
                            <div class="sheet-colu sheet-w4">
                                <input type="number" class="sheet-visible-input sheet-w12" name="attr_armor_max_dex">
                                <label class="sheet-label sheet-text-center">Dex Max</label>
                            </div>
                            <div class="sheet-colu sheet-w4">
                                <input type="number" class="sheet-visible-input sheet-w12" name="attr_armor_Malus">
                                <label class="sheet-label sheet-text-center">Malus</label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="sheet-armor sheet-colu">
                    <input class="sheet-options-flag" type="checkbox" name="attr_shield_options-flag"
                           checked><span>y</span>
                    <div class="sheet-line sheet-align-center sheet-options-display">
                        <label class="sheet-w12 sheet-label sheet-text-left  ">
                            <span class="sheet-bold">Bouclier :</span> <span name="attr_shield_name"></span>&nbsp;
                        </label>
                    </div>
                    <div class="sheet-colu sheet-options-options">
                        <label class="sheet-w12 sheet-label sheet-text-left  ">
                            <span class="sheet-bold">Bouclier</span>
                        </label>
                        <div class="sheet-line sheet-justify-center">
                            <label class="sheet-label sheet-text-right sheet-w3">Nom:</label>
                            <input type="text" class="sheet-visible-input sheet-w9 " name="attr_shield_name">
                        </div>
                        <div class="sheet-line sheet-gap05">
                            <div class="sheet-colu sheet-w4">
                                <input type="number" class="sheet-visible-input sheet-w12" name="attr_shield_bonus">
                                <label class="sheet-label sheet-text-center">Bonus</label>
                            </div>
                            <div class="sheet-colu sheet-w4">
                                <input type="number" class="sheet-visible-input sheet-w12" name="attr_shield_malus">
                                <label class="sheet-label sheet-text-center">Malus</label>
                            </div>
                            <div class="sheet-colu sheet-w4 sheet-justify-end">
                                <input type="checkbox" class="sheet-visible-input sheet-w12" name="attr_shield_equipe">
                                <label class="sheet-label sheet-text-center">Équipé?</label>
                            </div>
                        </div>
                    </div>
                </div>
                <label class="sheet-w12 sheet-label sheet-text-left sheet-bold">
                    Bonus Divers
                </label>
                <div class="sheet-line sheet-gap05">
                    <div class="sheet-colu sheet-w4">
                        <input type="number" class="sheet-visible-input sheet-w12" name="attr_touch_bonus">
                        <label class="sheet-label sheet-text-center">Bonus<br/>au contact</label>
                    </div>
                    <div class="sheet-colu sheet-w4">
                        <input type="number" class="sheet-visible-input sheet-w12" name="attr_flatfooted_bonus">
                        <label class="sheet-label sheet-text-center">Bonus<br/>au dépourvu</label>
                    </div>
                    <div class="sheet-colu sheet-w4">
                        <input type="number" class="sheet-visible-input sheet-w12" name="attr_universal_armor_bonus">
                        <label class="sheet-label sheet-text-center">Bonus<br/>Universel</label>
                    </div>
                </div>
                <h4 class="sheet-h4">Armure</h4>
            </div>
        </div>
        <div class="sheet-colu sheet-w4" style="gap:0.75em;">
            <!-- Capacités Raciales -->
            <div class="sheet-colu sheet-traits sheet-cadre-b">
                <fieldset class="repeating_racial">
                    <div class="sheet-trait">
                        <input class="sheet-options-flag" type="checkbox" name="attr_options-flag"
                               checked><span>y</span>
                        <div class="sheet-line sheet-align-center">
                            <button name="attr_roll" type="roll" value="@{rollvalue}"
                                    class="sheet-button-label sheet-bold sheet-text-left">
                                <span name="attr_name"></span>&nbsp;
                            </button>
                            <input type="hidden" name="attr_rollvalue"
                                   value="&{template:main} {{titre=Trait Racial: @{name}}} {{subtitle=@{character_name}}} {{description=@{description}}}">
                        </div>
                        <div class="sheet-colu sheet-options-options sheet-border-bottom">
                            <div class="sheet-line">
                                <label class="sheet-label sheet-text-right sheet-w3"> Nom : </label>
                                <input type="text" class="sheet-visible-input sheet-w9 " name="attr_name">
                            </div>
                            <label class="sheet-label">Description</label>
                            <textarea class="sheet-textarea" name="attr_description"></textarea>
                        </div>
                    </div>
                </fieldset>
                <h4 class="sheet-h4">Capacité Raciales</h4>
            </div>
            <!-- Capacités classes -->
            <div class="sheet-colu sheet-traits sheet-cadre-b">
                <fieldset class="repeating_class">
                    <div class="sheet-trait">
                        <input class="sheet-options-flag" type="checkbox" name="attr_options-flag"
                               checked><span>y</span>
                        <div class="sheet-line sheet-align-center">
                            <button name="attr_roll" type="roll" value="@{rollvalue}"
                                    class="sheet-button-label sheet-bold sheet-text-left">
                                <span name="attr_name"></span>&nbsp;
                            </button>
                            <input type="hidden" name="attr_rollvalue"
                                   value="&{template:main} {{titre=Capacité de classe: @{name}}} {{subtitle=@{character_name}}} {{description=@{description}}}">
                        </div>
                        <div class="sheet-colu sheet-options-options sheet-border-bottom">
                            <div class="sheet-line">
                                <label class="sheet-label sheet-text-right sheet-w3"> Nom : </label>
                                <input type="text" class="sheet-visible-input sheet-w9 " name="attr_name">
                            </div>
                            <label class="sheet-label">Description</label>
                            <textarea class="sheet-textarea" name="attr_description"></textarea>
                        </div>
                    </div>
                </fieldset>
                <h4 class="sheet-h4">Capacité de classe</h4>
            </div>
            <!-- Dons -->
            <div class="sheet-colu sheet-traits sheet-cadre-b">
                <fieldset class="repeating_feat">
                    <div class="sheet-trait">
                        <input class="sheet-options-flag" type="checkbox" name="attr_options-flag"
                               checked><span>y</span>
                        <div class="sheet-line sheet-align-center">
                            <button name="attr_roll" type="roll" value="@{rollvalue}"
                                    class="sheet-button-label sheet-bold sheet-text-left">
                                <span name="attr_name"></span>&nbsp;
                            </button>
                            <input type="hidden" name="attr_rollvalue"
                                   value="&{template:main} {{titre=@{name}}} {{subtitle=@{character_name}}} {{description=@{description}}}">
                        </div>
                        <div class="sheet-colu sheet-options-options sheet-border-bottom">
                            <div class="sheet-line">
                                <label class="sheet-label sheet-text-right sheet-w3"> Nom : </label>
                                <input type="text" class="sheet-visible-input sheet-w9 " name="attr_name">
                            </div>
                            <label class="sheet-label">Description</label>
                            <textarea class="sheet-textarea" name="attr_description"></textarea>
                        </div>
                    </div>
                </fieldset>
                <h4 class="sheet-h4">Dons</h4>
            </div>
        </div>
    </div>
    <div class="sheet-journal sheet-line">
        <div class="sheet-colu sheet-w6">
            <div class="sheet-colu sheet-bio sheet-cadre-b">
                <textarea class="sheet-textarea" name="attr_char_description"></textarea>
                <h4 class="sheet-h4">Description Physique</h4>
            </div>
            <div class="sheet-colu sheet-bio sheet-cadre-b">
                <textarea class="sheet-textarea" name="attr_char_notes"></textarea>
                <h4 class="sheet-h4">Notes</h4>
            </div>
        </div>
        <div class="sheet-colu sheet-w6">
            <div class="sheet-colu sheet-bio sheet-cadre-b">
                <textarea class="sheet-textarea" name="attr_char_bg"></textarea>
                <h4 class="sheet-h4">Background</h4>
            </div>
            <div class="sheet-colu sheet-bio sheet-cadre-b">
                <textarea class="sheet-textarea" name="attr_tresor"></textarea>
                <h4 class="sheet-h4">Trésor</h4>
            </div>
        </div>

    </div>
    <div class="sheet-spells sheet-line">
        <div class="sheet-w4 sheet-colu">
            <!-- LEVEL 0 -->
            <div class="sheet-spell-group">
                <div class="sheet-spell-header sheet-line">
                    <label class="sheet-label sheet-w1">
                        0
                    </label>
                    <div class="sheet-w3">
                        <input class="sheet-input" name="attr_spell_0_total">
                    </div>
                    <div class="sheet-w8">
                        <input class="sheet-input" name="attr_spell_0_left">
                    </div>
                </div>
                <div class="sheet-spells-list sheet-colu">
                    <fieldset class="repeating_spells0">
                        <div class="sheet-spell sheet-border-bottom">
                            <input class="sheet-options-flag" type="checkbox" name="attr_options-flag"
                                   checked><span>y</span>
                            <div class="sheet-line sheet-align-center">
                                <input type="checkbox" name="attr_prepared">
                                <button name="attr_roll" type="roll" value="@{rollvalue}"
                                        class="sheet-button-label sheet-bold sheet-text-left">
                                    <span name="attr_name"></span>&nbsp;
                                </button>
                                <input type="hidden" name="attr_rollvalue"
                                       value="&{template:main} {{titre=Sort: @{name}}} {{subtitle=@{character_name}}} {{niveau=0}}  {{description=@{description}}}">
                            </div>
                            <div class="sheet-colu sheet-options-options">
                                <div class="sheet-line">
                                    <label class="sheet-label sheet-text-right sheet-w3"> Nom : </label>
                                    <input type="text" class="sheet-visible-input sheet-w9 " name="attr_name">
                                </div>
                                <label class="sheet-label">Description</label>
                                <textarea class="sheet-textarea" name="attr_description"></textarea>
                            </div>
                        </div>
                    </fieldset>
                </div>
            </div>
            <!-- LEVEL 1 -->
            <div class="sheet-spell-group">
                <div class="sheet-spell-header sheet-line">
                    <label class="sheet-label sheet-w1">
                        1
                    </label>
                    <div class="sheet-w3">
                        <input class="sheet-input" name="attr_spell_1_total">
                    </div>
                    <div class="sheet-w8">
                        <input class="sheet-input" name="attr_spell_1_left">
                    </div>
                </div>
                <div class="sheet-spells-list sheet-colu">
                    <fieldset class="repeating_spells1">
                        <div class="sheet-spell sheet-border-bottom">
                            <input class="sheet-options-flag" type="checkbox" name="attr_options-flag"
                                   checked><span>y</span>
                            <div class="sheet-line sheet-align-center">
                                <input type="checkbox" name="attr_prepared">
                                <button name="attr_roll" type="roll" value="@{rollvalue}"
                                        class="sheet-button-label sheet-bold sheet-text-left">
                                    <span name="attr_name"></span>&nbsp;
                                </button>
                                <input type="hidden" name="attr_rollvalue"
                                       value="&{template:main} {{titre=Sort: @{name}}} {{subtitle=@{character_name}}} {{niveau=1}}  {{description=@{description}}}">
                            </div>
                            <div class="sheet-colu sheet-options-options">
                                <div class="sheet-line">
                                    <label class="sheet-label sheet-text-right sheet-w3"> Nom : </label>
                                    <input type="text" class="sheet-visible-input sheet-w9 " name="attr_name">
                                </div>
                                <label class="sheet-label">Description</label>
                                <textarea class="sheet-textarea" name="attr_description"></textarea>
                            </div>
                        </div>
                    </fieldset>
                </div>
            </div>
            <!-- LEVEL 2 -->
            <div class="sheet-spell-group">
                <div class="sheet-spell-header sheet-line">
                    <label class="sheet-label sheet-w1">
                        2
                    </label>
                    <div class="sheet-w3">
                        <input class="sheet-input" name="attr_spell_2_total">
                    </div>
                    <div class="sheet-w8">
                        <input class="sheet-input" name="attr_spell_2_left">
                    </div>
                </div>
                <div class="sheet-spells-list sheet-colu">
                    <fieldset class="repeating_spells2">
                        <div class="sheet-spell sheet-border-bottom">
                            <input class="sheet-options-flag" type="checkbox" name="attr_options-flag"
                                   checked><span>y</span>
                            <div class="sheet-line sheet-align-center">
                                <input type="checkbox" name="attr_prepared">
                                <button name="attr_roll" type="roll" value="@{rollvalue}"
                                        class="sheet-button-label sheet-bold sheet-text-left">
                                    <span name="attr_name"></span>&nbsp;
                                </button>
                                <input type="hidden" name="attr_rollvalue"
                                       value="&{template:main} {{titre=Sort: @{name}}} {{subtitle=@{character_name}}} {{niveau=2}}  {{description=@{description}}}">
                            </div>
                            <div class="sheet-colu sheet-options-options">
                                <div class="sheet-line">
                                    <label class="sheet-label sheet-text-right sheet-w3"> Nom : </label>
                                    <input type="text" class="sheet-visible-input sheet-w9 " name="attr_name">
                                </div>
                                <label class="sheet-label">Description</label>
                                <textarea class="sheet-textarea" name="attr_description"></textarea>
                            </div>
                        </div>
                    </fieldset>
                </div>
            </div>
        </div>
        <div class="sheet-w4 sheet-colu">
            <!-- LEVEL 3 -->
            <div class="sheet-spell-group">
                <div class="sheet-spell-header sheet-line">
                    <label class="sheet-label sheet-w1">
                        3
                    </label>
                    <div class="sheet-w3">
                        <input class="sheet-input" name="attr_spell_3_total">
                    </div>
                    <div class="sheet-w8">
                        <input class="sheet-input" name="attr_spell_3_left">
                    </div>
                </div>
                <div class="sheet-spells-list sheet-colu">
                    <fieldset class="repeating_spells3">
                        <div class="sheet-spell sheet-border-bottom">
                            <input class="sheet-options-flag" type="checkbox" name="attr_options-flag"
                                   checked><span>y</span>
                            <div class="sheet-line sheet-align-center">
                                <input type="checkbox" name="attr_prepared">
                                <button name="attr_roll" type="roll" value="@{rollvalue}"
                                        class="sheet-button-label sheet-bold sheet-text-left">
                                    <span name="attr_name"></span>&nbsp;
                                </button>
                                <input type="hidden" name="attr_rollvalue"
                                       value="&{template:main} {{titre=Sort: @{name}}} {{subtitle=@{character_name}}} {{niveau=3}}  {{description=@{description}}}">
                            </div>
                            <div class="sheet-colu sheet-options-options">
                                <div class="sheet-line">
                                    <label class="sheet-label sheet-text-right sheet-w3"> Nom : </label>
                                    <input type="text" class="sheet-visible-input sheet-w9 " name="attr_name">
                                </div>
                                <label class="sheet-label">Description</label>
                                <textarea class="sheet-textarea" name="attr_description"></textarea>
                            </div>
                        </div>
                    </fieldset>
                </div>
            </div>
            <!-- LEVEL 4 -->
            <div class="sheet-spell-group">
                <div class="sheet-spell-header sheet-line">
                    <label class="sheet-label sheet-w1">
                        4
                    </label>
                    <div class="sheet-w3">
                        <input class="sheet-input" name="attr_spell_4_total">
                    </div>
                    <div class="sheet-w8">
                        <input class="sheet-input" name="attr_spell_4_left">
                    </div>
                </div>
                <div class="sheet-spells-list sheet-colu">
                    <fieldset class="repeating_spells4">
                        <div class="sheet-spell sheet-border-bottom">
                            <input class="sheet-options-flag" type="checkbox" name="attr_options-flag"
                                   checked><span>y</span>
                            <div class="sheet-line sheet-align-center">
                                <input type="checkbox" name="attr_prepared">
                                <button name="attr_roll" type="roll" value="@{rollvalue}"
                                        class="sheet-button-label sheet-bold sheet-text-left">
                                    <span name="attr_name"></span>&nbsp;
                                </button>
                                <input type="hidden" name="attr_rollvalue"
                                       value="&{template:main} {{titre=Sort: @{name}}} {{subtitle=@{character_name}}} {{niveau=4}}  {{description=@{description}}}">
                            </div>
                            <div class="sheet-colu sheet-options-options">
                                <div class="sheet-line">
                                    <label class="sheet-label sheet-text-right sheet-w3"> Nom : </label>
                                    <input type="text" class="sheet-visible-input sheet-w9 " name="attr_name">
                                </div>
                                <label class="sheet-label">Description</label>
                                <textarea class="sheet-textarea" name="attr_description"></textarea>
                            </div>
                        </div>
                    </fieldset>
                </div>
            </div>
            <!-- LEVEL 5 -->
            <div class="sheet-spell-group">
                <div class="sheet-spell-header sheet-line">
                    <label class="sheet-label sheet-w1">
                        5
                    </label>
                    <div class="sheet-w3">
                        <input class="sheet-input" name="attr_spell_5_total">
                    </div>
                    <div class="sheet-w8">
                        <input class="sheet-input" name="attr_spell_5_left">
                    </div>
                </div>
                <div class="sheet-spells-list sheet-colu">
                    <fieldset class="repeating_spells5">
                        <div class="sheet-spell sheet-border-bottom">
                            <input class="sheet-options-flag" type="checkbox" name="attr_options-flag"
                                   checked><span>y</span>
                            <div class="sheet-line sheet-align-center">
                                <input type="checkbox" name="attr_prepared">
                                <button name="attr_roll" type="roll" value="@{rollvalue}"
                                        class="sheet-button-label sheet-bold sheet-text-left">
                                    <span name="attr_name"></span>&nbsp;
                                </button>
                                <input type="hidden" name="attr_rollvalue"
                                       value="&{template:main} {{titre=Sort: @{name}}} {{subtitle=@{character_name}}} {{niveau=5}}  {{description=@{description}}}">
                            </div>
                            <div class="sheet-colu sheet-options-options">
                                <div class="sheet-line">
                                    <label class="sheet-label sheet-text-right sheet-w3"> Nom : </label>
                                    <input type="text" class="sheet-visible-input sheet-w9 " name="attr_name">
                                </div>
                                <label class="sheet-label">Description</label>
                                <textarea class="sheet-textarea" name="attr_description"></textarea>
                            </div>
                        </div>
                    </fieldset>
                </div>
            </div>
        </div>
        <div class="sheet-w4 sheet-colu">
            <!-- LEVEL 6 -->
            <div class="sheet-spell-group">
                <div class="sheet-spell-header sheet-line">
                    <label class="sheet-label sheet-w1">
                        6
                    </label>
                    <div class="sheet-w3">
                        <input class="sheet-input" name="attr_spell_6_total">
                    </div>
                    <div class="sheet-w8">
                        <input class="sheet-input" name="attr_spell_6_left">
                    </div>
                </div>
                <div class="sheet-spells-list sheet-colu">
                    <fieldset class="repeating_spells6">
                        <div class="sheet-spell sheet-border-bottom">
                            <input class="sheet-options-flag" type="checkbox" name="attr_options-flag"
                                   checked><span>y</span>
                            <div class="sheet-line sheet-align-center">
                                <input type="checkbox" name="attr_prepared">
                                <button name="attr_roll" type="roll" value="@{rollvalue}"
                                        class="sheet-button-label sheet-bold sheet-text-left">
                                    <span name="attr_name"></span>&nbsp;
                                </button>
                                <input type="hidden" name="attr_rollvalue"
                                       value="&{template:main} {{titre=Sort: @{name}}} {{subtitle=@{character_name}}} {{niveau=6}}  {{description=@{description}}}">
                            </div>
                            <div class="sheet-colu sheet-options-options">
                                <div class="sheet-line">
                                    <label class="sheet-label sheet-text-right sheet-w3"> Nom : </label>
                                    <input type="text" class="sheet-visible-input sheet-w9 " name="attr_name">
                                </div>
                                <label class="sheet-label">Description</label>
                                <textarea class="sheet-textarea" name="attr_description"></textarea>
                            </div>
                        </div>
                    </fieldset>
                </div>
            </div>
            <!-- LEVEL 7 -->
            <div class="sheet-spell-group">
                <div class="sheet-spell-header sheet-line">
                    <label class="sheet-label sheet-w1">
                        7
                    </label>
                    <div class="sheet-w3">
                        <input class="sheet-input" name="attr_spell_7_total">
                    </div>
                    <div class="sheet-w8">
                        <input class="sheet-input" name="attr_spell_7_left">
                    </div>
                </div>
                <div class="sheet-spells-list sheet-colu">
                    <fieldset class="repeating_spells7">
                        <div class="sheet-spell sheet-border-bottom">
                            <input class="sheet-options-flag" type="checkbox" name="attr_options-flag"
                                   checked><span>y</span>
                            <div class="sheet-line sheet-align-center">
                                <input type="checkbox" name="attr_prepared">
                                <button name="attr_roll" type="roll" value="@{rollvalue}"
                                        class="sheet-button-label sheet-bold sheet-text-left">
                                    <span name="attr_name"></span>&nbsp;
                                </button>
                                <input type="hidden" name="attr_rollvalue"
                                       value="&{template:main} {{titre=Sort: @{name}}} {{subtitle=@{character_name}}} {{niveau=7}}  {{description=@{description}}}">
                            </div>
                            <div class="sheet-colu sheet-options-options">
                                <div class="sheet-line">
                                    <label class="sheet-label sheet-text-right sheet-w3"> Nom : </label>
                                    <input type="text" class="sheet-visible-input sheet-w9 " name="attr_name">
                                </div>
                                <label class="sheet-label">Description</label>
                                <textarea class="sheet-textarea" name="attr_description"></textarea>
                            </div>
                        </div>
                    </fieldset>
                </div>
            </div>
            <!-- LEVEL 8 -->
            <div class="sheet-spell-group">
                <div class="sheet-spell-header sheet-line">
                    <label class="sheet-label sheet-w1">
                        8
                    </label>
                    <div class="sheet-w3">
                        <input class="sheet-input" name="attr_spell_8_total">
                    </div>
                    <div class="sheet-w8">
                        <input class="sheet-input" name="attr_spell_8_left">
                    </div>
                </div>
                <div class="sheet-spells-list sheet-colu">
                    <fieldset class="repeating_spells8">
                        <div class="sheet-spell sheet-border-bottom">
                            <input class="sheet-options-flag" type="checkbox" name="attr_options-flag"
                                   checked><span>y</span>
                            <div class="sheet-line sheet-align-center">
                                <input type="checkbox" name="attr_prepared">
                                <button name="attr_roll" type="roll" value="@{rollvalue}"
                                        class="sheet-button-label sheet-bold sheet-text-left">
                                    <span name="attr_name"></span>&nbsp;
                                </button>
                                <input type="hidden" name="attr_rollvalue"
                                       value="&{template:main} {{titre=Sort: @{name}}} {{subtitle=@{character_name}}} {{niveau=8}}  {{description=@{description}}}">
                            </div>
                            <div class="sheet-colu sheet-options-options">
                                <div class="sheet-line">
                                    <label class="sheet-label sheet-text-right sheet-w3"> Nom : </label>
                                    <input type="text" class="sheet-visible-input sheet-w9 " name="attr_name">
                                </div>
                                <label class="sheet-label">Description</label>
                                <textarea class="sheet-textarea" name="attr_description"></textarea>
                            </div>
                        </div>
                    </fieldset>
                </div>
            </div>
            <!-- LEVEL 9 -->
            <div class="sheet-spell-group">
                <div class="sheet-spell-header sheet-line">
                    <label class="sheet-label sheet-w1">
                        9
                    </label>
                    <div class="sheet-w3">
                        <input class="sheet-input" name="attr_spell_9_total">
                    </div>
                    <div class="sheet-w8">
                        <input class="sheet-input" name="attr_spell_9_left">
                    </div>
                </div>
                <div class="sheet-spells-list sheet-colu">
                    <fieldset class="repeating_spells9">
                        <div class="sheet-spell sheet-border-bottom">
                            <input class="sheet-options-flag" type="checkbox" name="attr_options-flag"
                                   checked><span>y</span>
                            <div class="sheet-line sheet-align-center">
                                <input type="checkbox" name="attr_prepared">
                                <button name="attr_roll" type="roll" value="@{rollvalue}"
                                        class="sheet-button-label sheet-bold sheet-text-left">
                                    <span name="attr_name"></span>&nbsp;
                                </button>
                                <input type="hidden" name="attr_rollvalue"
                                       value="&{template:main} {{titre=Sort: @{name}}} {{subtitle=@{character_name}}} {{niveau=9}}  {{description=@{description}}}">
                            </div>
                            <div class="sheet-colu sheet-options-options">
                                <div class="sheet-line">
                                    <label class="sheet-label sheet-text-right sheet-w3"> Nom : </label>
                                    <input type="text" class="sheet-visible-input sheet-w9 " name="attr_name">
                                </div>
                                <label class="sheet-label">Description</label>
                                <textarea class="sheet-textarea" name="attr_description"></textarea>
                            </div>
                        </div>
                    </fieldset>
                </div>
            </div>
        </div>
    </div>
    <div class="sheet-colu sheet-configuration">
        <div class="sheet-line">
            <div class="sheet-colu sheet-w4 sheet-config sheet-cadre">
                <div class="sheet-line sheet-align-center ">
                    <label class="sheet-label sheet-text-right sheet-w5">Mod. Force :</label>
                    <input type="number" class="visible-input sheet-w9" name="attr_for_bonus">
                </div>
                <div class="sheet-line sheet-align-center ">
                    <label class="sheet-label sheet-text-right sheet-w5">Mod. Dextérité :</label>
                    <input type="number" class="visible-input sheet-w9" name="attr_dex_bonus">
                </div>
                <div class="sheet-line sheet-align-center ">
                    <label class="sheet-label sheet-text-right sheet-w5">Mod. Constit. :</label>
                    <input type="number" class="visible-input sheet-w9" name="attr_con_bonus">
                </div>
                <div class="sheet-line sheet-align-center ">
                    <label class="sheet-label sheet-text-right sheet-w5">Mod. Intel. :</label>
                    <input type="number" class="visible-input sheet-w9" name="attr_int_bonus">
                </div>
                <div class="sheet-line sheet-align-center ">
                    <label class="sheet-label sheet-text-right sheet-w5">Mod. Sagesse :</label>
                    <input type="number" class="visible-input sheet-w9" name="attr_sag_bonus">
                </div>
                <div class="sheet-line sheet-align-center ">
                    <label class="sheet-label sheet-text-right sheet-w5">Mod. Charisme :</label>
                    <input type="number" class="visible-input sheet-w9" name="attr_cha_bonus">
                </div>
                <div class="sheet-line sheet-align-center ">
                    <label class="sheet-label sheet-text-right sheet-w5">Mod. Init. :</label>
                    <input type="number" class="visible-input sheet-w9" name="attr_init_bonus">
                </div>
            </div>
            <div class="sheet-colu sheet-w4 sheet-config sheet-cadre">
            </div>
            <div class="sheet-colu sheet-w4 sheet-config sheet-cadre">
                <div class="sheet-line sheet-align-center ">
                    <label class="sheet-label sheet-text-right sheet-w7">Type de personnage :</label>
                    <select class="sheet-w5" name="attr_characterType">
                        <option value="pc">Joueur</option>
                        <option value="npc">Pnj</option>
                    </select>
                </div>
                <div class="sheet-line">
                    <button type="action" name="act_inv_refresh" class="sheet-w12">Rafraichir l'inventaire</button>
                </div>
            </div>
        </div>
    </div>
</div>

<rolltemplate class="sheet-rolltemplate-main">
    <div class="sheet-colu sheet-w-12 sheet-cadre sheet-template">
        <h4 class="sheet-h4">{{titre}}</h4>
        {{#subtitle}}
        <label class="sheet-w12 sheet-label sheet-text-center">{{subtitle}}</label>
        {{/subtitle}}
        <div class="sheet-line sheet-border-bottom"></div>
        {{#allprops() titre subtitle description}}
        <div class="sheet-line sheet-align-center">
            <label class="sheet-label sheet-bold sheet-w4 sheet-text-right">{{key}} :</label>
            <div class="sheet-w8 sheet-colu sheet-justify-center sheet-align-center">{{value}}</div>
        </div>
        {{/allprops() titre subtitle description}}
        {{#description}}
        <div class="sheet-line sheet-border-bottom"></div>
        <div class="sheet-line">
            <div>
            {{description}}
            </div>
        </div>
        {{/description}}
    </div>
</rolltemplate>

<script type="text/worker">

    const buttonlist = ["character", "journal","spells", "configuration"];
    buttonlist.forEach(button => {
        on(`clicked:${button}`, function() {
            setAttrs({
                sheetTab: button
            });
        });
    });


    /* CARACTERISTICS UPDATE */
    on("change:for_base change:for_bonus",function(){
        getAttrs(["for_base","for_bonus"], function(values) {
            let base = parseInt(values.for_base)||0;
            let bonus = parseInt(values.for_bonus)||0;
            let total = base+bonus;
            if(total % 2 == 1){
                total--;
            }
            let mod = (total-10)/2;
            setAttrs({"for_mod":mod});
        })
    });

    on("change:dex_base change:dex_bonus",function(){
        getAttrs(["dex_base","dex_bonus"], function(values) {
            let base = parseInt(values.dex_base)||0;
            let bonus = parseInt(values.dex_bonus)||0;
            let total = base+bonus;
            if(total % 2 == 1){
                total--;
            }
            let mod = (total-10)/2;
            setAttrs({"dex_mod":mod});
        })
    });

    on("change:con_base change:con_bonus",function(){
        getAttrs(["con_base","con_bonus"], function(values) {
            let base = parseInt(values.con_base)||0;
            let bonus = parseInt(values.con_bonus)||0;
            let total = base+bonus;
            if(total % 2 == 1){
                total--;
            }
            let mod = (total-10)/2;
            setAttrs({"con_mod":mod});
        })
    });

    on("change:int_base change:int_bonus",function(){
        getAttrs(["int_base","int_bonus"], function(values) {
            let base = parseInt(values.int_base)||0;
            let bonus = parseInt(values.int_bonus)||0;
            let total = base+bonus;
            if(total % 2 == 1){
                total--;
            }
            let mod = (total-10)/2;
            setAttrs({"int_mod":mod});
        })
    });

    on("change:sag_base change:sag_bonus",function(){
        getAttrs(["sag_base","sag_bonus"], function(values) {
            let base = parseInt(values.sag_base)||0;
            let bonus = parseInt(values.sag_bonus)||0;
            let total = base+bonus;
            if(total % 2 == 1){
                total--;
            }
            let mod = (total-10)/2;
            setAttrs({"sag_mod":mod});
        })
    });

    on("change:cha_base change:cha_bonus",function(){
        getAttrs(["cha_base","cha_bonus"], function(values) {
            let base = parseInt(values.cha_base)||0;
            let bonus = parseInt(values.cha_bonus)||0;
            let total = base+bonus;
            if(total % 2 == 1){
                total--;
            }
            let mod = (total-10)/2;
            setAttrs({"cha_mod":mod});
        })
    });

    on("change:for_mod change:dex_mod change:con_mod change:int_mod change:sag_mod change:cha_mod change:skills_malus",function(){
        getSectionIDs("skills", function (idarray) {
            for (var i = 0; i < idarray.length; i++) {
                updateSkill("repeating_skills_"+idarray[i]);
            }
        });
        getSectionIDs("attaques", function (idarray) {
            for (var i = 0; i < idarray.length; i++) {
                updateAtq("repeating_attaques_"+idarray[i]);
            }
        });
    });

    /*Update init*/
    on("change:dex_mod change:init_bonus",function(){
        getAttrs(["dex_base","dex_bonus","dex_mod","init_bonus"],function(values){
            let dex_mod = parseInt(values.dex_mod)||0;
            let init_bonus = parseInt(values.init_bonus)||0;
            let dex_base = parseInt(values.dex_base)||0;
            let dex_bonus = parseInt(values.dex_bonus)||0;
            let dex_total = dex_base+dex_bonus;
            const init_tot = dex_mod+init_bonus+(dex_total/100);
            setAttrs({
                "init_tot":init_tot
            });
        });
    });

    /*Update armor*/
    on("change:armor_bonus change:armor_malus change:armor_max_dex change:shield_bonus change:shield_malus change:shield_equipe change:touch_bonus change:flatfooted_bonus change:universal_armor_bonus change:dex_mod",function(){
        getAttrs(["armor_bonus","armor_malus","armor_max_dex","shield_bonus","shield_malus","shield_equipe","touch_bonus","flatfooted_bonus","universal_armor_bonus","dex_mod"],function(values){
            let armor_bonus = parseInt(values.armor_bonus) || 0;
            let armor_malus = parseInt(values.armor_malus) || 0;
            let armor_max_dex = parseInt(values.armor_max_dex) || 0;
            if(armor_max_dex < 0) armor_max_dex = 1000;
            let shield_equipe = values.shield_equipe == "on";
            let shield_bonus = shield_equipe ? (parseInt(values.shield_bonus) || 0) : 0;
            let shield_malus = shield_equipe ? (parseInt(values.shield_malus) || 0) : 0;
            let touch_bonus = parseInt(values.touch_bonus) || 0;
            let flatfooted_bonus = parseInt(values.flatfooted_bonus) || 0;
            let universal_armor_bonus = parseInt(values.universal_armor_bonus) || 0;
            let dex_mod = parseInt(values.dex_mod) || 0;
            let dex = (armor_max_dex < dex_mod) ? armor_max_dex : dex_mod;
            let AC = 10 +armor_bonus + dex + shield_bonus + touch_bonus + flatfooted_bonus + universal_armor_bonus;
            let TAC = 10 +dex + touch_bonus + universal_armor_bonus;
            let FFAC = 10 +armor_bonus + shield_bonus + flatfooted_bonus + universal_armor_bonus;
            let skill_malus = (shield_malus > 0 ? -shield_malus : shield_malus) - (armor_malus < 0 ? -armor_malus : armor_malus);
            setAttrs({
                "ac_tot":AC,
                "ac_tot_t":TAC,
                "ac_tot_ff":FFAC,
                "skills_malus":skill_malus
            });
        });
    });

    /*Update resume */
    on('clicked:inv_refresh',function() {
            getSectionIDs("inventaire", function (idarray) {
            for (var i = 0; i < idarray.length; i++) {
                updateSkill("repeating_inventaire_"+idarray[i]);
            }
        });
    });

    on("change:repeating_inventaire",function(eventInfo){
        let invId= eventInfo.triggerName;
        if(eventInfo.sourceAttribute.includes("options-flag")){
            return;
        }
        updateInv(invId);
    });

    function updateInv(invId){
        /* A recup */
        const nom = invId+"_name";
        const qte = invId+"_qte";
        const poids = invId+"_poids";
        const description = invId+"_description";
        /* A Set 34 Caracteres */
        const resume = invId+"_btn-text";
        const nom_bold = invId+"_btn-bold-text";
        getAttrs([nom,qte,poids,description],function (values){
            const vNom = values[nom];
            const vQte = values[qte];
            const vPoids = values[poids];
            const vDesc = values[description];
            let boldText = "Objet non défini";
            let normalText = "";
            let charLeft = 35;
            if(!!vNom){
                boldText = vNom;
                charLeft -= vNom.length;
            }

            let vQteInt = parseInt(vQte)||0;
            let vPoidsFloat = parseFloat(vPoids)||0.0;
            let vPoidsTotal = (vQteInt * vPoidsFloat).toFixed(2);

            let text = "";
            if(!!vQte && !!vPoids){
                text = " ("+vPoidsTotal+"Kg)";
            }
            else if(!!vQte){
                text = " ("+vQteInt+"x)";
            }
            else if(!!vPoids){
                text = " ("+vPoidsFloat.toFixed(2)+"Kg)";
            }
            boldText += text;
            charLeft -= text.length;
            if(!!vDesc){
                if(vDesc.length < charLeft){
                    normalText = vDesc;
                }
                else{
                    normalText = vDesc.substring(0,charLeft-3)+"...";
                }
            }
            let update = {};
            update[nom_bold]= boldText;
            update[resume] = normalText;
            setAttrs(update,{silent:true});
        });
    }
    /*Update attaques*/
    on("change:repeating_attaques", function(eventInfo) {
        let atqId= eventInfo.triggerName;
        if(eventInfo.sourceAttribute.includes("options-flag")){
            return;
        }
        updateAtq(atqId);
    });

    function updateAtq(atqId){
        /*A Récup */
        const bbaAttr = "bba";
        const atqCaracAttr = atqId+"_atq-carac";
        const atqModAttr = atqId+"_atq-bonus";
        const atqMod2Attr = atqId+"_atq-bonus-2";
        const dgtBaseAttr = atqId+"_dgt-base";
        const dgtCaracAttr = atqId+"_dgt-carac";
        const dgtBonusAttr = atqId+"_dgt-bonus";
        /* A Set */
        const atqCaracValAttr = atqId+"_atq-carac-val";
        const dgtCaracValAttr = atqId+"_dgt-carac-val";
        const dgtTotalAttk = atqId+"_degats";
        const atqTotalAttk = atqId+"_atq-total";
        getAttrs([bbaAttr,atqCaracAttr,atqModAttr,atqMod2Attr,dgtBaseAttr,dgtCaracAttr,dgtBonusAttr,"for_mod","dex_mod"],function (values){
            const bba = parseInt(values[bbaAttr])||0;
            const atqCarac = values[atqCaracAttr];
            const atqMod = parseInt(values[atqModAttr])||0;
            const atqMod2 = parseInt(values[atqMod2Attr])||0;
            const dgtBase = values[dgtBaseAttr];
            const dgtCarac = values[dgtCaracAttr];
            const dgtBonus = parseInt(values[dgtBonusAttr])||0;
            const formod = parseInt(values.for_mod)||0;
            const dexmod = parseInt(values.dex_mod)||0;
            let caracAtk = 0;
            if("FOR" == atqCarac){
                caracAtk = formod;
            }
            else if("DEX" == atqCarac){
                caracAtk = dexmod
            }
            let caracDgt = 0;
            if("FOR" == dgtCarac){
                caracDgt = formod;
            }
            else if("DEX" == dgtCarac){
                caracDgt = dexmod;
            }
            else if("1,5FOR" == dgtCarac){
                caracDgt = Math.floor(1.5*formod);
            }
            else if("1/2FOR" == dgtCarac){
                caracDgt = Math.floor(formod/2);
            }
            let degatsBonus = caracDgt + dgtBonus;
            let atqBonus = bba + caracAtk + atqMod + atqMod2;
            if(atqBonus > 0){
                atqBonus = "+" + atqBonus;
            }
            else if(atqBonus < 0){
                atqBonus = "-" + atqBonus;
            }
            let degats = dgtBase + " + " +  degatsBonus;
            let update = {};
            update[dgtTotalAttk] = degats;
            update[atqTotalAttk] = atqBonus;
            update[atqCaracValAttr] = caracAtk;
            update[dgtCaracValAttr] = caracDgt;
            setAttrs(update,{silent:true});
        });
    }
    /*Update Skills*/
    on("change:repeating_skills", function(eventInfo) {
        let skillId= eventInfo.triggerName;
        if(eventInfo.sourceAttribute.includes("options-flag")){
            return;
        }
        updateSkill(skillId);
    });

    function updateSkill(skillId){
        const rankAttr = skillId+"_ranks";
        const modAttr = skillId+"_mod";
        const caracAttr = skillId+"_carac";
        const totalAttr = skillId+"_total";
        const malusAttr = skillId+"_has_armor_malus";
        const caracnameAttr = skillId+"_caracname";
        getAttrs(["skills_malus",modAttr,rankAttr,caracAttr,malusAttr],function (values){
            let malus = values[malusAttr] == "on";
            let skills_malus = malus ? (parseInt(values.skills_malus)||0) : 0;
            let rank = parseInt(values[rankAttr])||0;
            let carac = values[caracAttr];
            let mod = parseInt(values[modAttr])||0;
            carac = carac.replace("@{","").replace("}","");
            let caracname = carac.split("_")[0];
            caracname = caracname.charAt(0).toUpperCase() + caracname.slice(1);
            caracname = "("+caracname+")";
            getAttrs([carac],function(values){
               let caracVal = parseInt(values[carac])||0;
               let total = rank+caracVal+mod+skills_malus;
               let update = {};
               update[totalAttr] = total;
               update[caracnameAttr] = caracname;
               setAttrs(update,{silent:true});
            });
        });
    }
</script>
