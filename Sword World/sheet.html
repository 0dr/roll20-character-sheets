<div class="grid col2-main">
    <div class="grid">
        <div class="grid guild nogap">
            <img name="attr_character_avatar" />

            <div class="grid col2-guild">
                <div class="grid">
                    <div class="grid col2 vcol">
                        <label>Reputation</label>
                        <input type="text" name="attr_reputation" value="Hollow" />

                        <label>Points</label>
                        <input type="text" name="attr_reputation_points" value="0" />
                    </div>

                    <div class="grid col2 vcol">
                        <label>Rank</label>
                        <input type="text" name="attr_rank" value="None" />

                        <label>Grade</label>
                        <input type="text" name="attr_grade" />
                    </div>
                </div>

                <div class="grid alevel">
                    <label>Adventurer Level</label>
                    <input type="number" name="attr_adventurer_level" value="2" />
                </div>
            </div>
        </div>

        <div class="grid profile">
            <span class="label">History, Profile</span>
            <label>Background</label>
            <div class="auto-expand disease">
                <span name="attr_background"></span>
                <textarea spellcheck="false" name="attr_background"></textarea>
            </div>

            <label>Experience Points</label>
            <input type="number" name="attr_experience" />

            <label>Soulscars</label>
            <input type="number" name="attr_soulscars" value="0" />

            <label>Automatic Failures</label>
            <input type="text" name="attr_automatic_failure" value="0" />
        </div>
    </div>

    <div class="grid">
        <div class="grid col2-header">
            <div class="grid">
                <div class="grid col2 vcol">
                    <label>Character Name</label>
                    <input type="text" name="attr_character_name" />

                    <label>Player Name</label>
                    <input type="text" name="attr_player_name" />
                </div>

                <div class="grid col3-race vcol">
                    <label>Race</label>
                    <input type="text" name="attr_race" />

                    <label>Age</label>
                    <input type="text" name="attr_age" />

                    <label>Gender</label>
                    <input type="text" name="attr_gender" />
                </div>

                <label>Racial Abilities</label>
                <fieldset class="repeating_racialabilities">
                    <input type="text" name="attr_racial_ability" />
                </fieldset>
            </div>

            <h1>Sword World 2.5</h1>
        </div>

        <div class="grid nogap">
            <div class="grid col5-abilities">
                <span class="header">Base</span>
                <span class="header">Correction</span>
                <span class="header">Growth</span>
                <span class="header">Ability Scores</span>
                <span class="header">Modifiers</span>
            </div>
            <div class="grid col5-abilities shaded">
                <div class="grid vspan2">
                    <label>Skill</label>
                    <input type="number" name="attr_skill" />
                </div>
                <div class="grid">
                    <label>A</label>
                    <input type="number" name="attr_ability_a" />
                </div>
                <div class="grid">
                    <label>g</label>
                    <input type="number" name="attr_growth_1" />
                </div>
                <div class="grid">
                    <label>Dexterity</label>
                    <span class="input" name="attr_dexterity" />
                </div>
                <div class="grid">
                    <label>&divide;6</label>
                    <span class="input" name="attr_dexterity_modifier" />
                </div>

                <div class="grid">
                    <label>B</label>
                    <input type="number" name="attr_ability_b" />
                </div>
                <div class="grid">
                    <label>h</label>
                    <input type="number" name="attr_growth_2" />
                </div>
                <div class="grid">
                    <label>Agility</label>
                    <span class="input" name="attr_agility" />
                </div>
                <div class="grid">
                    <label>&divide;6</label>
                    <span class="input" name="attr_agility_modifier" />
                </div>

                <div class="grid vspan2">
                    <label>Body</label>
                    <input type="number" name="attr_body" />
                </div>
                <div class="grid">
                    <label>C</label>
                    <input type="number" name="attr_ability_c" />
                </div>
                <div class="grid">
                    <label>i</label>
                    <input type="number" name="attr_growth_3" />
                </div>
                <div class="grid">
                    <label>Strength</label>
                    <span class="input" name="attr_strength" />
                </div>
                <div class="grid">
                    <label>&divide;6</label>
                    <span class="input" name="attr_strength_modifier" />
                </div>

                <div class="grid">
                    <label>D</label>
                    <input type="number" name="attr_ability_d" />
                </div>
                <div class="grid">
                    <label>j</label>
                    <input type="number" name="attr_growth_4" />
                </div>
                <div class="grid">
                    <label>Vitality</label>
                    <span class="input" name="attr_vitality" />
                </div>
                <div class="grid">
                    <label>&divide;6</label>
                    <span class="input" name="attr_vitality_modifier" />
                </div>

                <div class="grid vspan2">
                    <label>Mind</label>
                    <input type="number" name="attr_mind" />
                </div>
                <div class="grid">
                    <label>E</label>
                    <input type="number" name="attr_ability_e" />
                </div>
                <div class="grid">
                    <label>k</label>
                    <input type="number" name="attr_growth_5" />
                </div>
                <div class="grid">
                    <label>Intelligence</label>
                    <span class="input" name="attr_intelligence" />
                </div>
                <div class="grid">
                    <label>&divide;6</label>
                    <span class="input" name="attr_intelligence_modifier" />
                </div>

                <div class="grid">
                    <label>F</label>
                    <input type="number" name="attr_ability_f" />
                </div>
                <div class="grid">
                    <label>l</label>
                    <input type="number" name="attr_growth_6" />
                </div>
                <div class="grid">
                    <label>Spirit</label>
                    <span class="input" name="attr_spirit" />
                </div>
                <div class="grid">
                    <label>&divide;6</label>
                    <span class="input" name="attr_spirit_modifier" />
                </div>
            </div>
        </div>
    </div>
</div>


<script type="text/worker">

const base_list = ["skill","body","mind"];
const ability_list = ["dexterity","agility","strength","vitality","intelligence","spirit"];
const correction_list = "abcdef".split("");
const growth_list = "123456".split("");
const total_list = base_list
    .concat(correction_list.map(i => "ability_" + i))
    .concat(growth_list.map(i => "growth_" + i));

total_list.forEach(trigger => {
    on(`change:${trigger}`, function() {
        getAttrs(total_list, function(values) {
            let update = {};
            let counter = 0;
            base_list.forEach(base => {
                let base_value = parseInt(values[`${base}`])||0;
                for (let i = 0; i < 2; i++) {
                    let correction = correction_list[counter];
                    let correction_value = parseInt(values[`ability_${correction}`])||0;
                    let growth = counter + 1;
                    let growth_value = parseInt(values[`growth_${growth}`])||0;
                    let ability = ability_list[counter];
                    let score = base_value + correction_value + growth_value;
                    let modifier = Math.floor(score / 6);
                    update[`${ability}`] = score;
                    update[`${ability}_modifier`] = modifier;
                    counter++;
                }
            });
            setAttrs(update);
        });
    });
});

</script>
