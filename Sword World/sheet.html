<input class="toggle-tabs" type="hidden" name="attr_tab" value="page1"  />
<input class="adventurer-level" type="hidden" name="attr_adventurer_level" />

<div class="tabs">
    <div class="tab-page1"><button type="action"
        name="act_page1">Page 1</button></div>
    <div class="tab-page2"><button type="action"
        name="act_page2">Page 2</button></div>
    <div class="tab-settings"><button type="action"
        name="act_settings">Settings</button></div>
</div>

<div class="grid col2-main page1">
    <div class="grid">
        <div class="grid guild nogap">
            <img name="attr_character_avatar" />

            <div class="grid col2-guild">
                <div class="grid">
                    <div class="grid col2 vcol">
                        <label>Reputation</label>
                        <input type="text" spellcheck="false" name="attr_reputation" value="Hollow" />

                        <label>Points</label>
                        <input type="text" spellcheck="false" name="attr_reputation_points" value="0" />
                    </div>

                    <div class="grid col2 vcol">
                        <label>Rank</label>
                        <input type="text" spellcheck="false" name="attr_rank" value="None" />

                        <label>Grade</label>
                        <input type="text" spellcheck="false" name="attr_grade" />
                    </div>
                </div>

                <div class="grid alevel">
                    <label>Adventurer Level</label>
                    <span class="input" name="attr_adventurer_level" />
                </div>
            </div>
        </div>

        <div class="grid profile">
            <span class="label">History, Profile</span>
            <label>Background</label>
            <div class="auto-expand disease">
                <span name="attr_background"></span>
                <textarea spellcheck="false" name="attr_background"></textarea>
            </div>

            <div class="grid col4-xp">
                <label>Experience Points</label>
                <input type="number" name="attr_experience" />

                <label>Soulscars</label>
                <input type="number" name="attr_soulscars" value="0" />
            </div>

            <div class="grid col2-failures">
                <label>Automatic Failures:</label>
                <div class="grid nogap">
                    <input type="radio" name="attr_automatic_failures" value="0" checked="checked" />

                    <input type="radio" name="attr_automatic_failures" value="1" />
                    <input type="radio" name="attr_automatic_failures" value="2" />
                    <input type="radio" name="attr_automatic_failures" value="3" />
                    <input type="radio" name="attr_automatic_failures" value="4" />
                    <input type="radio" name="attr_automatic_failures" value="5" />

                    <input type="radio" name="attr_automatic_failures" value="6" />
                    <input type="radio" name="attr_automatic_failures" value="7" />
                    <input type="radio" name="attr_automatic_failures" value="8" />
                    <input type="radio" name="attr_automatic_failures" value="9" />
                    <input type="radio" name="attr_automatic_failures" value="10" />

                    <input type="radio" name="attr_automatic_failures" value="11" />
                    <input type="radio" name="attr_automatic_failures" value="12" />
                    <input type="radio" name="attr_automatic_failures" value="13" />
                    <input type="radio" name="attr_automatic_failures" value="14" />
                    <input type="radio" name="attr_automatic_failures" value="15" />
                </div>
            </div>
        </div>

        <div class="grid nogap lined">
            <div class="grid col3-languages nogap">
                <div class="header">Languages</div>
                <div class="header">Speak</div>
                <div class="header">Read</div>

                <div class="input">Trade Common</div>
                <div><span class="check-yes input" /></div>
                <div><span class="check-yes input" /></div>

                <input type="text" spellcheck="false" name="attr_language_regional" placeholder="Regional( )" />
                <div><input type="checkbox" name="attr_language_regional_speak" value="yes" /></div>
                <div><input type="checkbox" name="attr_language_regional_read" value="yes" /></div>

                <div class="input">Ancient Celestial</div>
                <div><span class="check-na input" /></div>
                <div><input type="checkbox" name="attr_language_celestial_read" value="yes" /></div>

                <div class="input">Arcana</div>
                <div><input type="checkbox" name="attr_language_arcana_speak" value="yes" /></div>
                <div><input type="checkbox" name="attr_language_arcana_read" value="yes" /></div>

                <div class="input">Magitech</div>
                <div><input type="checkbox" name="attr_language_magitech_speak" value="yes" /></div>
                <div><input type="checkbox" name="attr_language_magitech_read" value="yes" /></div>

                <div class="input">Sylvan</div>
                <div><input type="checkbox" name="attr_language_sylvan_speak" value="yes" /></div>
                <div><span class="check-na input" /></div>

                <div class="input">Daemonic</div>
                <div><input type="checkbox" name="attr_language_daemonic_speak" value="yes" /></div>
                <div><span class="check-na input" /></div>

                <div class="input">Barbaric</div>
                <div><input type="checkbox" name="attr_language_barbaric_speak" value="yes" /></div>
                <div><input type="checkbox" name="attr_language_barbaric_read" value="yes" /></div>
            </div>
            <fieldset class="repeating_languages">
                <div><input type="text" spellcheck="false" name="attr_language_name" placeholder="Language" /></div>
                <div><input type="checkbox" name="attr_language_speak" value="yes" /></div>
                <div><input type="checkbox" name="attr_language_read" value="yes" /></div>
            </fieldset>
        </div>
    </div>

    <div class="grid">
        <div class="grid col2-header">
            <div class="grid">
                <div class="grid col2 vcol">
                    <label>Character Name</label>
                    <input type="text" spellcheck="false" name="attr_character_name" />

                    <label>Player Name</label>
                    <input type="text" spellcheck="false" name="attr_player_name" />
                </div>

                <div class="grid col3-race vcol">
                    <label>Race</label>
                    <input type="text" spellcheck="false" name="attr_race" />

                    <label>Age</label>
                    <input type="text" spellcheck="false" name="attr_age" />

                    <label>Gender</label>
                    <input type="text" spellcheck="false" name="attr_gender" />
                </div>

                <label>Racial Abilities</label>
                <fieldset class="repeating_racialabilities">
                    <input type="text" spellcheck="false" name="attr_racial_ability" />
                </fieldset>
            </div>

            <h1>Sword World 2.5</h1>
        </div>

        <div class="grid nogap">
            <div class="grid col5-abilities">
                <span class="header">Base</span>
                <span class="header">Correction</span>
                <span class="header">Growth</span>
                <span class="header">Ability Scores</span>
                <span class="header">Modifiers</span>
            </div>
            <div class="grid col5-abilities shaded">
                <div class="grid vspan2">
                    <label>Skill</label>
                    <input type="number" name="attr_skill" />
                </div>
                <div class="grid">
                    <label>A</label>
                    <input type="number" name="attr_ability_a" />
                </div>
                <div class="grid">
                    <label>g</label>
                    <input type="number" name="attr_growth_1" />
                </div>
                <div class="grid">
                    <label>Dexterity</label>
                    <input type="hidden" name="attr_dexterity" />
                    <span class="input" name="attr_dexterity" />
                </div>
                <div class="grid">
                    <label>&divide;6</label>
                    <input type="hidden" name="attr_dexterity_modifier" />
                    <span class="input" name="attr_dexterity_modifier" />
                </div>

                <div class="grid">
                    <label>B</label>
                    <input type="number" name="attr_ability_b" />
                </div>
                <div class="grid">
                    <label>h</label>
                    <input type="number" name="attr_growth_2" />
                </div>
                <div class="grid">
                    <label>Agility</label>
                    <input type="hidden" name="attr_agility" />
                    <span class="input" name="attr_agility" />
                </div>
                <div class="grid">
                    <label>&divide;6</label>
                    <input type="hidden" name="attr_agility_modifier" />
                    <span class="input" name="attr_agility_modifier" />
                </div>

                <div class="grid vspan2">
                    <label>Body</label>
                    <input type="number" name="attr_body" />
                </div>
                <div class="grid">
                    <label>C</label>
                    <input type="number" name="attr_ability_c" />
                </div>
                <div class="grid">
                    <label>i</label>
                    <input type="number" name="attr_growth_3" />
                </div>
                <div class="grid">
                    <label>Strength</label>
                    <input type="hidden" name="attr_strength" />
                    <span class="input" name="attr_strength" />
                </div>
                <div class="grid">
                    <label>&divide;6</label>
                    <input type="hidden" name="attr_strength_modifier" />
                    <span class="input" name="attr_strength_modifier" />
                </div>

                <div class="grid">
                    <label>D</label>
                    <input type="number" name="attr_ability_d" />
                </div>
                <div class="grid">
                    <label>j</label>
                    <input type="number" name="attr_growth_4" />
                </div>
                <div class="grid">
                    <label>Vitality</label>
                    <input type="hidden" name="attr_vitality" />
                    <span class="input" name="attr_vitality" />
                </div>
                <div class="grid">
                    <label>&divide;6</label>
                    <input type="hidden" name="attr_vitality_modifier" />
                    <span class="input" name="attr_vitality_modifier" />
                </div>

                <div class="grid vspan2">
                    <label>Mind</label>
                    <input type="number" name="attr_mind" />
                </div>
                <div class="grid">
                    <label>E</label>
                    <input type="number" name="attr_ability_e" />
                </div>
                <div class="grid">
                    <label>k</label>
                    <input type="number" name="attr_growth_5" />
                </div>
                <div class="grid">
                    <label>Intelligence</label>
                    <input type="hidden" name="attr_intelligence" />
                    <span class="input" name="attr_intelligence" />
                </div>
                <div class="grid">
                    <label>&divide;6</label>
                    <input type="hidden" name="attr_intelligence_modifier" />
                    <span class="input" name="attr_intelligence_modifier" />
                </div>

                <div class="grid">
                    <label>F</label>
                    <input type="number" name="attr_ability_f" />
                </div>
                <div class="grid">
                    <label>l</label>
                    <input type="number" name="attr_growth_6" />
                </div>
                <div class="grid">
                    <label>Spirit</label>
                    <input type="hidden" name="attr_spirit" />
                    <span class="input" name="attr_spirit" />
                </div>
                <div class="grid">
                    <label>&divide;6</label>
                    <input type="hidden" name="attr_spirit_modifier" />
                    <span class="input" name="attr_spirit_modifier" />
                </div>
            </div>
        </div>

        <div class="grid col2-classpack">
            <div class="grid nogap classes">
                <input class="toggle-class" type="hidden" name="attr_classtoggle" value="" />
                <input type="checkbox" name="attr_classtoggle" value="1" />
                <div class="grid col2-classes nogap">
                    <div class="header">Class</div>
                    <div class="header">Level</div>

                    <input class="toggle-class" type="hidden" name="attr_fighter_level" value="" />
                    <div class="input">Fighter</div>
                    <div><input type="number" name="attr_fighter_level" /></div>

                    <input class="toggle-class" type="hidden" name="attr_grappler_level" value="" />
                    <div class="input">Grappler</div>
                    <div><input type="number" name="attr_grappler_level" /></div>

                    <input class="toggle-class" type="hidden" name="attr_fencer_level" value="" />
                    <div class="input">Fencer</div>
                    <div><input type="number" name="attr_fencer_level" /></div>

                    <input class="toggle-class" type="hidden" name="attr_marksman_level" value="" />
                    <div class="input">Marksman</div>
                    <div><input type="number" name="attr_marksman_level" /></div>

                    <input class="toggle-class" type="hidden" name="attr_sorcerer_level" value="" />
                    <div class="input">Sorcerer</div>
                    <div><input type="number" name="attr_sorcerer_level" /></div>

                    <input class="toggle-class" type="hidden" name="attr_conjurer_level" value="" />
                    <div class="input">Conjurer</div>
                    <div><input type="number" name="attr_conjurer_level" /></div>

                    <input class="toggle-class" type="hidden" name="attr_priest_level" value="" />
                    <div class="input">Priest</div>
                    <div><input type="number" name="attr_priest_level" /></div>

                    <input class="toggle-class" type="hidden" name="attr_artificer_level" value="" />
                    <div class="input">Artificer</div>
                    <div><input type="number" name="attr_artificer_level" /></div>

                    <input class="toggle-class" type="hidden" name="attr_faerie_tamer_level" value="" />
                    <div class="input">Faerie Tamer</div>
                    <div><input type="number" name="attr_faerie_tamer_level" /></div>

                    <input class="toggle-class" type="hidden" name="attr_scout_level" value="" />
                    <div class="input">Scout</div>
                    <div><input type="number" name="attr_scout_level" /></div>

                    <input class="toggle-class" type="hidden" name="attr_ranger_level" value="" />
                    <div class="input">Ranger</div>
                    <div><input type="number" name="attr_ranger_level" /></div>

                    <input class="toggle-class" type="hidden" name="attr_sage_level" value="" />
                    <div class="input">Sage</div>
                    <div><input type="number" name="attr_sage_level" /></div>

                    <input class="toggle-class" type="hidden" name="attr_enhancer_level" value="" />
                    <div class="input">Enhancer</div>
                    <div><input type="number" name="attr_enhancer_level" /></div>

                    <input class="toggle-class" type="hidden" name="attr_bard_level" value="" />
                    <div class="input">Bard</div>
                    <div><input type="number" name="attr_bard_level" /></div>

                    <input class="toggle-class" type="hidden" name="attr_rider_level" value="" />
                    <div class="input">Rider</div>
                    <div><input type="number" name="attr_rider_level" /></div>

                    <input class="toggle-class" type="hidden" name="attr_alchemist_level" value="" />
                    <div class="input">Alchemist</div>
                    <div><input type="number" name="attr_alchemist_level" /></div>

                    <input class="toggle-class" type="hidden" name="attr_geomancer_level" value="" />
                    <div class="input">Geomancer</div>
                    <div><input type="number" name="attr_geomancer_level" /></div>

                    <input class="toggle-class" type="hidden" name="attr_tactician_level" value="" />
                    <div class="input">Tactician</div>
                    <div><input type="number" name="attr_tactician_level" /></div>
                </div>
            </div>

            <div class="grid col3-packages nogap">
                <div class="span2 label refmark">Check Packages</div>
                <div class="refmark">Treat as 0 if no levels in relevant classes</div>

                <div class="grid nogap box">
                    <input class="class-level" type="hidden" value="" name="attr_scout_level" />
                    <label>Scout</label>
                    <span name="attr_scout_level" />

                    <input class="class-level" type="hidden" value="" name="attr_ranger_level" />
                    <label>Ranger</label>
                    <span name="attr_ranger_level" />

                    <input class="class-level" type="hidden" value="" name="attr_rider_level" />
                    <label>Rider</label>
                    <span name="attr_rider_level" />

                    <input class="class-level" type="hidden" value="" name="attr_geomancer_level" />
                    <label>Geomancer</label>
                    <span name="attr_geomancer_level" />
                </div>

                <div class="grid col2 span2">
                    <div>Dexterity Modifier</div>
                    <div class="grid">
                        <label>Technique</label>
                        <input type="hidden" name="attr_technique" />
                        <span class="input" name="attr_technique" />
                    </div>

                    <div>Agility Modifier</div>
                    <div class="grid">
                        <label>Movement</label>
                        <input type="hidden" name="attr_movement" />
                        <span class="input" name="attr_movement" />
                    </div>

                    <div>Intelligence Modifier</div>
                    <div class="grid">
                        <label>Observation</label>
                        <input type="hidden" name="attr_observation" />
                        <span class="input" name="attr_observation" />
                    </div>
                </div>

                <div class="grid nogap box">
                    <input class="class-level" type="hidden" value="" name="attr_sage_level" />
                    <label>Sage</label>
                    <span name="attr_sage_level" />

                    <input class="class-level" type="hidden" value="" name="attr_alchemist_level" />
                    <label>Alchemist</label>
                    <span name="attr_alchemist_level" />
                </div>

                <div class="grid col2 span2">
                    <div>Intelligence Modifier</div>
                    <div class="grid">
                        <label>Knowledge</label>
                        <input type="hidden" name="attr_knowledge" />
                        <span class="input" name="attr_knowledge" />
                    </div>
                </div>
            </div>
        </div>

        <div class="grid col2">
            <div class="grid nogap lined single">
                <div class="grid col2-feats nogap">
                    <div class="header" />
                    <div class="header">Combat Feats</div>

                    <label>1</label>
                    <input type="text" spellcheck="false" name="attr_feat_1" />
                    <label>3</label>
                    <input type="text" spellcheck="false" name="attr_feat_3" />
                    <label>5</label>
                    <input type="text" spellcheck="false" name="attr_feat_5" />
                    <label>7</label>
                    <input type="text" spellcheck="false" name="attr_feat_7" />
                    <label>9</label>
                    <input type="text" spellcheck="false" name="attr_feat_9" />
                    <label>11</label>
                    <input type="text" spellcheck="false" name="attr_feat_11" />
                    <label>13</label>
                    <input type="text" spellcheck="false" name="attr_feat_13" />
                    <label>15</label>
                    <input type="text" spellcheck="false" name="attr_feat_15" />
                </div>
                <div class="label">Automatically acquired, etc.</div>
                <fieldset class="repeating_feats">
                    <div><input type="text" spellcheck="false" name="attr_feat_name" placeholder="Name" /></div>
                </fieldset>
            </div>

            <div class="grid nogap lined single">
                <div class="header">Techniques, Spellsongs, Stunts, etc.</div>
                <fieldset class="repeating_techniques">
                    <div><input type="text" spellcheck="false" name="attr_technique_name" placeholder="Name" /></div>
                </fieldset>
            </div>
        </div>
    </div>
</div>

<div class="grid page2">
    <div class="grid col8-initmove nogap">
        <div class="grid nogap box">
            <input class="class-level" type="hidden" value="" name="attr_sage_level" />
            <label>Sage</label>
            <span name="attr_sage_level" />

            <input class="class-level" type="hidden" value="" name="attr_rider_level" />
            <label>Rider</label>
            <span name="attr_rider_level" />
        </div>

        <div class="grid col2">
            <div>Intelligence Modifier</div>
            <div class="grid">
                <label class="refmark">Monster Knowledge</label>
                <input type="hidden" name="attr_monster_knowledge" />
                <span class="input" name="attr_monster_knowledge" />
            </div>
        </div>

        <div class="grid nogap box">
            <input class="class-level" type="hidden" value="" name="attr_scout_level" />
            <label>Scout</label>
            <span name="attr_scout_level" />

            <input class="class-level" type="hidden" value="" name="attr_tactician_level" />
            <label>Tactician</label>
            <span name="attr_tactician_level" />
        </div>

        <div class="grid col2">
            <div>Agility Modifier</div>
            <div class="grid">
                <label class="refmark">Initiative</label>
                <input type="hidden" name="attr_initiative" />
                <span class="input" name="attr_initiative" />
            </div>
        </div>

        <div class="refmark">Treat as 0 if no levels in relevant classes</div>
        <div class="grid boxstat move">
            <label>Limited Move</label>
            <input type="hidden" name="attr_limited_move" value="3" />
            <span class="input" name="attr_limited_move" />
        </div>
        <div class="grid boxstat move">
            <label>Normal Move</label>
            <span class="label">Agility</span>
            <input type="hidden" name="attr_normal_move" />
            <span class="input" name="attr_normal_move" />
        </div>
        <div class="grid boxstat move">
            <label>Full Move</label>
            <input type="hidden" name="attr_full_move" />
            <span class="input" name="attr_full_move" />
        </div>
    </div>

    <div class="grid col3-accdmg nogap">
        <div class="grid nogap box wide">
            <input class="class-level" type="hidden" value="" name="attr_fighter_level" />
            <label>Fighter</label>
            <span name="attr_fighter_level" />

            <input class="class-level" type="hidden" value="" name="attr_grappler_level" />
            <label>Grappler</label>
            <span name="attr_grappler_level" />

            <input class="class-level" type="hidden" value="" name="attr_fencer_level" />
            <label>Fencer</label>
            <span name="attr_fencer_level" />

            <input class="class-level" type="hidden" value="" name="attr_marksman_level" />
            <label>Marksman</label>
            <span name="attr_marksman_level" />
        </div>

        <div class="grid col2 nogap">
            <div>Dexterity Modifier</div>
            <div class="grid">
                <label class="refmark">Base Accuracy</label>
                <input type="hidden" name="attr_base_accuracy" />
                <span class="input" name="attr_base_accuracy" />
            </div>

            <div>Strength Modifier</div>
            <div class="grid">
                <label class="refmark">Extra Damage</label>
                <input type="hidden" name="attr_extra_damage" />
                <span class="input" name="attr_extra_damage" />
            </div>
        </div>

        <div class="grid boxstat">
            <label>Movement Enhancements</label>
            <div class="grid col2">
                <div><input type="text" spellcheck="false" name="attr_movement_enhancements" /></div>
                <div><input type="number" name="attr_movement_enhancements_modifier" /></div>
            </div>
        </div>
    </div>
</div>

<div class="grid settings">
    <h2>Settings</h2>
</div>

<script type="text/worker">

    const tab_list = ["page1","page2","settings"];
    const base_list = ["skill","body","mind"];
    const ability_list = ["dexterity","agility","strength","vitality","intelligence","spirit"];
    const ability_modifier_list = ability_list.map(i => i + "_modifier");
    const correction_list = "abcdef".split("");
    const growth_list = "123456".split("");
    const total_list = base_list
        .concat(correction_list.map(i => "ability_" + i))
        .concat(growth_list.map(i => "growth_" + i))
        .concat(["movement_enhancements_modifier"]);

    const class_list = ["fighter","grappler","fencer","marksman","sorcerer",
        "conjurer","priest","artificer","faerie_tamer","scout","ranger",
        "sage","enhancer","bard","rider","alchemist","geomancer","tactician"];
    const class_level_list = class_list.map(i => i + "_level");
    const package_data = {
        "technique": {
            "classes": ["scout","ranger"],
            "ability": "dexterity"
        },
        "movement": {
            "classes": ["scout","ranger","rider"],
            "ability": "agility"
        },
        "observation": {
            "classes": ["scout","ranger","rider","geomancer"],
            "ability": "intelligence"
        },
        "knowledge": {
            "classes": ["sage","alchemist"],
            "ability": "intelligence"
        },
        "monster_knowledge": {
            "classes": ["sage","rider"],
            "ability": "intelligence"
        },
        "initiative": {
            "classes": ["scout","tactician"],
            "ability": "agility"
        },
        "base_accuracy": {
            "classes": ["fighter","grappler","fencer","marksman"],
            "ability": "dexterity"
        },
        "extra_damage": {
            "classes": ["fighter","grappler","fencer","marksman"],
            "ability": "strength"
        }
    };
    const package_list = Object.keys(package_data);

    tab_list.forEach(button => {
        on(`clicked:${button}`, function() {
            setAttrs({"tab": button});
        });
    });

    total_list.forEach(trigger => {
        on(`change:${trigger}`, function() {
            getAttrs(total_list, function(values) {
                let update = {};
                let counter = 0;
                let move_mod = parseInt(values["movement_enhancements_modifier"])||0;
                base_list.forEach(base => {
                    let base_value = parseInt(values[`${base}`])||0;
                    for (let i = 0; i < 2; i++) {
                        let correction = correction_list[counter];
                        let correction_value = parseInt(values[`ability_${correction}`])||0;
                        let growth = counter + 1;
                        let growth_value = parseInt(values[`growth_${growth}`])||0;
                        let ability = ability_list[counter];
                        let score = base_value + correction_value + growth_value;
                        let modifier = Math.floor(score / 6);
                        update[`${ability}`] = score;
                        update[`${ability}_modifier`] = modifier;
                        if (ability == "agility") {
                            update["normal_move"] = score + move_mod;
                            update["full_move"] = (score + move_mod) * 3;
                        }
                        counter++;
                    }
                });
                setAttrs(update);
            });
        });
    });

    class_level_list.forEach(trigger => {
        on(`change:${trigger}`, function() {
            getAttrs(class_level_list.concat(ability_modifier_list), function(values) {
                let update = {};
                let level = 0;
                class_level_list.forEach(v => {
                    let class_level = parseInt(values[`${v}`])||0;
                    level = class_level > level ? class_level : level;
                });
                update["adventurer_level"] = level;

                package_list.forEach(package => {
                    let package_level = 0;
                    let ability = package_data[package]["ability"];
                    let package_ability = values[`${ability}_modifier`];
                    package_data[package]["classes"].forEach(v => {
                        let class_level = parseInt(values[`${v}_level`])||0;
                        package_level = class_level > package_level ? class_level : package_level;
                    });
                    if (package_level > 0) {
                        package_level += package_ability;
                        update[`${package}`] = package_level;
                    } else {
                        update[`${package}`] = "";
                    }
                });
                setAttrs(update);
            });
        });
    });

</script>
