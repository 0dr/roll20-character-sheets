	<section class="tabs borderless">
		<input type="hidden" class="tabstoggle" name="attr_sheetTab"  value="charactersheet"  />
		<div class="tabholder">
				<button type="action" name="act_charactersheet" >Character</button>
				<button type="action" name="act_basesheet" >Base</button>
				<button type="action" name="act_campaignsheet" >Campaign</button>
		</div>
		<span class="briny-setting">
			<label class="inline setting">Briny Bastards?</label>
			<input class="sheet-briny" name="attr_briny" type="checkbox">
		</span>
		<hr class="divide">
	</section>
	
<input type="hidden" class="tabstoggle" name="attr_sheetTab"  value="charactersheet"  />
<div class="charactersheet">
<main>
	<section class="header f-center flexheader borderless">
	<div class="stack header-left empty"></div>
	<div class="stack header-left">
		<div class="autoExpand long">
		 <input spellcheck="false" class="header-input" name="attr_character_name" type="text">
		 <span name="attr_character_name"></span>
		</div>
		<hr class="underline nintety">
		<label>Name</label>
	</div>

	<div class="stack header-right">
		
		<div class="autoExpand">
		 <input spellcheck="false" class="header-input" name="attr_character_mutator" type="text">
		 <span name="attr_character_mutator"></span>
		</div>
		<hr class="underline">
		<label>Mutator</label>
		
		<div class="autoExpand">
		 <input spellcheck="false" class="header-input" name="attr_character_megacorp" type="text">
		 <span name="attr_character_megacorp"></span>
		</div>
		<hr class="underline">
		<label>Megacorp</label>
		
		<div class="autoExpand">
		 <input spellcheck="false" class="header-input" name="attr_character_career" type="text">
		 <span name="attr_character_career"></span>
		</div>
		<hr class="underline">
		<label>Career</label>
		
		<div class="autoExpand">
		 <input spellcheck="false" class="header-input" name="attr_character_next_of_kin" type="text">
		 <span name="attr_character_next_of_kin"></span>
		</div>
		<hr class="underline">
		<label>Next of Kin</label>
	</div>
	</section>

	<section class="powers">
		<h2>All Known Powers</h2>
	<fieldset class="repeating_powers">
		<label class="inline">Equipped?</label>
		<input type="checkbox" name="attr_equipped">
		<button type="roll"  name="roll_power" value="&{template:powers} {{title=Power}} {{name=@{character_name}}} {{description=@{powertext}}} {{cost=@{powercost}}} {{powerName=@{powername}}}"></button>
		<input class="powername" spellcheck="false" type="text" name="attr_powername" value="Name">
		<span class="right">
			<label class="inline">Biotech Cost</label>
			<input class="cost" type="text" name="attr_powercost" value="">
		</span>
		<textarea spellcheck="false" name="attr_powertext"></textarea>
	</fieldset>
	</section>
	
	<section class="portrait borderless">
		<h4 class="caption">Portrait of Applicant</h4>
	<img class="charPort" name="attr_character_avatar">
	</section>
	
	




	<section class="borderless settings">
		<span>
			<button type="action" title="Reset HP and Biotech to max, un-use all items and drones. Optionally unequip all powers." name="act_reset">Reset</button>
			<label class="inline setting">Unequip powers on reset?</label>
			<input class="" name="attr_resetpowers" type="checkbox" value="true">
		</span>
	</section>

	<section class="background f-col">
		<h3 class="sidebar">Background</h3>
	<div class="sideholder">
			<input type="number" class="sidebar-input" name="attr_debt">
		<label>Debt</label>
		<hr class="overline">
	</div>
	
	<div class="sideholder">
			<input type="number" class="sidebar-input" name="attr_scrip">
		<label>Scrip</label>
		<hr class="overline">
	</div>	
	
	<div class="sideholder">
			<input type="number" class="sidebar-input" name="attr_downtime_dice">
		<label>Downtime Dice</label>
		<hr class="overline">
	</div>
	
	<div class="sideholder">
			<input type="number" class="sidebar-input" name="attr_gear_parts">
		<label>Gear Parts</label>
		<hr class="overline">
	</div>

	<div class="sideholder">
			<input type="number" class="sidebar-input" name="attr_construction_pieces">
		<label>Construction Pieces</label>
		<hr class="overline">
	</div>
	
	<h3 class="sidebar">Attributes</h3>

	<div class="sideholder">
			<input type="number" min="0" class="sidebar-input attr" name="attr_smash" value="0">
		<label>Smash</label>
		<button type="roll" value="&{template:attributeroll} {{title=Smash}} {{name=@{character_name}}} {{roll=@{roll_formula_smash}}} {{results=@{roll_results_smash}}} {{details=Smash Smash SMASH!}} {{success_at_cost=@{smash_fail}}} {{smash=1}}"></button>
		<hr class="overline">
	</div>
	
	<div class="sideholder">
			<input type="number" min="0" class="sidebar-input attr" name="attr_sly"  value="0">
		<label>Sly</label>
		<button type="roll" value="&{template:attributeroll} {{title=Sly}} {{name=@{character_name}}} {{roll=@{roll_formula_sly}}} {{results=@{roll_results_sly}}} {{details=Sneaky slyly secretly, gently as we go}} {{success_at_cost=@{sly_fail}}} {{sly=1}}"></button>
		<hr class="overline">
	</div>
	
	<div class="sideholder">
			<input type="number" min="0" class="sidebar-input attr" name="attr_cyber"  value="0">
		<label>Cbyer</label>
		<button type="roll" value="&{template:attributeroll} {{title=Cyber}} {{name=@{character_name}}} {{roll=@{roll_formula_cyber}}} {{results=@{roll_results_cyber}}} {{details=beeep booop 11010010 processing data}} {{success_at_cost=@{cyber_fail}}} {{cyber=1}}"></button>
		<hr class="overline">
	</div>
	
	<div class="sideholder">
			<input type="number" min="0" class="sidebar-input attr" name="attr_soak">
		<label>Soak</label>
		<hr class="overline">
	</div>
	
	<div class="sideholder">
			<input type="number" min="0" class="sidebar-input attr" name="attr_shard">
		<label>Shard</label>
		<hr class="overline">
	</div>
	
	<div class="sideholder">
			<input type="number" min="0" class="sidebar-input attr" name="attr_barrier">
		<label>Barrier</label>
		<hr class="overline">
	</div>
	
	<h4 class="sidebar">Health</h4>
	<div class="minmax">
		<input type="number" min="0" class="sidebar-input minmax" name="attr_hp">
		<span class="minmax">/</span>
		<input type="number" min="0" class="sidebar-input minmax" name="attr_hpmax">
	</div>
	
	<h4 class="sidebar">Biotech</h4>
	<div class="minmax">
		<input type="number" min="0" class="sidebar-input minmax" name="attr_bio">
		<span class="minmax">/</span>
		<input type="number" min="0" class="sidebar-input minmax" name="attr_biomax">
	</div>
	
	<input class="hidden sheet-briny" name="attr_briny" type="checkbox">
	<div class="briny">
		<h4 class="briny">Relationships</h4>
		<label>Grieving </label>
		<div class="outergrief">
			<button type="action" name="act_griefbtn" class="d6 btn grief"></button>
				<div class="grief">
					<input type="radio" id="step-6" value="6" name="attr_grief" class="progressbar__radio">
					<label for="step-6" class="progressbar__label">6</label>
					<input type="radio" id="step-5" value="5" name="attr_grief" class="progressbar__radio">
					<label for="step-5" class="progressbar__label">5</label>
					<input type="radio" id="step-4" value="4" name="attr_grief" class="progressbar__radio">
					<label for="step-4" class="progressbar__label">4</label>
					<input type="radio" id="step-3" value="3" name="attr_grief" class="progressbar__radio">
					<label for="step-3" class="progressbar__label">3</label>
					<input type="radio" id="step-2" value="2" name="attr_grief" class="progressbar__radio">
					<label for="step-2" class="progressbar__label">2</label>
					<input type="radio" id="step-1" value="1" name="attr_grief" class="progressbar__radio" checked>
					<label for="step-1" class="progressbar__label">1</label>
					<input type="radio" id="step-0" value="0" name="attr_grief" class="progressbar__radio" checked>
					<label for="step-0" class="progressbar__label">0</label>
				</div>
		</div>
		
		<fieldset class="repeating_relationship">
		
			<label class="inline rellabel">With</label>
			<input class="inline relinput" type="text" name="attr_relationship_target" value="Operative Name">
			
			<label class="inline rellabel">Type</label>
			<input type="text" list="relationships" name="attr_relationship_type">
			
			<textarea class="adjustable" spellcheck="false" name="attr_relationship_details">Details</textarea>
		</fieldset>
	</div>
	</section>

	<section class="gear">
		<h3>Gear</h3>
		<h4>Armor</h4>
		<fieldset class="repeating_armor">
		<button type="roll" name="roll_armor" value="&{template:powers} {{title=Armor}} {{name=@{character_name}}} {{description=@{armortext}}} {{powerName=@{armorname}}}"></button>
		
		<input class="item"  spellcheck="false" type="text" name="attr_armorname" value="Name">
		<textarea spellcheck="false" name="attr_armortext">Tags and upgrades</textarea>
	</fieldset>
	
		<h4 class="second">Weapons</h4>
	<fieldset class="repeating_weapon">
		<button type="roll" name="roll_weapon" value="&{template:powers} {{title=Weapon}} {{name=@{character_name}}} {{description=@{weapontext}}} {{powerName=@{weaponname}}} {{harm=@{harm}}}"></button>
		<input class="weapon" spellcheck="false" type="text" name="attr_weaponname" value="Name">
		<label class="harmlabel">Harm</label>
		<input class="harmcounter" type="number" name="attr_harm" value="1">
		<span class="ammo">
			<label>Ammo:</label>
			<input type="number" value="1" name="attr_ammo"></input>
			<p class="slash">/</p>
			<input type="number"value="1" name="attr_max_ammo"></input>
			<button type="action" class="btn" name="act_reload">Reload</button>
		</span>
		<textarea spellcheck="false" name="attr_weapontext">Tags and upgrades</textarea>
	</fieldset>
	
	</section>
	
	<section class="items">
	<h3>Items</h3>
		<fieldset class="repeating_item">
		
			<!-- Hidden prop so it apepars first -->
			<input class="hidden sheer-disabler" type="checkbox" name="attr_used">
			
			<button disabled="true" class="disab inline" type="roll" name="roll_item" value="/em uses @{itemname}. @{itemtext} TODO USE TEMPLATE."></button>
			
			<button type="roll"  name="roll_item" value="&{template:powers} {{title=Item}} {{name=@{character_name}}} {{description=@{itemtext}}} {{powerName=@{itemname}}}"></button>
			
			<input class="item" spellcheck="false" type="text" name="attr_itemname" value="Name">
			<label class="inline">Used?</label>
			<input type="checkbox" name="attr_used">
			<textarea spellcheck="false" name="attr_itemtext">Description</textarea>
		</fieldset>
	
	<input class="hidden sheet-briny" name="attr_briny" type="checkbox">
	<div class="briny">
	<h4 class="briny">Drones</h4>
	
	<h5>Equipped Protocols</h5>
		<fieldset class="repeating_drone">
		
			<!-- Hidden prop so it apepars first -->
			<input class="hidden sheer-disabler" type="checkbox" name="attr_used">
		
			<!-- Duplicate buttons for disable on used -->
			<button disabled="true" class="disab inline sheet-d6-dice" type="roll" </button>
			<button type="roll"  name="roll_drone" value="&{template:powers} {{title=Protocol}} {{name=@{character_name}}} {{description=@{dronetext}}} {{powerName=@{dronename}}}"></button>
			
			<input class="item" spellcheck="false" type="text" name="attr_dronename" value="Name">
			<label class="inline">Used?</label>
			<input class="sheer-disabler" type="checkbox" name="attr_used">
			<textarea spellcheck="false" name="attr_dronetext">Description</textarea>
		</fieldset>
		
		<hr class="separator">
	<h5>Known Protocols</h5>
	<fieldset class="repeating_drone">
			<input class="item" spellcheck="false" type="text" name="attr_dronename" value="Name">
			<textarea spellcheck="false" name="attr_dronetext">Description</textarea>
		</fieldset>
	</div>
	</section>
	
	<section class="loadout">
		<h3>Loadout</h3>
		<fieldset class="repeating_powers filtered_powers">
			<input class="hidden equipped" type="checkbox" name="attr_equipped">
			<button type="roll"  name="roll_power" value="&{template:powers} {{title=Power}} {{name=@{character_name}}} {{description=@{powertext}}} {{cost=@{powercost}}} {{powerName=@{powername}}}"></button>
			<input class="powername" spellcheck="false" type="text" name="attr_powername" value="Name">
			<span class="right">
				<label class="inline">Biotech Cost</label>
				<input class="cost" type="text" name="attr_powercost" value="">
			</span>
			<textarea class="powertext" spellcheck="false" name="attr_powertext"></textarea>
		</fieldset>
	</section>
	
	<section class="notes">
		<h3>Notes</h3>
		<textarea class="textnotes" name="attr_notes"></textarea>
	</section>

</main>
</div>

<!-- End Character Sheet -->

<!-- Begin Base Sheet -->
<input class="hidden sheet-briny" name="attr_briny" type="checkbox">
<input type="hidden" class="tabstoggle" name="attr_sheetTab"  value="charactersheet"  />
<div class="basesheet">
	<div class="mainbase">
		
		<section class="basehead f-center flexheader borderless">
			<h2 class="pull-left">BASEBUILDING</h2>
			<div class="stack header-left empty"></div>
			<div class="stack header-left">
				<div class="autoExpand long">
				 <input spellcheck="false" class="header-input" name="attr_base_name" type="text">
				 <span name="attr_base_name"></span>
				</div>
				<hr class="underline nintety">
				<label>Name Of Base</label>
			</div>

			<div class="stack header-right">
				

				
				<div class="autoExpand">
				 <input spellcheck="false" class="header-input" name="attr_base_location" type="text">
				 <span name="attr_base_location"></span>
				</div>
				<hr class="underline">
				<label>Location</label>
				
				<div class="autoExpand">
				 <input spellcheck="false" class="header-input" name="attr_base_adj1" type="text">
				 <span name="attr_base_adj1"></span>
				</div>
				<hr class="underline">
				<label>Adjective</label>
				
				<div class="autoExpand">
				 <input spellcheck="false" class="header-input" name="attr_base_adj2" type="text">
				 <span name="attr_base_adj2"></span>
				</div>
				<hr class="underline">
				<label>Adjective</label>
			</div>
		</section>

		<section class="room room1">
			<input type="checkbox" class="hidden baselocked" name="attr_baselockedroom1"></input>
			<label class="basecost"></label>
			<input type="text" list="corebuildings" class="buildinglist corebuildings" name="attr_buildingnameroom1"></input>
			<input type="text" list="brinybuildings" class="buildinglist brinybuildings" name="attr_buildingnameroom1"></input>
			<textarea class="roomtext" spellcheck="false" name="attr_roomtext1"></textarea>
			<span class="baselocker">
				<input type="checkbox" class="baselocked" name="attr_baselockedroom1"></input>
				<label class="inline baselabel">locked</label>
			</span>
		</section>

		<section class="room room2">
			<input type="checkbox" class="hidden baselocked" name="attr_baselockedroom2"></input>
			<label class="basecost"></label>
			<input type="text" list="corebuildings" class="buildinglist corebuildings" name="attr_buildingnameroom2"></input>
			<input type="text" list="brinybuildings" class="buildinglist brinybuildings" name="attr_buildingnameroom2"></input>
			<textarea class="roomtext" spellcheck="false" name="attr_roomtext2"></textarea>
			<span class="baselocker">
				<input type="checkbox" class="baselocked" name="attr_baselockedroom2" ></input>
				<label class="inline baselabel">locked</label>
			</span>
		</section>

		<section class="room room3">
			<input type="checkbox" class="hidden baselocked" name="attr_baselockedroom3" checked></input>
			<label class="basecost">1</label>
			<input type="text" list="corebuildings" class="buildinglist corebuildings" name="attr_buildingnameroom3"></input>
			<input type="text" list="brinybuildings" class="buildinglist brinybuildings" name="attr_buildingnameroom3"></input>
			<textarea class="roomtext" spellcheck="false" name="attr_roomtext3"></textarea>
			<span class="baselocker">
				<input type="checkbox" class="baselocked" name="attr_baselockedroom3" checked></input>
				<label class="inline baselabel">locked</label>
			</span>
		</section>

		<section class="room room4">
			<input type="checkbox" class="hidden baselocked" name="attr_baselockedroom4" checked></input>
			<label class="basecost">1</label>
			<input type="text" list="corebuildings" class="buildinglist corebuildings" name="attr_buildingnameroom4"></input>
			<input type="text" list="brinybuildings" class="buildinglist brinybuildings" name="attr_buildingnameroom4"></input>
			<textarea class="roomtext" spellcheck="false" name="attr_roomtext4"></textarea>
			<span class="baselocker">
				<input type="checkbox" class="baselocked" name="attr_baselockedroom4" checked></input>
				<label class="inline baselabel">locked</label>
			</span>
		</section>

		<section class="room room5">
			<input type="checkbox" class="hidden baselocked" name="attr_baselockedroom5" checked></input>
			<label class="basecost">2</label>
			<input type="text" list="corebuildings" class="buildinglist corebuildings" name="attr_buildingnameroom5"></input>
			<input type="text" list="brinybuildings" class="buildinglist brinybuildings" name="attr_buildingnameroom5"></input>
			<textarea class="roomtext" spellcheck="false" name="attr_roomtext5"></textarea>
			<span class="baselocker">
				<input type="checkbox" class="baselocked" name="attr_baselockedroom5" checked></input>
				<label class="inline baselabel">locked</label>
			</span>
		</section>

		<section class="room room6">
			<input type="checkbox" class="hidden baselocked" name="attr_baselockedroom6" checked></input>
			<label class="basecost">2</label>
			<input type="text" list="corebuildings" class="buildinglist corebuildings" name="attr_buildingnameroom6"></input>
			<input type="text" list="brinybuildings" class="buildinglist brinybuildings" name="attr_buildingnameroom6"></input>
			<textarea class="roomtext" spellcheck="false" name="attr_roomtext6"></textarea>
			<span class="baselocker">
				<input type="checkbox" class="baselocked" name="attr_baselockedroom6" checked></input>
				<label class="inline baselabel">locked</label>
			</span>
		</section>

		<section class="room room7">
			<input type="checkbox" class="hidden baselocked" name="attr_baselockedroom7" checked></input>
			<label class="basecost">2</label>
			<input type="text" list="corebuildings" class="buildinglist corebuildings" name="attr_buildingnameroom7"></input>
			<input type="text" list="brinybuildings" class="buildinglist brinybuildings" name="attr_buildingnameroom7"></input>
			<textarea class="roomtext" spellcheck="false" name="attr_roomtext7"></textarea>
			<span class="baselocker">
				<input type="checkbox" class="baselocked" name="attr_baselockedroom7" checked></input>
				<label class="inline baselabel">locked</label>
			</span>
		</section>

		<section class="room room8">
			<input type="checkbox" class="hidden baselocked" name="attr_baselockedroom8" checked></input>
			<label class="basecost">2</label>
			<input type="text" list="corebuildings" class="buildinglist corebuildings" name="attr_buildingnameroom8"></input>
			<input type="text" list="brinybuildings" class="buildinglist brinybuildings" name="attr_buildingnameroom8"></input>
			<textarea class="roomtext" spellcheck="false" name="attr_roomtext8"></textarea>
			<span class="baselocker">
				<input type="checkbox" class="baselocked" name="attr_baselockedroom8" checked></input>
				<label class="inline baselabel">locked</label>
			</span>
		</section>

		<section class="room room9">
			<input type="checkbox" class="hidden baselocked" name="attr_baselockedroom9" checked></input>
			<label class="basecost">3</label>
			<input type="text" list="corebuildings" class="buildinglist corebuildings" name="attr_buildingnameroom9"></input>
			<input type="text" list="brinybuildings" class="buildinglist brinybuildings" name="attr_buildingnameroom9"></input>
			<textarea class="roomtext" spellcheck="false" name="attr_roomtext9"></textarea>
			<span class="baselocker">
				<input type="checkbox" class="baselocked" name="attr_baselockedroom9" checked></input>
				<label class="inline baselabel">locked</label>
			</span>
		</section>

		<section class="room room10">
			<input type="checkbox" class="hidden baselocked" name="attr_baselockedroom10" checked></input>
			<label class="basecost">3</label>
			<input type="text" list="corebuildings" class="buildinglist corebuildings" name="attr_buildingnameroom10"></input>
			<input type="text" list="brinybuildings" class="buildinglist brinybuildings" name="attr_buildingnameroom10"></input>
			<textarea class="roomtext" spellcheck="false" name="attr_roomtext10"></textarea>
			<span class="baselocker">
				<input type="checkbox" class="baselocked" name="attr_baselockedroom10" checked></input>
				<label class="inline baselabel">locked</label>
			</span>
		</section>

		<section class="room room11">
			<input type="checkbox" class="hidden baselocked" name="attr_baselockedroom11" checked></input>
			<label class="basecost">3</label>
			<input type="text" list="corebuildings" class="buildinglist corebuildings" name="attr_buildingnameroom11"></input>
			<input type="text" list="brinybuildings" class="buildinglist brinybuildings" name="attr_buildingnameroom11"></input>
			<textarea class="roomtext" spellcheck="false" name="attr_roomtext11"></textarea>
			<span class="baselocker">
				<input type="checkbox" class="baselocked" name="attr_baselockedroom11" checked></input>
				<label class="inline baselabel">locked</label>
			</span>
		</section>

		<section class="room room12">
			<input type="checkbox" class="hidden baselocked" name="attr_baselockedroom12" checked></input>
			<label class="basecost">3</label>
			<input type="text" list="corebuildings" class="buildinglist corebuildings" name="attr_buildingnameroom12"></input>
			<input type="text" list="brinybuildings" class="buildinglist brinybuildings" name="attr_buildingnameroom12"></input>
			<textarea class="roomtext" spellcheck="false" name="attr_roomtext12"></textarea>
			<span class="baselocker">
				<input type="checkbox" class="baselocked" name="attr_baselockedroom12" checked></input>
				<label class="inline baselabel">locked</label>
			</span>
		</section>

		<section class="room room13">
			<input type="checkbox" class="hidden baselocked" name="attr_baselockedroom13" checked></input>
			<label class="basecost">4</label>
			<input type="text" list="corebuildings" class="buildinglist corebuildings" name="attr_buildingnameroom13"></input>
			<input type="text" list="brinybuildings" class="buildinglist brinybuildings" name="attr_buildingnameroom13"></input>
			<textarea class="roomtext" spellcheck="false" name="attr_roomtext13"></textarea>
			<span class="baselocker">
				<input type="checkbox" class="baselocked" name="attr_baselockedroom13" checked></input>
				<label class="inline baselabel">locked</label>
			</span>
		</section>

		<section class="room room14">
			<input type="checkbox" class="hidden baselocked" name="attr_baselockedroom14" checked></input>
			<label class="basecost">4</label>
			<input type="text" list="corebuildings" class="buildinglist corebuildings" name="attr_buildingnameroom14"></input>
			<input type="text" list="brinybuildings" class="buildinglist brinybuildings" name="attr_buildingnameroom14"></input>
			<textarea class="roomtext" spellcheck="false" name="attr_roomtext14"></textarea>
			<span class="baselocker">
				<input type="checkbox" class="baselocked" name="attr_baselockedroom14" checked></input>
				<label class="inline baselabel">locked</label>
			</span>
		</section>

		<section class="room room15">
			<input type="checkbox" class="hidden baselocked" name="attr_baselockedroom15" checked></input>
			<label class="basecost">4</label>
			<input type="text" list="corebuildings" class="buildinglist corebuildings" name="attr_buildingnameroom15"></input>
			<input type="text" list="brinybuildings" class="buildinglist brinybuildings" name="attr_buildingnameroom15"></input>
			<textarea class="roomtext" spellcheck="false" name="attr_roomtext15"></textarea>
			<span class="baselocker">
				<input type="checkbox" class="baselocked" name="attr_baselockedroom15" checked></input>
				<label class="inline baselabel">locked</label>
			</span>
		</section>

		<section class="room room16">
			<input type="checkbox" class="hidden baselocked" name="attr_baselockedroom16" checked></input>
			<label class="basecost">4</label>
			<input type="text" list="corebuildings" class="buildinglist corebuildings" name="attr_buildingnameroom16"></input>
			<input type="text" list="brinybuildings" class="buildinglist brinybuildings" name="attr_buildingnameroom16"></input>
			<textarea class="roomtext" spellcheck="false" name="attr_roomtext16"></textarea>
			<span class="baselocker">
				<input type="checkbox" class="baselocked" name="attr_baselockedroom16" checked></input>
				<label class="inline baselabel">locked</label>
			</span>
		</section>

		<section class="basenotes">
			<h2>Notes</h2>
			<textarea name="attr_basenotes"></textarea>
		</section>




	
	</div>

</div>


<!-- End Base Sheet -->

<!-- Begin Campaign Sheet -->
<div class="campaignsheet"><input type="hidden" class="tabstoggle" name="attr_sheetTab"  value="charactersheet"  />
<h2>Campaign</h2>
</div>

<!-- End Campaign Sheet -->





<!-- Datalists & thing that don't show directly on sheet -->
	
	<input type="hidden" name="attr_smash_fail" value="lose 1 HP" />
	<input type="hidden" name="attr_cyber_fail" value="lose 1 Biotech" />
	<input type="hidden" name="attr_sly_fail" value="gain either Painted or Taunted" />
	<input type="hidden" name="attr_roll_formula_smash" value="" />
	<input type="hidden" name="attr_roll_results_cyber" value="" />
	<input type="hidden" name="attr_roll_results_sly" value="" />
	<input type="hidden" name="attr_roll_results_smash" value="" />
	<input type="hidden" name="attr_roll_formula_sly" value="" />
	<input type="hidden" name="attr_roll_formula_cyber" value="" />

<datalist id="relationships">
		<option>Confidant</option>
		<option>Crush</option>
		<option>Enemy</option>
		<option>Jeopordized</option>
		<option>Rival</option>
		<option>Strictly Professional</option>
</datalist>

<datalist id="corebuildings">
		<option>Armory</option>
		<option>Auguary</option>
		<option>Clinic</option>
		<option>Debt House</option>
		<option>Detonatorium</option>
		<option>Engineering Lab</option>
		<option>Gambling Den</option>
		<option>Gym</option>
		<option>Intel Center</option>
		<option>Interloper Ops</option>
		<option>Intern Recycler</option>
		<option>Plasma Lounge</option>
		<option>Refinery</option>
		<option>Smith</option>
		<option>Training Grounds</option>
		<option>Trauma Ward</option>
		<option>Valdivian Ops</option>
</datalist>

<datalist id="brinybuildings">
		<option>Artillery Lounge </option>
		<option>Auguary</option>
		<option>Biotech Refinery</option>
		<option>Breakroom</option>
		<option>Clinic</option>
		<option>Debt House</option>
		<option>Detonatorium</option>
		<option>Eminent Domainery </option>
		<option>Engineering Lab</option>
		<option>Gambling Den</option>
		<option>Gym</option>
		<option>Intel Center</option>
		<option>Interloper Ops</option>
		<option>Intern Recycler</option>
		<option>Library</option>
		<option>Observatory</option>
		<option>Pilot School</option>
		<option>Plasma Lounge</option>
		<option>Reeducation Chamber</option>
		<option>Refinery</option>
		<option>Repurposed Storage Facility</option>
		<option>Research Cells</option>
		<option>Sacrifice Booth</option>
		<option>Sentinel System</option>
		<option>Smith</option>
		<option>Training Grounds</option>
		<option>Trauma Ward</option>
		<option>Trophy Room</option>
		<option>Valdivian Ops</option>
		<option>Workbench</option>
</datalist>

<!-- roll templates -->

<rolltemplate class="sheet-rolltemplate-rolls">
	<div class="sheet-container">
		<div class="sheet-header">
			{{#title}}<div class="sheet-title">{{title}}</div>{{/title}}
			{{#name}}<div class="sheet-name">{{name}}</div>{{/name}}
			{{#subtitle}}<div class="sheet-subtitle">{{subtitle}}</div>{{/subtitle}}
		</div>
		<div class="sheet-content">
			{{#allprops() title name subtitle desc}}
			<div class="sheet-key">{{key}}</div>
			<div class="sheet-value">{{value}}</div>
			{{/allprops() title name subtitle desc}}
			{{#desc}}<div class="sheet-desc">{{desc}}</div>{{/desc}}
		</div>
	</div>
</rolltemplate>



<rolltemplate class="sheet-rolltemplate-powers">

			{{#title}}
				<div class="sheet-title">
				{{title}}
				</div>
			{{/title}}
			
			{{#name}}
				<div class="sheet-name">
					{{name}}
				</div>
			{{/name}}
				
			{{#powerName}}
				<div class="sheet-powername">
					{{powerName}}
				</div>
			{{/powerName}}
			
			{{#description}}
				<div class="sheet-description">
					{{description}}
				</div>
			{{/description}}
			
			{{#harm}}
				<div class="sheet-cost">
					{{harm}} Harm
				</div>
			{{/harm}}
			{{#cost}}
				<div class="sheet-cost">
					Biotech Cost: {{cost}}
				</div>
			{{/cost}}

</rolltemplate>


<rolltemplate class="sheet-rolltemplate-attributeroll">
	<div class="title">
		{{#smash}}
				<span class="smashtitle">{{title}}</span>
		{{/smash}}
		{{#sly}}
				<span class="slytitle">{{title}}</span>
		{{/sly}}
		{{#cyber}}
			<span class="cybertitle">{{title}}</span>
		{{/cyber}}
	</div>
	<div class="name">{{name}}</div>
	{{#roll}}<div class="roll">
		<div class="main-roll">{{roll}}</div>
		<div class="results-roll">{{results}}</div>
	</div>{{/roll}}
	<div class="result">
		{{#rollBetween() roll 1 2}}
		<span class="reprecussion">{{success_at_cost}}</span>
		{{/rollBetween() roll 1 2}}
		{{#rollBetween() roll 3 4}}
	<span class="reprecussion">You succeed, but {{success_at_cost}}</span>
		{{/rollBetween() roll 3 4}}
		{{#rollBetween() roll 5 6}}
		<span class="success">Sucess!</span>
		{{/rollBetween() roll 5 6}}
	</div>
	{{#details}}<div class="details">{{details}}</div>{{/details}}
</rolltemplate>


<!-- Scripts -->

<script type="text/worker">
const Rooms = {
	Armory: "Armory",
	Auguary: "Auguary",
	Clinic: "Clinic",
	Debt_House: "Debt House",
	Detonatorium: "Detonatorium",
	Engineering_Lab: "Engineering Lab",
	Gambling_Den: "Gambling Den",
	Gym: "Gym",
	Intel_Center: "Intel Center",
	Interloper_Ops: "Interloper Ops",
	Intern_Recycler: "Intern Recycler",
	Plasma_Lounge: "Plasma Lounge",
	Refinery: "Refinery",
	Smith: "Smith",
	Training_Grounds: "Training Grounds",
	Trauma_Ward: "Trauma Ward",
	Valdivian_Ops: "Valdivian Ops",
	Artillery_Lounge : 'Artillery Lounge ',
	Biotech_Refinery: 'Biotech Refinery',
	Breakroom: 'Breakroom',
	Eminent_Domainery : 'Eminent Domainery ',
	Library: 'Library',
	Observatory: 'Observatory',
	Pilot_School: 'Pilot School',
	Reeducation_Chamber: 'Reeducation Chamber',
	Repurposed_Storage_Facility: 'Repurposed Storage Facility',
	Research_Cells: 'Research Cells',
	Sacrifice_Booth: 'Sacrifice Booth',
	Sentinel_System: 'Sentinel System',
	Trophy_Room: 'Trophy Room',
	Workbench: 'Workbench'
}

const Relationships = {
	Confidant: 'Confidant',
	Crush: 'Crush',
	Enemy: 'Enemy',
	Jeopordized: 'Jeopordized',
	Rival: 'Rival',
	Strictly_Professional: 'Strictly Professional',
	Other: 'Other'
}

function getRelationshipDetails(relationship, name) {
	switch(relationship) {
		case Relationships.Confidant:
			return `Once per mission, ${name} can choose to offer support by restoring your HP or Biotech at the expense of their own supply, spending one for one. If you die, ${name} can keep your stuff.`
			
		case Relationships.Crush:
			return `When ${name} is targeted with an attack, you can throw yourself in the way: move next to ${name} and take the attack for them, ignoring all Soak and Barrier.\r\n\r\nAfter a mission where you did this, you may choose to confess your feelings. If you do, on every mission where ${name} is present, you have the Perpetual Painted tag and ${name} has the Perpetual Favored tag.`

		case Relationships.Enemy:
			return `Every time you take an Enemy relationship, gain one stack of Perpetual Painted. If ${name} dies or you stop being enemies, you do not lose this stack of Perpetual Painted.\r\n\r\nOnce per mission (inlcuding secondary), when you would become Injured, you can declare that ${name} is Injured instead. You still drop to 0 HP.`

		case Relationships.Jeopordized:
			return `You messed up your professional relationship. This can only be removed by completing a mission together.\r\n\r\nWhen on a mission with ${name}, ALL Operatives subtract 1 from all dice (even drops). You cannot help or be helped by ${name}.`
			
		case Relationships.Rival:
			return `If ${name} fails an attack, you can move into range and make a free attack against the target. If you miss, you suffer the original consequences as well.`
			
		case Relationships.Strictly_Professional:
			return `Whenever you take the help action to give extra dice to ${name}, you grant three extra dice instead of just one.`
			
		case Relationships.Other:
		default:
			return "";
			break;
	}
}

function getRoomDetails(room, isBriny) {
	return getRawRoomDetails(room) + (isBriny ? `\r\nCurrent Defense: 0` : "");
}

function getRawRoomDetails(room) {
	switch(room) {
	case Rooms.Armory:
		return `Unlocks all of the armor and armor tags for purchase.`;
	case Rooms.Auguary:
			return `Unlocks the Augury powers for purchase by any Operative`;

	case Rooms.Clinic:
			return `Injured Operatives can be healed by any Operative(s) spending 2 Scrip during downtime. Each time any Operative uses the Clinic, the cost increases by 1 Scrip.\r\nCurrent cost:`;

	case Rooms.Debt_House:
			return `All Operatives on the primary mission roll an extra d6 for Scrip.`;

	case Rooms.Detonatorium:
			return `Unlocks the Grenade Launcher Weapon and Grenade item.`;

	case Rooms.Engineering_Lab:
			return `Unlocks the Arcsword, Plasgun and all of the weapon tags for purchase.`;

	case Rooms.Gambling_Den:
			return `Operatives on the secondary mission roll 1d6 for Scrip instead of always gaining 2 Scrip.`;

	case Rooms.Gym:
			return `Operatives can obtain one cost 0 power from any other Career.`;

	case Rooms.Intel_Center:
			return `Succeeding at Military missions only raises the Interloper Victory Meter by 1.`;

	case Rooms.Interloper_Ops:
			return `Failing a mission where the Interlopers are the only target only raises their Victory Meter by 2.`;

	case Rooms.Intern_Recycler:
			return `Unwanted gear can be converted to Gear Parts equal to half the total cost (including tags and upgrades) rounded down.`;

	case Rooms.Plasma_Lounge:
			return `The Arc and Beam tags can be applied to grenades.`;

	case Rooms.Refinery:
			return `Requires Smith. Melee weapons can now have multiple instances of the Bleed tag. Each instance after the first costs 2 Scrip.`;

	case Rooms.Smith:
			return `Melee weapons deal +1 Harm.`;

	case Rooms.Training_Grounds:
			return `Unlocks the Training Grounds powers for purchase by any Operative.`;

	case Rooms.Trauma_Ward:
			return `Unlocks the Trauma Ward powers for purchase by any Operative.`;

	case Rooms.Valdivian_Ops:
			return `Failing a mission where Valdivian is the only target only raises their Victory Meter by 2`;

	case Rooms.Artillery_Lounge_:
			return `Unlocks the Tained Strike power for purcahse by any Operative`;
			
	case Rooms.Biotech_Refinery:
			return `Unlocks the Refine power for purchase by any Operative`;
			
	case Rooms.Breakroom:
			return `During the Loadout phase, choose a power granted by a room. An Assistant on a mission can hold that power, allowing all Operatives to use it without taking a spot in their own loadout. If the power has a Scrip cost, at least one Operative must have purchased this power.`;
			
	case Rooms.Eminent_Domainery_:
			return `Operatives can collectively spend 5 Scrip to evict a retired Adversary or Assistant from their room and build something new in its place`;
			
	case Rooms.Library:
			return `When this is built, give all Operatives +1 to an Attribute of their choice. Also, as an action, an Operative may switch two of their attributes. `;
			
	case Rooms.Observatory:
			return `Unlocks the Sentry action for use by Operatives during missions`;
			
	case Rooms.Pilot_School:
			return `Unlocks new Drone protocols for pruchase and unlocks the Electrical Empathy power for purchase by any Operative.`;
			
	case Rooms.Reeducation_Chamber:
			return `Unlocks the Mindwiper item.`;
			
	case Rooms.Repurposed_Storage_Facility:
			return `Add two empty spaces to your HQ. You can construct one room in each of these spaces without paying an excavation fee.`;
			
	case Rooms.Research_Cells:
			return `Unlocks the Stun Baton. Special: multiple copies of this room can be constructed.`;
			
	case Rooms.Sacrifice_Booth:
			return `Unlocks the Sacrifice action for use by Operatives during missions.`;
			
	case Rooms.Sentinel_System:
			return `Whener an enemy ticks a pump to damage a room in the HQ, deal 3 Harm to that enemy If this was the final pump to disable a room, kill that enemy.`;
			
	case Rooms.Trophy_Room:
			return `When a character retires, they can add a piece of gear here. This can be recommissioned once for half of its initial cost.\r\n\r\nAdditionally, any Operative can spend their Downtime activity admiring a trophy and reminiscing about previous Operatives. Any Operative who does this gets +1 die when taking any action that reminds them of the Operative on their next mission.`;
			
	case Rooms.Workbench:
			return `All Items have their cost reduced by 1 Gear Part (min 1).`;
			
	default:
			return "";
			break;
	}
}

function buildDicePool(numDice) {
	if(numDice == 0) {
		numDice = 2;
		const rolls = [...Array(numDice)].map(() => "[[d6]]").join(", ");
		return `[[{${rolls}}kl1]]`; // Keep LOWEST not highest
	}

	const rolls = [...Array(numDice)].map(() => "[[d6]]").join(", ");
	return `[[{${rolls}}kh1]]`;
}

function getResults(numDice) {
	if(numDice === 0) {
		numDice = 2;
	}
	return numDice <= 1
		? ""
		: [...Array(numDice)].map((_, i) => `$[[${i}]]`).join(" ");
}

/* * * * * * * * * * * * * * * 
 *         Listeners         *
 * * * * * * * * * * * * * * */
on("change:smash", function(eventInfo) {
	 const newVal = parseInt(eventInfo.newValue); // this is the source of like 99% of my problems.
	 const roll_formula_smash = buildDicePool(newVal);
	 const roll_results_smash = getResults(newVal);

	 setAttrs({
	roll_formula_smash,
	roll_results_smash,
	 });
});

on("change:sly", function(eventInfo) {
	const newVal = parseInt(eventInfo.newValue);
	const roll_formula_sly = buildDicePool(newVal);
	const roll_results_sly = getResults(newVal);
	 
	 setAttrs({
	roll_formula_sly,
	roll_results_sly,
	 });
});

on("change:cyber", function(eventInfo) {
	const newVal = parseInt(eventInfo.newValue);
	const roll_formula_cyber = buildDicePool(newVal);
	const roll_results_cyber = getResults(newVal);
	 
	setAttrs({
		roll_formula_cyber,
		roll_results_cyber,
	});
});

on("clicked:repeating_weapon:reload", function(eventInfo) {
		getAttrs([
      "repeating_weapon_max_ammo"
    ], function(values) {
			maxAmmo = parseInt(values.repeating_weapon_max_ammo);

				setAttrs({
				repeating_weapon_ammo: maxAmmo
		});
	});
});

on("change:repeating_relationship:relationship_type change:repeating_relationship:relationship_target", function(eventInfo) {
	
	getAttrs([
      "repeating_relationship_relationship_target",
      "repeating_relationship_relationship_type"
    ], function(values) {
			relationship_target = values.repeating_relationship_relationship_target
			relationship_type = values.repeating_relationship_relationship_type
			
			const relationship_details = getRelationshipDetails(relationship_type, relationship_target);
				setAttrs({
		repeating_relationship_relationship_details : relationship_details,
	});
		});
});

on("change:buildingnameroom1 change:buildingnameroom2 change:buildingnameroom3 change:buildingnameroom4 change:buildingnameroom5 change:buildingnameroom6 change:buildingnameroom7 change:buildingnameroom8 change:buildingnameroom9 change:buildingnameroom10 change:buildingnameroom11 change:buildingnameroom12 change:buildingnameroom13 change:buildingnameroom14 change:buildingnameroom15 change:buildingnameroom16 ", function(eventInfo){
	const roomNumber = eventInfo.sourceAttribute.match(/\d+/).shift(); // regex to grab the number from a string. Relies on naming scheme.
	const room = eventInfo.newValue;
	const roomKey = "roomtext" + roomNumber; // Relying on attribute naming scheme.
	
	getAttrs(["briny"], (values) => {
		const isBriny = values.briny == "on";
		const details = getRoomDetails(room, isBriny);
		setAttrs(
			{
				[`${roomKey}`]: details
			}
		);
	});
	
	

});


on("sheet:opened", () => {
	// Initialize our default values. Not necessary if we used translation.
	getAttrs(["smash_fail", "cyber_fail", "sly_fail", "smash", "sly", "cyber"], (values) => {
		const sm = values.smash_fail;
		const cy = values.cyber_fail;
		const sl = values.sly_fail
		
		const roll_formula_smash = buildDicePool(parseInt(values.smash));
		const roll_results_smash = getResults(parseInt(values.smash));
		
		const roll_formula_cyber = buildDicePool(parseInt(values.cyber));
		const roll_results_cyber = getResults(parseInt(values.cyber));
		
		const roll_formula_sly = buildDicePool(parseInt(values.sly));
		const roll_results_sly = getResults(parseInt(values.sly));
		
		setAttrs({
			"smash_fail" : sm,
			"cyber_fail" : cy,
			"sly_fail" : sl,
			roll_formula_smash,
			roll_formula_cyber,
			roll_formula_sly,
			roll_results_sly,
			roll_results_cyber,
			roll_results_smash
		});
	});
});


// Reset after each mission
on("clicked:reset", function() {
  getAttrs(["hpmax", "resetpowers", "biomax"], (values) => {

		// Set HP to max HP
		// Set Biotech to max Biotech
		const hp = values.hpmax;
		const bt = values.biomax
		setAttrs({
			"hp" : hp,
			"bio" : bt
		});
		
		
		// Unuse all drones
		getSectionIDs("repeating_drone",  idarray => {
				let rows = {};
				for (let i = 0; i < idarray.length; i++) {
						rows['repeating_drone_' + idarray[i] + '_used'] = 0;
				}
				if(rows) setAttrs(rows);
		});
		
		// Unuse all items
		getSectionIDs("repeating_item",  idarray => {
				let rows = {};
				for (let i = 0; i < idarray.length; i++) {
						rows['repeating_item_' + idarray[i] + '_used'] = 0;
				}
				if(rows) setAttrs(rows);
		});
		
		const shouldResetPowers = values.resetpowers == 'true';
		if(shouldResetPowers) {
		
			getSectionIDs("repeating_powers",  idarray => {
					let rows = {};
					for (let i = 0; i < idarray.length; i++) {
							rows['repeating_powers_' + idarray[i] + '_equipped'] = 0;
					}
					if(rows) setAttrs(rows);
			});
		}
		
	});
});

on("clicked:griefbtn", function() {
        startRoll("&{template:rolls} {{name=Grief}} {{grief=[[1d6cf>6cs<1]]}}", (results) => {
            const total = results.results.grief.result

            finishRoll(
                results.rollId,
                {
                    roll1: total
                }
            );
						setAttrs( {
							"grief": total
						});
        });
});

<!-- Tab Switching -->
const buttonlist = ["charactersheet","basesheet","campaignsheet"];
    buttonlist.forEach(button => {
        on(`clicked:${button}`, function() {
            setAttrs({
                sheetTab: button
            });
        });
    })


</script>

