<!-- HIDDEN INPUTS -->
<input type="hidden" name="attr_sheetTab" value="character" />
<input type="hidden" name="attr_weaponEncumbrance" value="0" />
<input type="hidden" name="attr_attackBonus" value="0" />
<input type="hidden" name="attr_damageBonus" value="0" />

<!-- SHEET SELECTOR -->
<div class="sheet-button-select">
  <button type="action" name="act_character">Personagem</button>
  <button type="action" name="act_magic">Magia</button>
  <button type="action" name="act_equipment">Equipamento</button>
  <button type="action" name="act_retainers">Auxiliares</button>
  <button type="action" name="act_notes">Notas</button>
</div>
<!-- END OF SHEET SELECTOR -->
<!-- CHARACTER SHEET -->
<div class="sheet-character">
  <div class="logo-and-header">
    <img
      src="https://raw.githubusercontent.com/machado-cesar/roll20-character-sheets/feature_d20age/d20age/d20agelogo.png"
      alt="logo d20age"
    />
    <!-- Header -->
    <div class="header">
      <div class="header-line">
        <label for="attr_name">
          NOME
          <input type="text" name="attr_name" id="name-input" />
        </label>
      </div>
      <div class="header-line">
        <label for="attr_title">
          TÍTULO
          <input type="text" name="attr_title" />
        </label>
        <label for="attr_class">
          CLASSE
          <input type="text" name="attr_class" />
        </label>
      </div>
      <div class="header-line">
        <label for="attr_alignment">
          ALINHAMENTO
          <input type="text" name="attr_alignment" />
        </label>
        <label for="attr_level">
          NÍVEL
          <input type="text" name="attr_level" />
        </label>
      </div>
      <div class="header-line">
        <label for="attr_xp">
          XP
          <input type="text" name="attr_xp" />
        </label>
        <label for="attr_xpBonus" class="header-label">
          XP(+%)
          <input type="text" name="attr_xpBonus" />
        </label>
        <label for="attr_xpTarget">
          XP(META)
          <input type="text" name="attr_xpTarget" />
        </label>
      </div>
    </div>
    <!-- End of Header -->
  </div>
  <!-- Atributes, saves, defenses and movement -->
  <div class="attributes-saves-defense-and-movement">
    <!-- Attributes -->
    <div class="attributes">
      <h3>Atributos</h3>
      <div class="attributes-content">
        <div id="attributes-labels">
          <label for="attr_str">for</label>
          <label for="attr_int">int</label>
          <label for="attr_wis">sab</label>
          <label for="attr_dex">des</label>
          <label for="attr_con">con</label>
          <label for="attr_cha">car</label>
        </div>
        <div>
          <input type="text" name="attr_str" class="attribute-input" />
          <input type="text" name="attr_int" class="attribute-input" />
          <input type="text" name="attr_wis" class="attribute-input" />
          <input type="text" name="attr_dex" class="attribute-input" />
          <input type="text" name="attr_con" class="attribute-input" />
          <input type="text" name="attr_cha" class="attribute-input" />
        </div>
        <div>
          <input
            readonly
            id="ability-strength-modifier"
            name="attr_strMod"
            value="0"
          />
          <input
            readonly
            id="ability-intelligence-modifier"
            name="attr_intMod"
            value="0"
          />
          <input
            readonly
            id="ability-wisdom-modifier"
            name="attr_wisMod"
            value="0"
          />
          <input
            readonly
            id="ability-dexterity-modifier"
            name="attr_dexMod"
            value="0"
          />
          <input
            readonly
            id="ability-constitution-modifier"
            name="attr_conMod"
            value="0"
          />
          <input
            readonly
            id="ability-charisma-modifier"
            name="attr_chaMod"
            value="0"
          />
        </div>
      </div>
    </div>
    <!-- End of Attributes -->
    <!-- Saves -->
    <div class="saves">
      <div class="saves-container">
        <h3>Salvaguardas</h3>
        <div class="saves-content">
          <div class="saves-line">
            <div class="saves-input-black-background">
              <input type="text" name="attr_saveDeath" />
            </div>
            <button
              type="roll"
              name="attr_rollSaveDeath"
              value="&{template:default} {{name=@{character_name} salvaguarda contra Morte}} {{resultado=[[ [[1d20]]>@{saveDeath} ]]}} {{alvo=[[@{saveDeath}]]}}"
              class="save-button"
            >
              MORTE
            </button>
          </div>
          <div class="saves-line">
            <div class="saves-input-black-background">
              <input type="text" name="attr_saveContact" />
            </div>
            <button
              type="roll"
              name="attr_rollSaveContact"
              value="&{template:default} {{name=@{character_name} salvaguarda contra Contato}} {{resultado=[[ [[1d20]]>@{saveContact} ]]}} {{alvo=[[@{saveContact}]]}}"
              class="save-button"
            >
              CONTATO
            </button>
          </div>
          <div class="saves-line">
            <div class="saves-input-black-background">
              <input type="text" name="attr_saveParalysis" />
            </div>
            <button
              type="roll"
              name="attr_rollSaveParalysis"
              value="&{template:default} {{name=@{character_name} salvaguarda contra Paralisia}} {{resultado=[[ [[1d20]]>@{saveParalysis} ]]}} {{alvo=[[@{saveParalysis}]]}}"
              class="save-button"
            >
              PARALISIA
            </button>
          </div>
          <div class="saves-line">
            <div class="saves-input-black-background">
              <input type="text" name="attr_saveIrruption" />
            </div>
            <button
              type="roll"
              name="attr_rollSaveIrruption"
              value="&{template:default} {{name=@{character_name} salvaguarda contra Irrupção}} {{resultado=[[ [[1d20]]>@{saveIrruption} ]]}} {{alvo=[[@{saveIrruption}]]}}"
              class="save-button"
            >
              IRRUPÇÃO
            </button>
          </div>
          <div class="saves-line">
            <div class="saves-input-black-background">
              <input type="text" name="attr_saveSpell" />
            </div>
            <button
              type="roll"
              name="attr_rollSaveSpell"
              value="&{template:default} {{name=@{character_name} salvaguarda contra Feitiço}} {{resultado=[[ [[1d20]]>@{saveSpell} ]]}} {{alvo=[[@{saveSpell}]]}}"
              class="save-button"
            >
              FEITIÇO
            </button>
          </div>
        </div>
      </div>
    </div>
    <!-- End of Saves -->
    <!-- Defense and Movement -->
    <div class="defenses-and-movement">
      <!-- Defenses -->
      <div class="defenses">
        <div class="defenses-line">
          <label for="attr_ac">CA</label>
          <input readonly type="text" name="attr_ac" />
        </div>
        <div class="defenses-line">
          <label for="attr_pvMax">PV MÁXIMO</label>
          <input type="text" name="attr_pvMax" />
        </div>
        <div class="defenses-line">
          <label for="attr_pvCurrent">PV ATUAL</label>
          <input type="text" name="attr_pvCurrent" />
        </div>
      </div>
      <!-- End of Defenses -->
      <!-- Movement -->
      <div class="movement">
        <h3>Deslocamento</h3>
        <div class="movement-content">
          <div class="movement-line">
            <label for="attr_moveBase">BASE</label>
            <input type="text" name="attr_moveBase" />
          </div>
          <div class="movement-line">
            <label for="attr_moveExplorationOrRunning"
              >EXPLORAÇÃO/CORRIDA</label
            >
            <input type="text" name="attr_movExplorationOrRunning" />
          </div>
          <div class="movement-line">
            <label for="attr_moveTravel">VIAGEM</label>
            <input type="text" name="attr_moveTravel" />
          </div>
        </div>
      </div>
      <!-- End of Movement -->
    </div>
    <!-- End of Defense and Movement -->
  </div>
  <!-- End of Atributes, saves, defenses and movement -->
  <!-- Languages and Thac0 -->
  <div class="languages-and-thac0">
    <!-- Languages -->
    <div class="languages">
      <h3>Idiomas</h3>
      <div class="languages-content">
        <textarea name="attr_languages"></textarea>
        <div class="literate">
          <label for="attr_literate">Letrado</label>
          <input type="checkbox" name="attr_literate" />
        </div>
      </div>
    </div>
    <!-- End of Languages -->
    <!-- Thac0 -->
    <div class="thac0">
      <div class="thac0-and-ab">
        <label for="attr_thac0"
          >Taco<input type="text" name="attr_thac0"
        /></label>

        <label for="attr_ba"
          >Bônus de Ataque<input type="text" name="attr_ba"
        /></label>
      </div>
      <div class="thac0-grid">
        <label>0<input readonly type="text" name="attr_attackMatrix0" /></label>
        <label>1<input readonly type="text" name="attr_attackMatrix1" /></label>
        <label>2<input readonly type="text" name="attr_attackMatrix2" /></label>
        <label>3<input readonly type="text" name="attr_attackMatrix3" /></label>
        <label>4<input readonly type="text" name="attr_attackMatrix4" /></label>
        <label>5<input readonly type="text" name="attr_attackMatrix5" /></label>
        <label>6<input readonly type="text" name="attr_attackMatrix6" /></label>
        <label>7<input readonly type="text" name="attr_attackMatrix7" /></label>
        <label>8<input readonly type="text" name="attr_attackMatrix8" /></label>
        <label>9<input readonly type="text" name="attr_attackMatrix9" /></label>
      </div>
      <label id="ac-option">
        <span>Opção de CA</span>
        <select name="attr_armorClassType">
          <option value="aac">Ascendente</option>
          <option value="dac" selected>Descendente</option>
        </select>
      </label>
    </div>
    <!-- End of Thac0 -->
  </div>
  <!-- End of Languages and Thac0 -->
  <!-- Weapons -->
  <div class="weapons">
    <h3>Armas</h3>
    <fieldset class="repeating_weapons">
      <div class="weapon">
        <div class="weapon-grid">
          <div id="weapon-roll">
            <span>.</span>
            <button
              type="roll"
              name="aacAttackRoll"
              value="&{template:default} {{name=@{character_name} ataca com @{weaponName}}} {{ataque=[[1d20+@{dexMod}+@{weaponAttackBonus}+@{attackBonus}]]}} {{dano=[[@{weaponDamageDie}+@{weaponDamageBonus}+@{damageBonus}]]}}"
            ></button>
          </div>
          <div id="weapon-name">
            <span>Nome</span>
            <input type="text" name="attr_weaponName" />
          </div>
          <div id="weapon-attack-type">
            <span>Tipo de Ataque</span>
            <select name="attr_attackType">
              <option value="melee">Corpo a Corpo</option>
              <option value="ranged">A Distância</option>
            </select>
          </div>
          <div id="weapon-attack-bonus">
            <span>+Atq</span>
            <input type="number" name="attr_weaponAttackBonus" value="0" />
          </div>
          <div id="weapon-damage-die">
            <span>Dado de Dano</span>
            <input
              type="text"
              name="attr_weaponDamageDie"
              value="1d6"
              class="input-as-number"
            />
          </div>
          <div id="weapon-damage-bonus">
            <span>+Dano</span>
            <input type="number" name="attr_weaponDamageBonus" value="0" />
          </div>
          <div id="weapon-weight">
            <span>Peso</span>
            <input type="number" min="0" name="attr_weaponWeight" value="0" />
          </div>
        </div>
        <input
          id="weapon-description"
          type="text"
          name="attr_weaponDescription"
          class="weapon-description"
          placeholder="Descrição"
        />
      </div>
    </fieldset>
  </div>
  <!-- End of Weapons -->
</div>
<!-- END OF CHARACTER SHEET -->
<!-- MAGIC SHEET -->
<div class="sheet-magic">
  <div class="magic-per-circle">
    <label>
      <span>1</span>
      <input
        type="number"
        min="0"
        name="attr_magicCircle1Available"
        title="Magias Disponíveis"
        value="0"
      />
      /
      <input
        type="number"
        min="0"
        id="magic-circle-1-total"
        name="attr_magicCircle1Total"
        title="Magias Totais"
        value="0"
      />
    </label>
    <label class="inline-flex">
      <span>2</span>
      <input
        type="number"
        min="0"
        name="attr_magicCircle2Available"
        title="Magias Disponíveis"
        value="0"
      />
      /
      <input
        type="number"
        min="0"
        id="magic-circle-2-total"
        name="attr_magicCircle2Total"
        title="Magias Totais"
        value="0"
      />
    </label>
    <label class="inline-flex">
      <span>3</span>
      <input
        type="number"
        min="0"
        name="attr_magicCircle3Available"
        title="Magias Disponíveis"
        value="0"
      />
      /
      <input
        type="number"
        min="0"
        id="magic-circle-3-total"
        name="attr_magicCircle3Total"
        title="Magias Totais"
        value="0"
      />
    </label>
    <label class="inline-flex">
      <span>4</span>
      <input
        type="number"
        min="0"
        name="attr_magicCircle4Available"
        title="Magias Disponíveis"
        value="0"
      />
      /
      <input
        type="number"
        min="0"
        id="magic-circle-4-total"
        name="attr_magicCircle4Total"
        title="Magias Totais"
        value="0"
      />
    </label>
    <label class="inline-flex">
      <span>5</span>
      <input
        type="number"
        min="0"
        name="attr_magicCircle5Available"
        title="Magias Disponíveis"
        value="0"
      />
      /
      <input
        type="number"
        min="0"
        id="magic-circle-5-total"
        name="attr_magicCircle5Total"
        title="Magias Totais"
        value="0"
      />
    </label>
  </div>
  <div>
    <div class="magic-grid">
      <span class="magic-roll"></span>
      <span class="magic-memorized">Mem.</span>
      <span class="magic-name">Nome</span>
      <span class="magic-circle">Círculo</span>
      <span class="magic-description">Descrição</span>
      <span class="magic-effect">Efeito</span>
    </div>
    <fieldset class="repeating_magic">
      <div class="magic-grid">
        <div class="magic-roll">
          <button
            type="roll"
            name="magicCast"
            class="roll"
            value="&{template:default} {{name=@{character_name} conjura @{magicName}}} {{efeito=[[@{magicEffect}]]}} {{descrição=@{magicDescription}}}"
            ></button>
        </div>
        <input
          type="number"
          min="0"
          name="attr_magicMemorized"
          checked
          title="Memorizadas"
          value="0"
          class="magic-memorized"
        />
        <input type="text" name="attr_magicName" class="magic-name" />
        <input
          type="number"
          min="1"
          name="attr_magicCircle"
          value="1"
          class="magic-circle"
        />
        <input
          type="text"
          name="attr_magicDescription"
          class="magic-description"
        />
        <input
          type="text"
          class="magic-effect"
          name="attr_magicEffect"
          value="0"
          placeholder="não apague"
        />
      </div>
    </fieldset>
  </div>
</div>
<!-- END OF MAGIC SHEET -->
<!-- EQUIPMENT SHEET -->
<div class="sheet-equipment">
  <div class="encumbrance">
    <label>carga (cn)</label>
    <label>
      <span>Moedas</span>
      <input
        readonly
        min="0"
        name="attr_coinEncumbrance"
        value="0"
        class="encumbrance-input"
      />
    </label>
    <label>
      <span>Total</span>
      <input
        readonly
        min="0"
        name="attr_TotalEncumbrance"
        value="0"
        class="encumbrance-input"
      />
    </label>
    <label>
      <span>Auxiliares</span>
      <input
        readonly
        min="0"
        name="attr_retainerEncumbrance"
        value="0"
        class="encumbrance-input"
      />
    </label>
    <label>
      <span>Montaria</span>
      <input
        readonly
        min="0"
        name="attr_mountEncumbrance"
        value="0"
        class="encumbrance-input"
      />
    </label>
    <label>
      <span>Carroça</span>
      <input
        readonly
        min="0"
        name="attr_cartEncumbrance"
        value="0"
        class="encumbrance-input"
      />
    </label>
    <label>
      <span>Guardado</span>
      <input
        readonly
        min="0"
        name="attr_StowedEncumbrance"
        value="0"
        class="encumbrance-input"
      />
    </label>
  </div>
  <div>
    <div class="equipment-title-and-encumbrance">
      <h2>Armadura</h2>
      <div>
        <label>cn</label>
        <input
          readonly
          min="0"
          name="attr_armorEncumbrance"
          value="0"
          class="encumbrance-input"
        />
      </div>
    </div>
    <div>
      <span class="armor-name">Nome</span>
      <span class="armor-value">CA</span>
      <span class="armor-weight">Peso</span>
      <span class="armor-equiped">Equipada?</span>
    </div>
    <fieldset class="repeating_armor">
      <div>
        <input
          type="text"
          name="attr_armorName"
          class="armor-name"
          class="armor-name"
        />
        <input
          type="text"
          name="attr_armorValue"
          value="0"
          class="armor-value"
        />
        <input
          type="number"
          min="0"
          name="attr_armorWeight"
          value="0"
          class="armor-weight"
        />
        <div class="armor-equiped">
          <input type="checkbox" name="attr_armorWorn" checked />
        </div>
      </div>
    </fieldset>
  </div>
  <div>
    <div class="equipment-title-and-encumbrance">
      <h2>Itens</h2>
      <div>
        <label>cn</label>
        <input
          readonly
          min="0"
          name="attr_ItemsEncumbrance"
          value="0"
          class="encumbrance-input"
        />
      </div>
    </div>
    <div>
      <span class="item-quantity">Qtd</span>
      <span class="item-name">Nome</span>
      <span class="item-description">Descrição</span>
      <span class="item-weight">Peso</span>
    </div>
    <fieldset class="repeating_items">
      <div>
        <input
          class="item-quantity"
          type="number"
          min="0"
          name="attr_ItemQuantity"
          value="1"
        />
        <input class="item-name" type="text" name="attr_ItemName" />
        <input
          class="item-description"
          type="text"
          name="attr_ItemDescription"
        />
        <input
          class="item-weight"
          type="number"
          min="0"
          name="attr_ItemWeight"
          value="0"
        />
      </div>
    </fieldset>
  </div>
  <div>
    <div class="coins">
      <label>
        <span>PO</span>
        <input
          type="number"
          min="0"
          name="attr_GP"
          title="Peças de Ouro"
          value="0"
        />
      </label>
      <label class="inline-flex">
        <span>PP</span>
        <input
          type="number"
          min="0"
          name="attr_SP"
          title="Peças de Prata"
          value="0"
        />
      </label>
      <label class="inline-flex">
        <span>PC</span>
        <input
          type="number"
          min="0"
          name="attr_CP"
          title="Peças de Bronze"
          value="0"
        />
      </label>
    </div>
  </div>
  <div>
    <div class="equipment-title-and-encumbrance">
      <h2>Itens com Auxiliares</h2>
      <div>
        <label>cn</label>
        <input
          readonly
          min="0"
          name="attr_retainerEncumbrance"
          value="0"
          class="encumbrance-input"
        />
      </div>
    </div>
    <div>
      <span class="item-quantity">Qtd</span>
      <span class="item-name">Nome</span>
      <span class="item-description">Descrição</span>
      <span class="item-weight">Peso</span>
    </div>
    <fieldset class="repeating_retaineritems">
      <div>
        <input
          class="item-quantity"
          type="number"
          min="0"
          name="attr_RetainerItemQuantity"
          value="1"
        />
        <input class="item-name" type="text" name="attr_RetainerItemName" />
        <input
          class="item-description"
          type="text"
          name="attr_RetainerItemDescription"
        />
        <input
          class="item-weight"
          type="number"
          min="0"
          name="attr_RetainerItemWeight"
          value="0"
        />
      </div>
    </fieldset>
  </div>
  <div>
    <div class="equipment-title-and-encumbrance">
      <h2>Itens na Montaria</h2>
      <div>
        <label>cn</label>
        <input
          readonly
          min="0"
          name="attr_mountEncumbrance"
          value="0"
          class="encumbrance-input"
        />
      </div>
    </div>
    <div>
      <span class="item-quantity">Qtd</span>
      <span class="item-name">Nome</span>
      <span class="item-description">Descrição</span>
      <span class="item-weight">Peso</span>
    </div>
    <fieldset class="repeating_mountitems">
      <div>
        <input
          class="item-quantity"
          type="number"
          min="0"
          name="attr_MountItemQuantity"
          value="1"
        />
        <input class="item-name" type="text" name="attr_MountItemName" />
        <input
          class="item-description"
          type="text"
          name="attr_MountItemDescription"
        />
        <input
          class="item-weight"
          type="number"
          min="0"
          name="attr_MountItemWeight"
          value="0"
        />
      </div>
    </fieldset>
  </div>
  <div>
    <div class="equipment-title-and-encumbrance">
      <h2>Itens na Carroça</h2>
      <div>
        <label>cn</label>
        <input
          readonly
          min="0"
          name="attr_cartEncumbrance"
          value="0"
          class="encumbrance-input"
        />
      </div>
    </div>
    <div>
      <span class="item-quantity">Qtd</span>
      <span class="item-name">Nome</span>
      <span class="item-description">Descrição</span>
      <span class="item-weight">Peso</span>
    </div>
    <fieldset class="repeating_cartitems">
      <div>
        <input
          class="item-quantity"
          type="number"
          min="0"
          name="attr_CartItemQuantity"
          value="1"
        />
        <input class="item-name" type="text" name="attr_CartItemName" />
        <input
          class="item-description"
          type="text"
          name="attr_CartItemDescription"
        />
        <input
          class="item-weight"
          type="number"
          min="0"
          name="attr_CartItemWeight"
          value="0"
        />
      </div>
    </fieldset>
  </div>
  <div>
    <div class="equipment-title-and-encumbrance">
      <h2>Itens Guardados</h2>
      <div>
        <label>cn</label>
        <input
          readonly
          min="0"
          name="attr_stowedEncumbrance"
          value="0"
          class="encumbrance-input"
        />
      </div>
    </div>
    <div>
      <span class="item-quantity">Qtd</span>
      <span class="item-name">Nome</span>
      <span class="item-description">Descrição</span>
      <span class="item-weight">Peso</span>
    </div>
    <fieldset class="repeating_stoweditems">
      <div>
        <input
          class="item-quantity"
          type="number"
          min="0"
          name="attr_StowedItemQuantity"
          value="1"
        />
        <input class="item-name" type="text" name="attr_StowedItemName" />
        <input
          class="item-description"
          type="text"
          name="attr_StowedItemDescription"
        />
        <input
          class="item-weight"
          type="number"
          min="0"
          name="attr_StowedItemWeight"
          value="0"
        />
      </div>
    </fieldset>
  </div>
</div>
<!-- END OF EQUIPMENT SHEET -->
<!-- RETAINERS SHEET -->
<div class="sheet-retainers">
  <fieldset class="repeating_retainer">
    <div id="retainer">
      <div id="retainers-header-wrapper">
        <div class="retainers-header">
          <input
            id="retainer-name"
            type="text"
            name="attr_retainerName"
            placeholder="Nome"
          />
          <input
            id="retainer-profession"
            type="text"
            min="0"
            name="attr_retainerProfession"
            placeholder="Ofício"
          />
          <select id="retainer-kind" name="attr_retainerKind">
            <option value="follower" selected>Auxiliar</option>
            <option value="hireling">Profissional</option>
            <option value="mount">Montaria</option>
            <option value="animal">Animal</option>
          </select>
          <select id="retainer-loyalty" name="attr_retainerLoyalty">
            <option value="loyal">Leal</option>
            <option value="notLoyal" selected>Não Leal</option>
          </select>
        </div>
        <div id="retainers-header-filler"></div>
      </div>
      <div class="retainers-info">
        <div class="retainers-hd-moral-thac0-and-saves">
          <div class="retainers-hd-moral-and-thac0">
            <label>
              <span>DV</span>
              <input type="number" min="0" name="attr_retainerHD" />
            </label>
            <label class="retainers-hd-and-moral">
              <span>ML</span>
              <input type="number" min="0" name="attr_retainerMoral" />
            </label>
            <label class="retainers-hd-and-moral">
              <span>Taco/BA</span>
              <input type="number" min="0" name="attr_retainerTaco" />
            </label>
          </div>
          <div class="retainer-saves">
            <label>Salvaguardas</label>
            <label>
              <span>M</span>
              <input type="number" min="0" name="attr_retainerDeathSave" />
            </label>
            <label>
              <span>C</span>
              <input type="number" min="0" name="attr_retainerContactSave" />
            </label>
            <label>
              <span>P</span>
              <input type="number" min="0" name="attr_retainerParalysisSave" />
            </label>
            <label>
              <span>I</span>
              <input type="number" min="0" name="attr_retainerIrruptionSave" />
            </label>
            <label>
              <span>F</span>
              <input type="number" min="0" name="attr_retainerSpellSave" />
            </label>
          </div>
        </div>
        <label class="retainer-training-and-description">
          <span>Treinamento</span>
          <input type="text" name="attr_retainerTraining" />
        </label>
        <label class="retainer-training-and-description">
          <span>Descrição</span>
          <input type="text" name="attr_retainerDescription" />
        </label>
      </div>
    </div>
  </fieldset>
</div>
<!-- END OF RETAINERS SHEET -->
<!-- NOTES SHEET -->
<div class="sheet-notes">
  <textarea name="attr_notes" class="notes"></textarea>
</div>
<!-- END OF NOTES SHEET -->
<!-- SCRIPTS -->
  <script type="text/worker">
    // Tabs
    const buttonlist = ["character", "magic", "equipment", "retainers", "notes"];
    buttonlist.forEach((button) => {
      on(`clicked:${button}`, function (event) {
        setAttrs({ sheetTab: button });
      });
    });

    /* ===== PARAMETERS ==========
    destination = the name of the attribute that stores the total quantity
    section = name of repeating fieldset, without the repeating_
    fields = the name of the attribute field to be summed
        can be a single attribute: 'weight'
        or an array of attributes: ['weight','number','equipped']
    multiplier (optional) = a multiplier to the entire fieldset total. For instance, if summing coins of weight 0.02, might want to multiply the final total by 0.02.
    */
    const repeatingSum = (
      destination,
      section,
      fields,
      { multiplier = 1, callback = Function.prototype }
    ) => {
      if (!Array.isArray(fields)) fields = [fields];
      getSectionIDs(`repeating_${section}`, (idArray) => {
        const attrArray = idArray.reduce(
          (m, id) => [
            ...m,
            ...fields.map((field) => `repeating_${section}_${id}_${field}`),
          ],
          []
        );
        getAttrs(attrArray, (v) => {
          console.log("===== values of v: " + JSON.stringify(v) + " =====");
          // getValue: if not a number, returns 1 if it is 'on' (checkbox), otherwise returns 0..
          const getValue = (section, id, field) =>
            parseFloat(v[`repeating_${section}_${id}_${field}`]) ||
            (v[`repeating_${section}_${id}_${field}`] === "on" ? 1 : 0);
          const sumTotal = idArray.reduce(
            (total, id) =>
              total +
              fields.reduce(
                (subtotal, field) => subtotal * getValue(section, id, field),
                1
              ),
            0
          );
          setAttrs({ [destination]: sumTotal * multiplier }, callback);
        });
      });
    };
    /**
    * Given a value and set of modifiers, return the correct modifiers
    * @param {number} value The value to get modifiers for
    * @param {Array} modifiers Array of arrays or numbers representing modifiers
    * @returns {number|Array} The modifier(s) associated with the value
    */
    function getModifiers(value, modifiers = [-3, -2, -1, 0, 1, 2, 3]) {
      if (value <= 3) {
        return modifiers[0];
      } else if (value >= 4 && value <= 5) {
        return modifiers[1];
      } else if (value >= 6 && value <= 8) {
        return modifiers[2];
      } else if (value >= 9 && value <= 12) {
        return modifiers[3];
      } else if (value >= 13 && value <= 15) {
        return modifiers[4];
      } else if (value >= 16 && value <= 17) {
        return modifiers[5];
      } else {
      return modifiers[6];
      }
    }
    on("sheet:opened change:str", function () {
      getAttrs(["str"], function (values) {
        setAttrs({ strMod: getModifiers(values.str) });
      });
    });
    on("sheet:opened change:int", function () {
      getAttrs(["int"], function (values) {
        setAttrs({ intMod: getModifiers(values.int) });
      });
    });
    on("sheet:opened change:wis", function () {
      getAttrs(["wis"], function (values) {
        const wisMod = getModifiers(values.wis);
        setAttrs({
          wisMod,
          wisdomSaveQuery: (wisMod === 0)
            ? 0
            : "?{" +
              getTranslationByKey("wisdom-save-apply") +
              "|" +
              getTranslationByKey("no") +
              ",0|" +
              getTranslationByKey("yes") +
              ",@{wisMod}}[" +
              getTranslationByKey("wisdom-abbr") +
              "]"
          });
      });
    });
    on("sheet:opened change:dex", function () {
      getAttrs(["dex"], function (values) {
          const dex = parseInt(values.dex) || 0;
          // Calcular o modificador de DEX
          const dexMod = getModifiers(dex);
          // Atualizar os campos dexMod
          setAttrs({
              dexMod: dexMod,
          });
      });
    });
    on("sheet:opened change:con", function () {
      getAttrs(["conMod", "con"], function (values) {
        setAttrs({ conMod: getModifiers(values.con) });
      });
    });
    on("sheet:opened change:cha", function () {
      getAttrs(["cha"], function (values) {
        setAttrs({ chaMod: getModifiers(values.cha) });
      });
    });
    on("sheet:opened change:armorClassType change:ba", function () {
      getAttrs(["armorClassType", "ba"], function (values) {
          const armorClassType = values.armorClassType;
          const ba = parseInt(values.ba) || 0;
          let attackBonus = 0; // Valor padrão para attackBonus
          // Define attackBonus com base no valor de armorClassType
          if (armorClassType === "aac") {
              attackBonus = ba;
          } else if (armorClassType === "dac") {
              attackBonus = 0;
          }
          // Atualiza o atributo attackBonus
          setAttrs({
              attackBonus: attackBonus
          });
      });
    });
    on("sheet:opened change:attackType change:strMod", function () {
      getAttrs(["attackType", "strMod"], function (values) {
          const attackType = values.attackType;
          const strMod = parseInt(values.strMod) || 0;
          let bonusDamage = 0; // Valor padrão
          // Define bonusDamage com base no valor de attackType
          if (attackType === "melee") {
              bonusDamage = strMod;
          } else if (attackType === "ranged") {
              bonusDamage = 0;
          }
          // Atualiza o atributo bonusDamage
          setAttrs({
              bonusDamage: bonusDamage
          });
      });
    });
    // Atualizar weaponEncumbrance com a soma de todos os weaponWeight em repeating_weapons
    on("change:repeating_weapons:weaponWeight remove:repeating_weapons", function () {
        getSectionIDs("repeating_weapons", function (ids) {
            let totalWeight = 0;
            // Iterar por todos os IDs da seção repeating_weapons
            ids.forEach(id => {
                getAttrs([`repeating_weapons_${id}_weaponWeight`], function (values) {
                    const weight = parseInt(values[`repeating_weapons_${id}_weaponWeight`]) || 0;
                    // Adiciona o peso ao total
                    totalWeight += weight;
                    // Atualizar o campo weaponEncumbrance com a soma
                    setAttrs({ weaponEncumbrance: totalWeight });
                });
            });
            // Caso não haja armas, zera o total
            if (ids.length === 0) {
                setAttrs({ weaponEncumbrance: 0 });
            }
        });
    });
    // Atualizar attr_coinEncumbrance quando os campos GP, SP ou CP mudarem
    on("sheet:opened change:GP change:SP change:CP", function () {
        getAttrs(["GP", "SP", "CP"], function (values) {
            const gp = parseInt(values.GP);
            const sp = parseInt(values.SP);
            const cp = parseInt(values.CP);
            // Soma os valores
            const total = gp + sp + cp;
            // Atualiza o campo attr_coinEncumbrance
            setAttrs({ coinEncumbrance: total });
        });
    });
    // Função genérica para calcular encumbrance
    function calculateEncumbrance(fieldsetName, weightField, quantityField, totalField) {
        on(`change:repeating_${fieldsetName}:${weightField} change:repeating_${fieldsetName}:${quantityField} remove:repeating_${fieldsetName}`, function () {
            getSectionIDs(`repeating_${fieldsetName}`, function (ids) {
                let totalWeight = 0;
                ids.forEach(id => {
                    getAttrs([`repeating_${fieldsetName}_${id}_${weightField}`, `repeating_${fieldsetName}_${id}_${quantityField}`], function (values) {
                        const weight = parseInt(values[`repeating_${fieldsetName}_${id}_${weightField}`]) || 0;
                        const quantity = parseInt(values[`repeating_${fieldsetName}_${id}_${quantityField}`]) || 0;
                        totalWeight += weight * quantity;
                        setAttrs({ [totalField]: totalWeight });
                    });
                });
                if (ids.length === 0) {
                    setAttrs({ [totalField]: 0 });
                }
            });
        });
    }
    // Chamadas para cada categoria
      calculateEncumbrance("items", "ItemWeight", "ItemQuantity", "ItemsEncumbrance");
      calculateEncumbrance("retaineritems", "RetainerItemWeight", "RetainerItemQuantity", "retainerEncumbrance");
      calculateEncumbrance("mountitems", "MountItemWeight", "MountItemQuantity", "mountEncumbrance");
      calculateEncumbrance("cartitems", "CartItemWeight", "CartItemQuantity", "cartEncumbrance");
      calculateEncumbrance("stoweditems", "StowedItemWeight", "StowedItemQuantity", "stowedEncumbrance");
    // Atualizar TotalEncumbrance com a soma de coinEncumbrance, ItemsEncumbrance, armorEncumbrance e weaponEncumbrance
    on("change:coinEncumbrance change:ItemsEncumbrance change:armorEncumbrance change:weaponEncumbrance", function () {
      // Obter os valores dos campos relevantes
      getAttrs(["coinEncumbrance", "ItemsEncumbrance", "armorEncumbrance", "weaponEncumbrance"], function (values) {
          const coin = parseInt(values.coinEncumbrance) || 0;
          const items = parseInt(values.ItemsEncumbrance) || 0;
          const armor = parseInt(values.armorEncumbrance) || 0;
          const weapons = parseInt(values.weaponEncumbrance) || 0;
          // Soma os valores
          const total = coin + items + armor + weapons;
          // Atualiza o campo TotalEncumbrance
          setAttrs({ TotalEncumbrance: total });
      });
    });
    on("sheet:opened change:thac0", function () {
      getAttrs(["thac0"], function (values) {
        const thac0 = parseInt(values.thac0) || 0;
        const updates = {};
        for (let i = 0; i <= 9; i++) {
            updates[`attackMatrix${i}`] = thac0 - i;
        }
        setAttrs(updates);
      });
    });
    // Atualizar armorEncumbrance com a soma de todos os armorWeight em repeating_armor
    on("change:repeating_armor:armorWeight remove:repeating_armor", function () {
        // Obter todos os valores de armorWeight
        getSectionIDs("repeating_armor", function (ids) {
            let totalWeight = 0;
            // Iterar por todos os IDs da seção repeating_armor
            ids.forEach(id => {
                getAttrs([`repeating_armor_${id}_armorWeight`], function (values) {
                    const weight = parseInt(values[`repeating_armor_${id}_armorWeight`]) || 0;
                    totalWeight += weight;
                    // Atualizar o campo armorEncumbrance quando a soma estiver completa
                    setAttrs({ armorEncumbrance: totalWeight });
                });
            });
            // Atualizar imediatamente o campo para o caso de não haver valores
            if (ids.length === 0) {
                setAttrs({ armorEncumbrance: 0 });
            }
        });
    });
    on("sheet:opened change:armorClassType change:repeating_armor:armorValue change:repeating_armor:armorWorn remove:repeating_armor", function () {
      getAttrs(["armorClassType"], function (values) {
          const armorClassType = values.armorClassType || "aac"; // Default para teste
          getSectionIDs("repeating_armor", function (ids) {
              let totalArmorValue = 0;
              const attributesToGet = ids.reduce((acc, id) => {
                  acc.push(`repeating_armor_${id}_armorValue`, `repeating_armor_${id}_armorWorn`);
                  return acc;
              }, []);
              getAttrs(attributesToGet, function (itemValues) {
                  ids.forEach((id) => {
                      const armorValue = parseInt(itemValues[`repeating_armor_${id}_armorValue`]) || 0;
                      const armorWorn = itemValues[`repeating_armor_${id}_armorWorn`] === "on";
                      console.log(itemValues[`repeating_armor_${id}_armorWorn`])
                      console.log(`Item ID: ${id}, armorValue: ${armorValue}, armorWorn: ${armorWorn}`);
                      if (armorWorn) {
                          totalArmorValue += armorValue;
                      }
                  });
                  let ac = 0;
                  if (armorClassType === "aac") {
                      ac = 10 + totalArmorValue;
                  } else if (armorClassType === "dac") {
                      ac = 9 - totalArmorValue;
                  }
                  // Atualizar o atributo attr_ac
                  setAttrs({ ac: ac });
              });
          });
      });
    });


  </script>
<!-- END OF SCRIPTS -->
</div>
