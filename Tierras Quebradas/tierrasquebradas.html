<div class="character-sheet background-img">
    <div class="col-xs-4 margin-b-10">
        <div>
            <button type="action" class="tab-button text-important" name="act_character">Características</button>
            <button type="action" class="tab-button text-important" name="act_journal">Personal</button>
        </div>

    </div>
    <div class="row-nw width-100">
        <input type='hidden' class='sheet-tabstoggle' name='attr_sheetTab' value='character' />
        <div class="sheet-character  margin-t-15 width-100 ">
            <div class="row-nw ">
                <div class="col-xs-4 padding-l-0 padding-r-0 content-center">
                    <div>
                        <span class="text-subheader">Nombre:</span>
                        <input class="input-line width-100" type="text" name="attr_character_name" readonly>
                    </div>
                    <div class="row-nw padding-l-0 padding-r-0 content-center margin-t-25">
                        <div class="column-nw col-xs-4 padding-l-0 padding-r-0 content-center">
                            <span class="text-subheader">CUERPO</span>
                            <input class="input-line width-100" type="number" name="attr_cuerpo">
                        </div>
                        <div class="column-nw col-xs-4 padding-l-0 padding-r-0 content-center">
                            <span class="text-subheader">MENTE</span>
                            <input class="input-line width-100" type="number" name="attr_mente">
                        </div>
                        <div class="column-nw col-xs-4 padding-l-0 padding-r-0 content-center">
                            <span class="text-subheader">ESPÍRITU</span>
                            <input class="input-line width-100" type="number" name="attr_espiritu">
                        </div>
                    </div>
                    <div class="row-nw padding-l-0 padding-r-0 content-center padding-t-10">
                        <div class="column-nw col-xs-4 padding-l-0 padding-r-0 content-center">
                            <span class="text-subheader">ATRACTIVO</span>
                            <input class="input-line width-100" type="number" name="attr_atractivo">
                        </div>
                        <div class="column-nw col-xs-4 padding-l-0 padding-r-0 content-center">
                            <span class="text-subheader">FUERZA</span>
                            <input class="input-line width-100" type="number" name="attr_fuerza">
                        </div>
                        <div class="column-nw col-xs-4 padding-l-0 padding-r-0 content-center">
                            <span class="text-subheader">TAMAÑO</span>
                            <input class="input-line width-100" type="number" name="attr_tamano">
                        </div>
                    </div>
                     <div class="margin-t-25">
                        <span class="row-nw text-subheader content-center width-100"></span>
                        <div class="row-nw padding-l-0 padding-r-0 content-center">
                            <span class="col-xs-6 text-subheader">PROTECCIÓN</span>
                            <span class="col-xs-3 col-xs-offset-1 text-important">TOTAL</span>
                            <input class="col-xs-2 input-box" type="number" name="attr_proteccion_total" value="{@{armadura_valor}+@{escudo_valor}+@{casco_valor}}" disabled="true">
                        </div>                         
                        <div class="row-nw padding-l-0 padding-r-0 content-center">
                            <span class="col-xs-6">Armadura</span>
                            <span class="col-xs-4">Tipo</span>
                            <span class="col-xs-2"></span>
                        </div>
                        <div class="row-nw padding-l-0 padding-r-0 content-center">
                            <input class="col-xs-6 input-line" type="text" name="attr_armadura">
                            <input class="col-xs-4 input-line" type="text" name="attr_armadura_tipo">
                            <input class="col-xs-2 input-line" type="number" name="attr_armadura_valor">
                        </div>
                        <div class="row-nw padding-l-0 padding-r-0 content-center">
                            <span class="col-xs-4">Casco</span>
                            <input class="col-xs-2 input-line" type="number" name="attr_casco_valor">
                            <span class="col-xs-4">Escudo</span>
                            <input class="col-xs-2 input-line" type="number" name="attr_escudo_valor">
                        </div>
                    </div>                   
                </div>
                <div class="col-xs-4">
                    <div>
                        <span class="row-nw text-subheader content-center width-100">PUNTOS DE VIDA</span>
                        <div class="row-nw padding-l-0 padding-r-0 content-center">
                            <span class="col-xs-5 text-important">Max.</span>
                            <input class="col-xs-offset-2 col-xs-2 input-box" type="number" name="attr_vidamax" readonly>
                            <span class="col-xs-1 text-desc text-center">|</span>
                            <input class="col-xs-2 input-line" type="number" name="attr_vida">
                        </div>
                        <div class="row-nw padding-l-0 padding-r-0 content-center">
                            <span class="col-xs-5">Rasguño</span>
                            <input class="col-xs-offset-2 col-xs-2 input-line" type="number" name="attr_rasguno" readonly>
                            <span class="col-xs-1 text-desc text-center">-</span>
                            <input class="col-xs-2 input-line" type="number" name="attr_rasgunomax" readonly>
                        </div>
                        <div class="row-nw padding-l-0 padding-r-0 content-center">
                            <span class="col-xs-5">Herida leve</span>
                            <input class="col-xs-offset-2 col-xs-2 input-line" type="number" name="attr_heridaleve" readonly>
                            <span class="col-xs-1 text-desc text-center">-</span>
                            <input class="col-xs-2 input-line" type="number" name="attr_heridalevemax" readonly>
                        </div>
                        <div class="row-nw padding-l-0 padding-r-0 content-center">
                            <span class="col-xs-5">Herida grave</span>
                            <input class="col-xs-offset-2 col-xs-2 input-line" type="number" name="attr_heridagrave" readonly>
                            <span class="col-xs-1 text-desc text-center">-</span>
                            <input class="col-xs-2 input-line" type="number" name="attr_heridagravemax" readonly>
                        </div>
                        <div class="row-nw padding-l-0 padding-r-0 content-center margin-t-15">
                            <span class="col-xs-8 text-important">Heridas</span>
                            <span class="col-xs-3 col-xs-offset-1 text-important">PD</span>
                        </div>
                        <div class="row-nw padding-l-0 padding-r-0 content-center">
                            <input class="col-xs-8 input-line" type="text" name="attr_herida_1">
                            <input class="col-xs-3 col-xs-offset-1 input-line" type="number" name="attr_herida_pd_1">
                        </div>
                        <div class="row-nw padding-l-0 padding-r-0 content-center">
                            <input class="col-xs-8 input-line" type="text" name="attr_herida_2">
                            <input class="col-xs-3 col-xs-offset-1 input-line" type="number" name="attr_herida_pd_2">
                        </div>
                         <div class="row-nw padding-l-0 padding-r-0 content-center">
                            <input class="col-xs-8 input-line" type="text" name="attr_herida_3">
                            <input class="col-xs-3 col-xs-offset-1 input-line" type="number" name="attr_herida_pd_3">
                        </div>  
                        <div class="row-nw padding-l-0 padding-r-0 content-center">
                            <input class="col-xs-8 input-line" type="text" name="attr_herida_4">
                            <input class="col-xs-3 col-xs-offset-1 input-line" type="number" name="attr_herida_pd_4">
                        </div>
                         <div class="row-nw padding-l-0 padding-r-0 content-center">
                            <input class="col-xs-8 input-line" type="text" name="attr_herida_5">
                            <input class="col-xs-3 col-xs-offset-1 input-line" type="number" name="attr_herida_pd_5">
                        </div>                         
                        <div class="row-nw padding-l-0 padding-r-0 content-center margin-t-15">
                            <input type="checkbox" name="attr_debilitado">
                            <span class="col-xs-5 text-important">DEBILITADO</span>
                            <input type="checkbox" name="attr_incapacitado">
                            <span class="col-xs-5 text-important">INCAPACITADO</span>
                        </div>

                    </div>
                </div>
                <div class="col-xs-4">
                    <div>
                        <span class="row-nw text-subheader content-center width-100">BASES DE HABILIDADES</span>
                        <div class="row-nw padding-l-0 padding-r-0 content-center">
                            <span class="col-xs-3">Agilidad</span>
                            <span class="col-xs-7 text-desc text-right">CUE-TAM</span>
                            <input class="col-xs-2 input-line" type="number" name="attr_agilidad" value="{@{cuerpo}-@{tamano}}" disabled="true">
                        </div>
                        <div class="row-nw padding-l-0 padding-r-0 content-center">
                            <span class="col-xs-3">Comunicación</span>
                            <span class="col-xs-7 text-desc text-right">(MEN+ESP)/2+ATR</span>
                            <input class="col-xs-2 input-line" type="number" name="attr_comunicacion" value="{ceil((@{mente}+@{espiritu})/2+@{tamano})}" disabled="true">
                        </div>
                        <div class="row-nw padding-l-0 padding-r-0 content-center">
                            <span class="col-xs-3">Cultura</span>
                            <span class="col-xs-7 text-desc text-right">MEN</span>
                            <input class="col-xs-2 input-line" type="number" name="attr_cultura" value="{@{mente}}" disabled="true">
                        </div>
                        <div class="row-nw padding-l-0 padding-r-0 content-center">
                            <span class="col-xs-3">Discreción</span>
                            <span class="col-xs-7 text-desc text-right">(MEN+CUE)/2-TAM</span>
                            <input class="col-xs-2 input-line" type="number" name="attr_discrecion" value="{ceil((@{mente}+@{cuerpo})/2-@{tamano})}" disabled="true">
                        </div>
                        <div class="row-nw padding-l-0 padding-r-0 content-center">
                            <span class="col-xs-3">Hechicería</span>
                            <span class="col-xs-7 text-desc text-right">(MEN+ESP)/3</span>
                            <input class="col-xs-2 input-line" type="number" name="attr_hechiceria" value="{ceil((@{mente}+@{espiritu})/3)}" disabled="true">
                        </div>
                        <div class="row-nw padding-l-0 padding-r-0 content-center">
                            <span class="col-xs-3">Percepción</span>
                            <span class="col-xs-7 text-desc text-right">(MEN+ESP)/2</span>
                            <input class="col-xs-2 input-line" type="number" name="attr_percepcion" value="{ceil((@{mente}+@{espiritu})/2)}" disabled="true">
                        </div>
                        <div class="row-nw padding-l-0 padding-r-0 content-center">
                            <span class="col-xs-3">Técnica</span>
                            <span class="col-xs-7 text-desc text-right">(MEN+CUE)/2</span>
                            <input class="col-xs-2 input-line" type="number" name="attr_tecnica" value="{ceil((@{mente}+@{cuerpo})/2)}" disabled="true">
                        </div>

                    </div>
                    <div class="margin-t-15">
                        <span class="row-nw text-subheader content-center width-100">DESTINO</span>
                        <div class="row-nw width-100">
                            <span class="col-xs-3 padding-l-0 padding-r-0">Objetivo</span>
                            <input class="col-xs-2 input-line" type="number" name="attr_objetivo">
                            <span class="col-xs-3 col-xs-offset-1 padding-l-0 padding-r-0">Persona</span>
                            <input class="col-xs-2 input-line" type="number" name="attr_persona">
                        </div>
                        <div class="row-nw width-100">
                            <span class="col-xs-3 padding-l-0 padding-r-0">Secreto</span>
                            <input class="col-xs-2 input-line" type="number" name="attr_secreto">
                            <span class="col-xs-3 col-xs-offset-1 padding-l-0 padding-r-0">Escenario</span>
                            <input class="col-xs-2 input-line" type="number" name="attr_escenario">
                        </div>
                        <div class="row-nw width-100 padding-t-10 content-center">
                            <span class="col-xs-6 padding-l-0 padding-r-0 text-important text-center">Total gastado</span>
                            <input class="col-xs-2 input-box padding-l-0 padding-r-0" type="number" name="attr_objetivo">
                        </div>
                    </div>
                </div>
            </div>

        </div>
        <div class="sheet-journal margin-t-25 width-100 padding-l-30 padding-r-30 ">
            <div class="row-nw width-100 margin-b-25 content-center">
                <div class="col-xs-5">
                    <div class="column-nw">
                        <span class="col-xs-12 text-important">Posesiones y Finanzas</span>
                        <textarea class="input-line width-100" name="attr_character_posesiones"></textarea>
                    </div>
                    <div class="column-nw">
                        <span class="col-xs-12 text-important">Títulos, Cargos y Honores</span>
                        <textarea class="input-line width-100" name="attr_character_titulos"></textarea>
                    </div>
                </div>
                <div class="col-xs-1">
                </div>
                <div class="col-xs-5">
                    <div class="column-nw">
                        <span class="col-xs-12 text-important">Relaciones, Contactos y Alianzas</span>
                        <textarea class="input-line width-100" name="attr_character_relaciones"></textarea>
                    </div>
                    <div class="column-nw">
                        <span class="col-xs-12 text-important">Notas adicionales</span>
                        <textarea class="input-line width-100" name="attr_character_notas"></textarea>
                    </div>
                </div>
            </div>
        </div>

    </div>

</div>

<script type="text/worker">
    const buttonlist = ["character","journal"];
    buttonlist.forEach(button => {
        on(`clicked:${button}`, function() {
            setAttrs({
                sheetTab: button
            });
        });
    });
    
     on("change:cuerpo change:tamano",function(){
        getAttrs(["cuerpo", "tamano"], function(values) {
            var cuerpo = parseInt(values.cuerpo);
            var tamano = parseInt(values.tamano);
            var vidamax = (2*cuerpo)+tamano;
            var heridagravemax = vidamax - 1;
            var heridagrave = Math.floor(heridagravemax/2);
            var heridalevemax = heridagrave - 1;
            var heridaleve = Math.floor(heridalevemax/2);
            var rasgunomax = heridaleve - 1;
            var rasguno = Math.floor(rasgunomax/2);
            if (rasgunomax <= 0) {
                rasgunomax = 0;
                rasguno = 0;
            }
            setAttrs({
                "vidamax": vidamax,
                "heridagravemax": heridagravemax,
                "heridagrave": heridagrave,
                "heridalevemax": heridalevemax,
                "heridaleve": heridaleve,
                "rasgunomax": rasgunomax,
                "rasguno": rasguno
            });
        });
    });   
</script>





<rolltemplate class="sheet-rolltemplate-test">
    <div class="sheet-rolltemplate-container">
        <div class="sheet-rolltemplate-row-nw sheet-rolltemplate-width-100 sheet-rolltemplate-content-center">{{tirada}} <b>&nbsp;|&nbsp;</b> {{resultado}}</div>

    </div>
</rolltemplate>