<input class="type" name="attr_sheet_type" type="hidden" value="pc">
<input class="display_string" name="attr_character_settings" type="hidden" value="pc">

<button name="act_toggle_pc" title="player character button" type="action">PC</button>
<button name="act_toggle_npc" title="non player character" type="action">NPC</button>
<input type="hidden" name="attr_weapon_buttons" value="0">
<input type="hidden" name="attr_npc_tec" value="0">
<button type="roll" class="pc" name="roll_minisheet" title="%{selected or character name|minisheet}" value="/w @{character_name} &{template:minisheet} {{name=@{character_name}}} {{value1=@{pc_hp}}} {{value1_max=@{pc_hp|max}}} {{value2=@{pc_ac}}} {{buttons_name=Attributes}} {{buttons=[Strength (@{pc_strengthMod})](~strength) [Dexterity (@{pc_dexterityMod})](~dexterity) [Constitution (@{pc_constitutionMod})](~constitution) [Intelligence (@{pc_intelligenceMod})](~intelligence) [Wisdom (@{pc_wisdomMod})](~wisdom) [Charisma (@{pc_charismaMod})](~charisma)}} {{buttons2_name=Weapons}} {{buttons2=@{weapon_buttons}}} {{buttons3_name=Magic}} {{buttons3=[Arcana (@{pc_arcane})](~arcana) [Divine (@{pc_divine})](~divine)}} {{buttons4_name=Senses}} {{buttons4=[Perception (@{pc_perception})](~perception)}}" style="font-family: Pictos; font-size: 20px; position: absolute; top: 70px; left: 815px;">N</button>
<button type="roll" class="npc" name="roll_npc_minisheet" title="%{selected or character name|npc_minisheet}" value="/w @{character_name} &{template:minisheet} {{name=@{character_name}}} {{value1=@{npc_hp}}} {{value1_max=@{npc_hp|max}}} {{value2=@{npc_ac}}} {{buttons_name=Tests @{npc_base_mod}}} {{buttons=[Standard Test](~npc_base) [Attack](~npc_attack) [Damage](~npc_damage)}} {{buttons2_name=Strong @{npc_strong_mod}}} {{buttons2=[Strong test](~npc_strong)}} {{buttons3_name=Weak @{npc_weak_mod}}} {{buttons3=[Weak test](~npc_weak)}} {{buttons4_name=Techniques}} {{buttons4=@{npc_tec}}}" style="font-family: Pictos; font-size: 20px; position: absolute; top: 70px; left: 815px;">N</button>

<!-- PC
   ============================= -->

<div class="pc">
    <span class="sheet-footer" style="margin-right: 5px;position: absolute;top: 80px;left: 150px;">B&W Version</span> <input type="checkbox" class="sheet-block-switch" style="position: absolute; top: 90px; left: 220px;"><span style="color: black;position: absolute;top: 76px;left: 210px;"></span>
    <span class="sheet-footer" style="margin-right: 5px;position: absolute;top: 80px;left: 230px;">Grey Version</span> <input type="checkbox" class="sheet-block-switch2" style="position: absolute; top: 90px; left: 300px;"><span style="color: black;position: absolute;top: 76px;left: 290px;"></span>
    <div class="container_pc1 bw">
        <div class="pc_firstline">
            <h2>Name</h2>
            <input type="text" name="attr_character_name" placeholder="nom" style="height: 75%; margin-right: 3px;">
            <h2 style="margin-right:3px">Level</h2>        
            <select name="attr_pc_lvl" type="number" style="margin-right: 3px;">
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
                <option value="9">9</option>
            </select>
            <h2>XP</h2>
            <input type="text" name="attr_pc_xp" style="height: 75%; margin-right: 3px; width: 70px">
            <h2 style="margin-right:3px">Race</h2>
            <input type="text" name="attr_pc_race" style="height: 75%; margin-right: 3px;">
        </div>
        <div class="pc_secondline">
            <h2 style="margin-right: 3px;">Class</h2> 
            <select name="attr_pc_class" type="text" style="margin-right: 3px; width: 150px">
                <option value="Guerrier">Warrior</option>
                <option value="Voleur">Thief</option>
                <option value="Zélote">Zealot</option>
                <option value="Mage">Mage</option>
            </select>
            <h2 style="margin-right: 3px;">Archetype</h2>
            <input type="radio" name="attr_select-chooser" class="select-chooser" value="1">
            <select name="attr_pc_arch" class="archetype" style="margin-right: 3px; width: 150px">
                <option value=""></option>
                <option value="Barbare">Barbarian</option>
                <option value="Combattant">Fighter</option>
                <option value="Rôdeur">Ranger</option>
            </select>
            <input type="radio" name="attr_select-chooser" class="select-chooser" value="2">
            <select name="attr_pc_arch" class="archetype" style="margin-right: 3px; width: 150px">
                <option value=""></option>
                <option value="Assassin">Assassin</option>
                <option value="Barde">Bard</option>
                <option value="Gredin">Rogue</option>
            </select>
            <input type="radio" name="attr_select-chooser" class="sheet-select-chooser" value="3">
            <select name="attr_pc_arch" class="archetype" style="margin-right: 3px; width: 150px">
                <option value=""></option>
                <option value="Prêtre">Cleric</option>
                <option value="Druide">Druid</option>
                <option value="Paladin">Paladin</option>
            </select>
            <input type="radio" name="attr_select-chooser" class="sheet-select-chooser" value="4">
            <select name="attr_pc_arch" class="archetype" style="margin-right: 3px; width: 150px">
                <option value=""></option>
                <option value="Ensorceleur">Sorcerer</option>
                <option value="Sorcier">Warlock</option>
                <option value="Magicien">Wizard</option>
            </select>
            <h2 style="margin-right: 10px;">Proficiency Bonus</h2>
            <h2><span type="text" name="attr_pc_proficiency" title="@{pc_proficiency}" value="+2"></span></h2>
        </div>
            <div class="attributes">
                <input name="attr_pc_strength_prof" type="checkbox" value="1" style="float: right"><span style="position: absolute; left: 124px;"></span>
                <button name="roll_strength" type="roll" value="&{template:ftdroll} {{name=@{character_name}}} {{test_name=Strength Test}} {{r1=[[1d20+@{pc_strengthMod}+?{Is proficiency relevant ?|Yes,@{pc_proficiency}|No,0}]]}} {{r2=[[1d20+@{pc_strengthMod}+?{Is proficiency relevant ?|Yes,@{pc_proficiency}|No,0}]]}}">
                    <h3 style="width: 80px;">STR</h3>
                    <h2><span type="number" name="attr_pc_strengthMod" title="@{pc_strengthMod}"></span></h2>
                </button>
            </div>
            <div class="attributes">
                <input name="attr_pc_dexterity_prof" type="checkbox" style="float: right;" value="1"><span style="top: 184px; position: absolute; left: 254px;"></span>
                <button name="roll_dexterity" type="roll" value="&{template:ftdroll} {{name=@{character_name}}} {{test_name=Dexterity Test}} {{r1=[[1d20+@{pc_dexterityMod}+?{Is proficiency relevant ?|Yes,@{pc_proficiency}|No,0}]]}} {{r2=[[1d20+@{pc_dexterityMod}+?{Is proficiency relevant ?|Yes,@{pc_proficiency}|No,0}]]}}">
                    <h3 style="width: 80px;">DEX</h3>
                    <h2><span type="number" name="attr_pc_dexterityMod" title="@{pc_dexterityMod}"></span></h2>
                </button>
            </div>
            <div class="attributes">
                <input name="attr_pc_constitution_prof" type="checkbox" style="float: right;" value="1"><span style="top: 184px; position: absolute; left: 384px;"></span>
                <button name="roll_constitution" type="roll" value="&{template:ftdroll} {{name=@{character_name}}} {{test_name=Constitution Test}} {{r1=[[1d20+@{pc_constitutionMod}+?{Is proficiency relevant ?|Yes,@{pc_proficiency}|No,0}]]}} {{r2=[[1d20+@{pc_constitutionMod}+?{Is proficiency relevant ?|Yes,@{pc_proficiency}|No,0}]]}}">
                    <h3 style="width: 80px;">CON</h3>
                    <h2><span type="number" name="attr_pc_constitutionMod" title="@{pc_constitutionMod}"></span></h2>
                </button>
            </div>
            <div class="attributes">
                <input name="attr_pc_intelligence_prof" type="checkbox" style="float: right;" value="1"><span style="top: 184px; position: absolute; left: 514px;"></span>
                <button name="roll_intelligence" type="roll" value="&{template:ftdroll} {{name=@{character_name}}} {{test_name=Intelligence Test}} {{r1=[[1d20+@{pc_intelligenceMod}+?{Is proficiency relevant ?|Yes,@{pc_proficiency}|No,0}]]}} {{r2=[[1d20+@{pc_intelligenceMod}+?{Is proficiency relevant ?|Yes,@{pc_proficiency}|No,0}]]}}">
                    <h3 style="width: 80px;">INT</h3>
                    <h2><span type="number" name="attr_pc_intelligenceMod" title="@{pc_intelligenceMod}"></span></h2>
                </button>
            </div>
            <div class="attributes">
                <input name="attr_pc_wisdom_prof" type="checkbox" style="float: right;" value="1"><span style="top: 184px; position: absolute; left: 644px;"></span>
                <button name="roll_wisdom" type="roll" value="&{template:ftdroll} {{name=@{character_name}}} {{test_name=Wisdom Test}} {{r1=[[1d20+@{pc_wisdomMod}+?{Is proficiency relevant ?|Yes,@{pc_proficiency}|No,0}]]}} {{r2=[[1d20+@{pc_wisdomMod}+?{Is proficiency relevant ?|Yes,@{pc_proficiency}|No,0}]]}}">
                    <h3 style="width: 80px;">WIS</h3>
                    <h2><span type="number" name="attr_pc_wisdomMod" title="@{pc_wisdomMod}"></span></h2>
                </button>
            </div>
            <div class="attributes">
                <input name="attr_pc_charisma_prof" type="checkbox" style="float: right;" value="1"><span style="top: 184px; position: absolute; left: 774px;"></span>
                <button name="roll_charisma" type="roll" value="&{template:ftdroll} {{name=@{character_name}}} {{test_name=Charisma Test}} {{r1=[[1d20+@{pc_charismaMod}+?{Is proficiency relevant ?|Yes,@{pc_proficiency}|No,0}]]}} {{r2=[[1d20+@{pc_charismaMod}+?{Is proficiency relevant ?|Yes,@{pc_proficiency}|No,0}]]}}">
                    <h3 style="width: 80px;">CHA</h3>
                    <h2><span type="number" name="attr_pc_charismaMod" title="@{pc_charismaMod}"></span></h2>
                </button>
            </div>
            <div class="attributes">
                <input type="number" name="attr_pc_strength" title="@{pc_strength}">
            </div>
            <div class="attributes">
                <input type="number" name="attr_pc_dexterity" title="@{pc_dexterity}">
            </div>
            <div class="attributes">
                <input type="number" name="attr_pc_constitution" title="@{pc_constitution}">
            </div>
            <div class="attributes">
                <input type="number" name="attr_pc_intelligence" title="@{pc_inteliggence}">
            </div>
            <div class="attributes">
                <input type="number" name="attr_pc_wisdom" title="@{pc_wisdom}">
            </div>
            <div class="attributes">
                <input type="number" name="attr_pc_charisma" title="@{pc_charisma}">
            </div>
            <div class="speed1 attributes">
                <h2>Speed</h2>
            </div>
            <div class="speed2 attributes">
                <input type="number" name="attr_pc_speed"> <span style="font-weight: bold;">ft</span>
            </div>
            <div class="load1 attributes">
                <h2>Load</h2>
            </div>
            <div class="load2 attributes">
                <input type="number" name="attr_pc_load"> <span style="font-size: 24px;">/</span> <input type="number" name="attr_pc_load_max">
            </div>
            <div class="ac1 attributes">
                <h2>AC</h2>
            </div>
            <div class="ac2 attributes">
                    <span style="top: 342px; position: absolute; left: 183px; font-weight: bold; font-size: 10px;">HVY</span>
                    <input name="attr_pc_ac_type" type="radio" value="15" style="top: 367px; position: absolute; left: 200px;"><span style="top: 352px; position: absolute; left: 190px;"></span>
                    <span style="top: 372px; position: absolute; left: 186px; font-weight: bold; font-size: 10px;">LT</span>
                    <input name="attr_pc_ac_type" type="radio" value="12" style="top: 396px; position: absolute; left: 200px;"><span style="top: 381px; position: absolute; left: 190px;"></span>
                    <span style="top: 342px; position: absolute; left: 260px; font-weight: bold; font-size: 10px;">SHLD</span>
                    <input name="attr_pc_ac_shield" type="checkbox" value="1" style="top: 367px; position: absolute; left: 267px;"><span style="top: 352px; position: absolute; left: 257px;"></span>
                    <span style="top: 372px; position: absolute; left: 265px; font-weight: bold; font-size: 10px;">NO</span>
                    <input name="attr_pc_ac_type" type="radio" value="10" style="top: 396px; position: absolute; left: 267px;" checked="true"><span style="top: 381px; position: absolute; left: 257px;"></span>
                <input type="number" name="attr_pc_ac" style="font-size: 24px; border-bottom: 1px solid white;">
            </div>
            <div class="hp1 attributes">
                <h2>HP</h2>
            </div>
            <div class="hp2 attributes">
                <input type="number" name="attr_pc_hp"> <span style="font-size: 24px;">/</span> <input type="number" name="attr_pc_hp_max">
            </div>
            <div class="res1 attributes">
                <h2>Resilience</h2>
            </div>
            <div class="res2 attributes">
                <input type="number" name="attr_pc_res"> <span style="font-size: 24px;">/</span> <input type="number" name="attr_pc_res_max">
            </div>
            <div class="sup1 attributes">
                <h2>Supply</h2>
            </div>
            <div class="sup2 attributes">
                <input type="number" name="attr_pc_sup"> <span style="font-size: 24px;">/</span> <input type="number" name="attr_pc_sup_max">
            </div>
            <div class="arcane1 attributes" style="margin-top: 5px;">
                <button name="roll_arcana" type="roll" value="&{template:ftdroll} {{name=@{character_name}}} {{test_name=Arcane Test}} {{r1=[[1d20+@{pc_arcane}]]}} {{r2=[[1d20+@{pc_arcane}]]}}">
                    <h3 style="width: 80px;">Arcane</h3>
                    <h2><span type="number" name="attr_pc_arcane" title="@{pc_arcane}"></span></h2>
                </button>
            </div>
            <div class="perception1 attributes" style="margin-top: 5px;">
                <button name="roll_perception" type="roll" value="&{template:ftdroll} {{name=@{character_name}}} {{test_name=Perception Test}} {{r1=[[1d20+@{pc_perception}]]}} {{r2=[[1d20+@{pc_perception}]]}}">
                    <h3 style="width: 80px; font-size: 16px;">Perception</h3>
                    <h2><span type="number" name="attr_pc_perception" title="@{pc_perception}"></span></h2>
                </button>
            </div>
            <div class="divine1 attributes" style="margin-top: 5px;">
                <button name="roll_divine" type="roll" value="&{template:ftdroll} {{name=@{character_name}}} {{test_name=Divine Test}} {{r1=[[1d20+@{pc_divine}]]}} {{r2=[[1d20+@{pc_divine}]]}}">
                    <h3 style="width: 80px;">Divine</h3>
                    <h2><span type="number" name="attr_pc_divine" title="@{pc_divine}"></span></h2>
                </button>
            </div>
            <div class="retainer1 attributes">
                <h2>Retainers</h2>
            </div>
            <div class="retainer2 attributes">
                <input type="number" name="attr_pc_ret"> <span style="font-size: 24px;">/</span> <input type="number" name="attr_pc_ret_max">
            </div>
            <div class="magicitem1 attributes">
                <h2>M. Items</h2>
            </div>
            <div class="magicitem2 attributes">
                <input type="number" name="attr_pc_magicitem" style="font-size: 24px; border-bottom: 1px solid white;">
            </div>
            <div class="prof">
                <h2>Proficiencies</h2>
            </div>
            <div class="prof2">
                <h3>Armors</h3>
                <span name="attr_pc_prof_armor"></span>
                <h3>Weapons</h3>
                <span name="attr_pc_prof_weapon"></span>
                <h3>Class</h3>
                <span name="attr_pc_prof_class"></span>
                <h3>Archetype</h3>
                <span name="attr_pc_prof_archetype"></span>
            </div>
    </div>

    <div class="container_pc2 bw">
        <div class="weapon_first">
            <h2>Weapons</h2>
        </div>
        <h3>Name</h3>
        <h3>Prof.</h3>
        <h3>To Hit</h3>
        <h3>Damage</h3>
        <h3>Attribute</h3>
        <h3 class="weapon_second">Description</h3>
        <div class="weapon_grid">
            <fieldset class="repeating_weapon">
                <input type="text" name="attr_pc_weapon_name" placeholder="nom de l'arme" style="width: 140px;">
                <input type="checkbox" name="attr_pc_weapon_prof" style="position: relative; left: 7px; top: auto;" value="@{pc_proficiency}"><span></span>
                <select name="attr_pc_weaponToHitMod" style="width: 90px">
                    <option value="@{pc_strengthMod}">Strength</option>
                    <option value="@{pc_dexterityMod}">Dexterity</option>
                    <option value="@{pc_constitutionMod}">Constitution</option>
                    <option value="@{pc_intelligenceMod}">Intelligence</option>
                    <option value="@{pc_wisdomMod}">Wisdom</option>
                    <option value="@{pc_charismaMod}">Charisma</option>
                </select>
                <input type="text" name="attr_pc_weapon_damage" placeholder="dégâts (ex: 1d8)" style="width: 50px;">
                <select name="attr_pc_weaponMod" style="width: 90px">
                    <option value="@{pc_strengthMod}">Strength</option>
                    <option value="@{pc_dexterityMod}">Dexterity</option>
                    <option value="@{pc_constitutionMod}">Constitution</option>
                    <option value="@{pc_intelligenceMod}">Intelligence</option>
                    <option value="@{pc_wisdomMod}">Wisdom</option>
                    <option value="@{pc_charismaMod}">Charisma</option>
                </select>
                <input type="text" name="attr_pc_weapon_desc" placeholder="description" spellcheck="false" style="width: 300px;">
                <button name="roll_weapon" type="roll" value="&{template:ftddamage} {{name=@{character_name}}} {{test_name=@{pc_weapon_name}}} {{r1=[[1d20+@{pc_weaponToHitMod}+@{pc_weapon_prof}]]}} {{r2=[[1d20+@{pc_weaponToHitMod}+@{pc_weapon_prof}]]}} {{damage_name=Damage}} {{r_damage=[[@{pc_weapon_damage}+@{pc_weaponMod}]]}}">
                    <h3 style="width: 80px;">Attack</h3>
                </button>
            </fieldset>
        </div>
    </div>

    <input type="checkbox" name="attr_pc_spell_ability" value="1" class="spellability">
    <div class="container_pc5 bw">
        <div class="spell_first">
            <h2>Spell book</h2>
        </div>
        <div class="spell_second">
            <h3>Spells known :</h3>
            <span style="font-weight: bold">1st :</span>
            <span type="number" name=attr_pc_spell_1></span>
            <span style="font-weight: bold; margin-left: 20px;">2nd :</span>
            <span type="number" name=attr_pc_spell_2></span>
            <span style="font-weight: bold; margin-left: 20px;">3rd :</span>
            <span type="number" name=attr_pc_spell_3></span>
            <span style="font-weight: bold; margin-left: 20px;">4th :</span>
            <span type="number" name=attr_pc_spell_4></span>
            <span style="font-weight: bold; margin-left: 20px;">5th :</span>
            <span type="number" name=attr_pc_spell_5></span>
        </div>
        <h3>Level</h3>
        <h3>Spell name</h3>
        <h3>Description</h3>
        <div class="spell_grid">
            <fieldset class="repeating_spell">
                <input type="number" name="attr_pc_spell_lvl" style="width: 70px;">
                <input type="text" name="attr_pc_spell_name" placeholder="sort" style="width: 200px;">
                <input type="text" name="attr_pc_spell_desc" placeholder="description" spellcheck="false" style="width: 500px;">
            </fieldset>
        </div>
    </div>

    <div class="container_pc3 bw">
        <div class="inventory_first">
            <h2>Inventory</h2>
        </div>
        <h3>Load</h3>
        <h3>Name</h3>
        <h3>Description</h3>
        <h3>Sup.</h3>
        <h3>Dur.</h3>
        <div class="inventory_grid">
            <fieldset class="repeating_inventory">
                <input type="number" name="attr_pc_item_load" style="width: 70px;">
                <input type="text" name="attr_pc_item_name" placeholder="objet" style="width: 280px;">
                <input type="text" name="attr_pc_item_desc" placeholder="description" spellcheck="false" style="width: 270px;">
                <input type="number" name="attr_pc_item_sup" style="width: 70px;">
                <input type="number" name="attr_pc_item_dur" style="width: 70px;">
            </fieldset>
        </div>
    </div>

    <div class="container_pc4 bw">
        <h2>Notes</h2>
        <div class="sheet-auto-expand notes">
                <span name="attr_pc_notes"></span>
                <textarea name="attr_pc_notes" placeholder="Notes" spellcheck="false"></textarea>
        </div>
    </div>
</div>

<!-- NPC
   ============================= -->

<div class="npc">
    <span class="sheet-footer" style="margin-right: 5px;position: absolute;top: 80px;left: 150px;">B&W Version</span> <input type="checkbox" class="sheet-block-switch" style="position: absolute; top: 90px; left: 220px;"><span style="color: black;position: absolute;top: 76px;left: 210px;"></span>
    <span class="sheet-footer" style="margin-right: 5px;position: absolute;top: 80px;left: 230px;">Grey Version</span> <input type="checkbox" class="sheet-block-switch2" style="position: absolute; top: 90px; left: 300px;"><span style="color: black;position: absolute;top: 76px;left: 290px;"></span>
    <div class="container bw">
        <div class="firstline">
            <h2>Name</h2>
            <input type="text" name="attr_character_name" placeholder="nom" style="height: 75%; margin-right: 3px;">
            <h2>HD</h2>        
            <select name="attr_hd" type="text" style="margin-right: 3px;">
                <option value="1/4">1/4</option>
                <option value="1/2">1/2</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
                <option value="9">9</option>
                <option value="10">10</option>
                <option value="11">11</option>
                <option value="12">12</option>
                <option value="13">13</option>
                <option value="14">14</option>
                <option value="15">15</option>
                <option value="16">16</option>
                <option value="17">17</option>
                <option value="18">18</option>
            </select>
            <select name="attr_npc_type" typex="text">
                <option value="Brute">Brute</option>
                <option value="Meneur">Leader</option>
                <option value="Prédateur">Predator</option>
                <option value="Contrôleur">Shaper</option>
                <option value="Sniper">Sniper</option>
                <option value="Soldat">Soldier</option>
            </select>
        </div>
        <div class="q1">
            <div class="flex">
                <h3>To Hit Bonus</h3>
                <input type="text" name="attr_npc_bonus_atk" value="0">
                <button name="roll_npc_attack" type="roll" value="/w gm &{template:ftdroll} {{name=@{character_name}}} {{test_name=Attack Test}} {{r1=[[1d20+[[@{npc_bonus_atk}]]]]}} {{r2=[[1d20+[[@{npc_bonus_atk}]]]]}}"><h3>Attack</h3></button>
            </div>
            <div class="flex">
                <h3>Damage</h3>
                <input type="text" name="attr_npc_damage" value="0">
                <button name ="roll_npc_damage" type="roll" value="/w gm &{template:ftdroll} {{name=@{character_name}}} {{test_name=Damage}} {{r1=[[@{npc_damage}]]}}"><h3>Damage</h3></button>
            </div>
            <div class="flex">
                <h3>AC</h3>
                <input type="number" name="attr_npc_ac" value="10">
            </div>
            <div class="flex">
                <h3>HP</h3>
                <input type="number" name="attr_npc_hp" value="0">
                <h3>/</h3>
                <input type="hidden" name="attr_npc_hp_max" value="0">
                <span name="attr_npc_hp_max" style="display: block; padding: 4px"></span>
            </div>
            <div class="flex">
                <h3>Base Mod</h3>
                <input type="hidden" name="attr_npc_base_mod" value="0">
                <span name="attr_npc_base_mod" style="display: block; padding: 4px"></span>
                <button name ="roll_npc_base" type="roll" value="/w gm &{template:ftdroll} {{name=@{character_name}}} {{test_name=Test (Standard)}} {{r1=[[1d20+[[@{npc_base_mod}]]]]}} {{r2=[[1d20+[[@{npc_base_mod}]]]]}}"><h3>Test</h3></button>
            </div>
            <div class="flex">
                <h3>Speed</h3>
                <input type="text" name="attr_npc_speed" value="0">
            </div>
        </div>

        <div class="q2">
            <div class="flex">
                <h2>Strong</h2>
            </div>
            <div class="flex">
                <h3>Mod.</h3>
                <input type="hidden" name="attr_npc_strong_mod" value="0">
                <span name="attr_npc_strong_mod" style="display: block; padding: 4px"></span>
                <button name ="roll_npc_strong" type="roll" value="/w gm &{template:ftdroll} {{name=@{character_name}}} {{test_name=Test (Strong)}} {{r1=[[1d20+[[@{npc_strong_mod}]]]]}} {{r2=[[1d20+[[@{npc_strong_mod}]]]]}}"><h3>Test</h3></button>
            </div>
            <div class="flex">
                <input type="text" name="attr_npc_strong_attribute" value="FOR/CON">
            </div>
            <div class="flex sheet-auto-expand">
                <span name="attr_npc_strong_desc"></span>
                <textarea name="attr_npc_strong_desc" placeholder="Strength description" spellcheck="false"></textarea>
            </div>
        </div>

        <div class="q3">
            <div class="flex">
                <h2>Techniques</h2>
            </div>
            <div>
                <fieldset class="repeating_technique">
                    <select name="attr_npc_technique_name" type="text">
                        <option value="Drain de caractéristique">Ability Drain</option>
                        <option value="Adepte">Adept</option>
                        <option value="Altération de l'environnement">Alter Environment</option>
                        <option value="Décharge">Blast</option>
                        <option value="Explosion">Burst</option>
                        <option value="Bonus conditionnel">Extra When</option>
                        <option value="Infliger une condition">Force condition</option>
                        <option value="Multi-attaque">Multi-attack</option>
                        <option value="Résistance ou immunité">Resistance ou immunity</option>
                        <option value="Bouger">Shove</option>
                        <option value="Mouvement spécial">Special Movement</option>
                    </select>
                    <input type="hidden" name="attr_npc_technique_desc" value="Technique description">
                    <span name="attr_npc_technique_desc" style="display: block; padding: 4px"></span>
                    <div class="sheet-auto-expand">
                    <span name="attr_npc_technique_desc2"></span>
                    <textarea name="attr_npc_technique_desc2" placeholder="details" spellcheck="false"></textarea>
                    </div>
                </fieldset>
            </div>
        </div>

        <div class="q4">
            <div class="flex">
                <h2>Weak</h2>
            </div>
            <div class="flex">
                <h3>Mod.</h3>
                <input type="hidden" name="attr_npc_weak_mod" value="0">
                <span name="attr_npc_weak_mod" style="display: block; padding: 4px"></span>
                <button name ="roll_npc_weak" type="roll" value="/w gm &{template:ftdroll} {{name=@{character_name}}} {{test_name=Test (Weak)}} {{r1=[[1d20+[[@{npc_weak_mod}]]]]}} {{r2=[[1d20+[[@{npc_weak_mod}]]]]}}"><h3>Test</h3></button>
            </div>
            <div class="flex">
                <input type="text" name="attr_npc_weak_attribute" value="FOR/CON">
            </div>
            <div class="flex sheet-auto-expand">
                <span name="attr_npc_weak_desc"></span>
                <textarea name="attr_npc_weak_desc" placeholder="Weakness Description" spellcheck="false"></textarea>
            </div>
        </div>
    </div>

    <div class="container2 bw">
            <h2>Notes</h2>
            <div class="sheet-auto-expand notes">
                <span name="attr_notes"></span>
                <textarea name="attr_notes" placeholder="Notes" spellcheck="false"></textarea>
            </div>
    </div>
</div>
<div>
    <span class="footer" style="margin-right: 50px;">Art by Sebastian Rodriguez and Per Folmer.</span>
</div>
<!-- ROLLTEMPLATE
   ============================= -->
<rolltemplate class="sheet-rolltemplate-minisheet">
    <div class="face_container">
        <div class="face_header">
            <h3 style="color: #F8F8FF">{{name}}</h3>
        </div>
        <div class="face_rowcolor1">
            <h3 style="display:inline"><span style="font-family: Pictos">k</span></h3>
            {{value1}} / {{value1_max}}
            <h3 style="display:inline; margin-left: 20px;"><span style="font-family: Pictos Three">b</span></h3>
            {{value2}}
        </div>
        <div class="face_rowcolor1">
            <h3 style="display:inline">{{buttons_name}}</h3>
            <div>{{buttons}}</div>
        </div>
        <div class="face_rowcolor1">
            <h3 style="display:inline">{{buttons2_name}}</h3>
            <div>{{buttons2}}</div>
        </div>
        <div class="face_rowcolor1">
            <h3 style="display:inline">{{buttons3_name}}</h3>
            <div>{{buttons3}}</div>
        </div>
        <div class="face_rowcolor1">
            <h3 style="display:inline">{{buttons4_name}}</h3>
            <div>{{buttons4}}</div>
        </div>
    </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-ftdroll">
    <div class="face_container">
        <div class="face_header">
            <h3 style="color: #F8F8FF">{{name}}</h3>
        </div>
        <div class="face_rowcolor1">
            <h3 style="display:inline">{{test_name}}</h3>
            <div style="margin-bottom: 3px;">{{r1}} | {{r2}}</div>
        </div>
    </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-ftddamage">
    <div class="face_container">
        <div class="face_header">
            <h3 style="color: #F8F8FF">{{name}}</h3>
        </div>
        <div class="face_rowcolor1">
            <h3 style="display:inline">{{test_name}}</h3>
            <div style="margin-bottom: 3px;">{{r1}} | {{r2}}</div>
        </div>
        <div class="face_rowcolor1">
            <h3 style="display:inline">{{damage_name}}</h3>
            <div style="margin-bottom: 3px;">{{r_damage}}</div>
        </div>
    </div>
</rolltemplate>

<!-- SCRIPT
   ============================= -->
<script type="text/worker">
const setAttributes = (update, silent) => { 
    (silent === true) ? setAttrs(update, {silent:true}) : setAttrs(update); 
};
    
// === SHEET SWITCH
// === ATTRIBUTE ARRAYS
    const arrays = {
        sheets: ["pc", "npc"],
        toggles: ["pc", "npc"]
    };

// === SETTINGS TOGGLES
    //Switch between sheet types.
    arrays["sheets"].forEach(attr => {
        on(`clicked:toggle_${attr}`, (eventinfo) => {
            setAttributes({sheet_type: `${attr}`}, true);
        });
    });

// === TOGGLE INPUT SETTINGS
    arrays["toggles"].forEach(attr => {
        on(`clicked:toggle_${attr}`, () => {
            getAttrs(["toggles"], (v) => {
                let string = toggleBuilder(attr, v["toggles"]);
                setAttributes({toggles: string}, true);
            });
        });
    });

// === BUTTON WEAPON ROW ID VALUE
on("change:repeating_weapon sheet:opened", function() {
    getSectionIDs("repeating_weapon", function(idArray) {
 var rollbuttons = {};
        for(var i=0; i < 1; i++) { 
 rollbuttons["weapon_buttons"] =  "[@{repeating_weapon_" + idArray[i] + "_pc_weapon_name}](~repeating_weapon_" + idArray[i] + "_weapon)";
        }
        for(var i=1; i < idArray.length; i++) {
 rollbuttons["weapon_buttons"] =  rollbuttons["weapon_buttons"] + " [@{repeating_weapon_" + idArray[i] + "_pc_weapon_name}](~repeating_weapon_" + idArray[i] + "_weapon)";
        }
 setAttrs(rollbuttons);
    });
});

// === NPC TECHNIQUES ROW ID VALUE
on("change:repeating_technique", function() {
    getSectionIDs("repeating_technique", function(idArray) {
 var text = {};
        for(var i=0; i < 1; i++) {
 text["npc_tec"] =  "**@{repeating_technique_" + idArray[i] + "_npc_technique_name}** @{repeating_technique_" + idArray[i] + "_npc_technique_desc} *@{repeating_technique_" + idArray[i] + "_npc_technique_desc2}*";
        }
        for(var i=1; i < idArray.length; i++) {
 text["npc_tec"] =  text["npc_tec"] + "**@{repeating_technique_" + idArray[i] + "_npc_technique_name}** @{repeating_technique_" + idArray[i] + "_npc_technique_desc} *@{repeating_technique_" + idArray[i] + "_npc_technique_desc2}*";
        }
 setAttrs(text);
    });
});

// === ATTRIBUTES MOD CALC
const stats = ['pc_strength','pc_dexterity','pc_constitution','pc_intelligence','pc_wisdom','pc_charisma'];
stats.forEach(function (stat) {
    on("change:" + stat + " sheet:opened", function () {
        getAttrs([stat], function (values) {
            const score = parseInt(values[stat], 10)||0; // this extracts the stat, and assumes a stat score of 0 the stat is not recognised as a number.
            let mod = 0;
            if(score < 4) mod = -4;
            else mod = Math.floor((score-10)/2);
            setAttrs({
                [stat + 'Mod']: mod
            });
        });
    });
});

// === LVL CALC
on("change:pc_xp sheet:opened", function() {  
    getAttrs(["pc_xp"], function(values) {
        let XP = parseInt(values.pc_xp,10)||0;
        let lvl = 1;
        if (XP >= 2500) lvl = 2;
        if (XP >= 5000) lvl = 3;
        if (XP >= 10000) lvl = 4;
        if (XP >= 20000) lvl = 5;
        if (XP >= 30000) lvl = 6;
        if (XP >= 50000) lvl = 7;
        if (XP >= 75000) lvl = 8;
        if (XP >= 100000) lvl = 9;
        setAttrs({                            
            pc_lvl: lvl
        });
    });
});

// === ARCHETYPE SWITCH
on('change:pc_class sheet:opened', function() {
        getAttrs(['pc_class'], function(values) {
            var idx = 0;
            switch (values.pc_class.toLowerCase()) {
                case 'guerrier':
                    idx = 1;
                    break;
                case 'voleur':
                    idx = 2;
                    break;
                case 'zélote':
                    idx = 3;
                    break;
                case 'mage':
                    idx = 4;
                    break;
            }

            setAttrs({ 'select-chooser': idx });
        });
    });

// === PROFICIENCY MOD CALC
on("change:pc_lvl sheet:opened", function() {  
    getAttrs(["pc_lvl"], function(values) {
        let level = parseInt(values.pc_lvl,10)||0;
        let mod = +2;
        if(level > 4) mod = +3;
        if(level > 8) mod = +4;
        setAttrs({                            
            pc_proficiency: mod
        });
    });
});

// === LOAD CALC
on("change:pc_strength sheet:opened", function() {  
    getAttrs(["pc_strength"], function(values) {
        let l = parseInt(values.pc_strength,10)||0;
        setAttrs({                            
            pc_load_max: l
        });
    });
});

// === SPEED CALC
on("change:pc_load sheet:opened", function() {  
    getAttrs(["pc_load", "pc_load_max"], function(values) {
        let l = parseInt(values.pc_load,10)||0;
        let max = parseInt(values.pc_load_max,10)||0;
        let speed = 30;
        if (l > max) speed = 30 - 5 * (l-max);
        if (speed < 0) speed = 0;
        setAttrs({                            
            pc_speed: speed
        });
    });
});

// === RESILIENCE CALC
on("change:pc_constitution sheet:opened", function() {  
    getAttrs(["pc_constitution"], function(values) {
        let resilience = parseInt(values.pc_constitution,10)||0;
        setAttrs({                            
            pc_res_max: resilience
        });
    });
});

// === SUPPLY CALC
on("change:pc_intelligence sheet:opened", function() {  
    getAttrs(["pc_intelligence"], function(values) {
        let supply = parseInt(values.pc_intelligence,10)||0;
        setAttrs({                            
            pc_sup_max: supply
        });
    });
});

// === Arcane CALC
on("change:pc_intelligenceMod change:pc_proficiency change:pc_class sheet:opened", function() {  
    getAttrs(["pc_intelligenceMod", "pc_proficiency", "pc_class"], function(values) {
        let INT = parseInt(values.pc_intelligenceMod,10)||0;
        let PROF = parseInt(values.pc_proficiency,10)||0;
        let CLAS = values.pc_class;
        let arc = INT;
        if (CLAS === "Mage") arc = INT + PROF;
        setAttrs({                            
            pc_arcane: arc
        });
    });
});

// === Perception CALC
on("change:pc_wisdomMod change:pc_proficiency change:pc_arc sheet:opened", function() {  
    getAttrs(["pc_wisdomMod", "pc_proficiency", "pc_arc"], function(values) {
        let WIS = parseInt(values.pc_wisdomMod,10)||0;
        let PROF = parseInt(values.pc_proficiency,10)||0;
        let ARC = values.pc_arc;
        let per = WIS;
        if (ARC === "Rôdeur") per = WIS + PROF;
        setAttrs({                            
            pc_perception: per
        });
    });
});

// === Divine CALC
on("change:pc_wisdomMod change:pc_proficiency change:pc_class sheet:opened", function() {  
    getAttrs(["pc_wisdomMod", "pc_proficiency", "pc_class"], function(values) {
        let WIS = parseInt(values.pc_wisdomMod,10)||0;
        let PROF = parseInt(values.pc_proficiency,10)||0;
        let CLAS = values.pc_class;
        let div = WIS;
        if (CLAS === "Zélote") div = WIS + PROF;
        setAttrs({                            
            pc_divine: div
        });
    });
});

// === RETAINER CALC
on("change:pc_charisma sheet:opened", function() {  
    getAttrs(["pc_charisma"], function(values) {
        let retainer = parseInt(values.pc_charisma,10)||0;
        setAttrs({                            
            pc_ret_max: retainer
        });
    });
});

// === MAGIC ITEM CALC
on("change:pc_charismaMod sheet:opened", function() {  
    getAttrs(["pc_charismaMod"], function(values) {
        let cha = parseInt(values.pc_charismaMod,10)||0;
        let mi = 1;
        if (cha > 1) mi = cha;
        setAttrs({                            
            pc_magicitem: mi
        });
    });
});

// === AC CALC
on("change:pc_ac_type change:pc_ac_shield change:pc_dexterityMod sheet:opened", function() {  
    getAttrs(["pc_ac_type", "pc_ac_shield", "pc_dexterityMod", "pc_ac"], function(values) {
        let TYPE = parseInt(values.pc_ac_type,10)||0;
        let DEX = parseInt(values.pc_dexterityMod,10)||0;
        let ACcalc = 10;
        if (TYPE > 9) ACcalc = 10 + DEX;
        if (TYPE > 11) ACcalc = 12 + DEX;
        if (TYPE > 14) ACcalc = 15;

        let SHLD = parseInt(values.pc_ac_shield,10)||0;
        let AC = parseInt(values.pc_ac,10)||0;
        let sac = AC
        if (SHLD > 0) sac = ACcalc + 2;
        if (SHLD < 1) sac = ACcalc;
        setAttrs({                            
            "pc_ac": sac,
        });
    });
});

// === PC AUTOFILL ABILITIES PROFICIENCIES
    const abprof = {
        "Guerrier": {STR:"1", DEX:"0", CON:"1", INT:"0", WIS:"0", CHA:"0"},
        "Voleur": {STR:"0", DEX:"1", CON:"0", INT:"1", WIS:"0", CHA:"0"},
        "Zélote": {STR:"0", DEX:"0", CON:"0", INT:"0", WIS:"1", CHA:"1"},
        "Mage": {STR:"0", DEX:"0", CON:"1", INT:"1", WIS:"0", CHA:"0"},
    };

on("change:pc_class", function () {
    getAttrs(["pc_class"], function(values) {
        let classe = values.pc_class
            if (!abprof.hasOwnProperty( classe )) {
           console.log("Error: The item " + classe + " is not found within the race Object.");
           return;
            } 
        setAttrs({
            "pc_strength_prof": abprof[classe].STR,
            "pc_dexterity_prof": abprof[classe].DEX,
            "pc_constitution_prof": abprof[classe].CON,
            "pc_intelligence_prof": abprof[classe].INT,
            "pc_wisdom_prof": abprof[classe].WIS,
            "pc_charisma_prof": abprof[classe].CHA,
        });
    });
});

// === PC AUTOFILL PROFICIENCIES
    const classprof = {
        "Guerrier": {armor:"All", weapon:"All", class:"Coordination, tactics, will"},
        "Voleur": {armor:"Light, shields", weapon:"All", class:"Stealth, deception, senses, tools"},
        "Zélote": {armor:"All", weapon:"Simple", class:"History, insight"},
        "Mage": {armor:"Shields", weapon:"Simple", class:"Finesse, negotiation"},
    };

    const archprof = {
        "": {arc: " "},
        "Barbare": {arc: "Intimidation, endurance, travel"},
        "Combattant": {arc: "Medicine, engineering, diplomacy"},
        "Rôdeur": {arc: "Wilderness, creatures, perception"},
        "Assassin": {arc: "Intimidation, insight, tracking"},
        "Barde": {arc: "Perform, inspire, diplomacy"},
        "Gredin": {arc: "Infiltration, athletics, investigation"},
        "Prêtre": {arc: "Healing, politics, divine magic"},
        "Druide": {arc: "Wilderness, creatures, druidic magic"},
        "Paladin": {arc: "Instinct, endurance, athletics"},
        "Ensorceleur": {arc: "Charm, willpower, chaos magic"},
        "Sorcier": {arc: "Intimidate, stealth, profane magic"},
        "Magicien": {arc: "Diplomacy, insight, arcane magic"},
    };

on("change:pc_class sheet:opened", function () {
    getAttrs(["pc_class"], function(values) {
        let classe = values.pc_class
            if (!classprof.hasOwnProperty( classe )) {
           console.log("Error: The item " + classe + " is not found within the race Object.");
           return;
            };
        setAttrs({
            "pc_prof_armor": classprof[classe].armor,
            "pc_prof_weapon": classprof[classe].weapon,
            "pc_prof_class": classprof[classe].class,
        });
    });
});

on("change:pc_arch change:select-chooser sheet:opened", function () {
    getAttrs(["pc_arch"], function(values) {
        let arch = values.pc_arch;
            if (!archprof.hasOwnProperty( arch )) {
           console.log("Error: The item " + arch + " is not found within the race Object.");
           return;
            }
        setAttrs({
            "pc_prof_archetype": archprof[arch].arc,
        });
    });
});

// === PC AUTOFILL SPELL SLOTS
    const spelltable = {
        "1": {first: "1", second: "0", third: "0", fourth: "0", fifth: "0"},
        "2": {first: "2", second: "0", third: "0", fourth: "0", fifth: "0"},
        "3": {first: "3", second: "1", third: "0", fourth: "0", fifth: "0"},
        "4": {first: "4", second: "2", third: "0", fourth: "0", fifth: "0"},
        "5": {first: "5", second: "3", third: "1", fourth: "0", fifth: "0"},
        "6": {first: "5", second: "4", third: "2", fourth: "0", fifth: "0"},
        "7": {first: "5", second: "5", third: "3", fourth: "1", fifth: "0"},
        "8": {first: "5", second: "5", third: "4", fourth: "2", fifth: "0"},
        "9": {first: "5", second: "5", third: "5", fourth: "3", fifth: "1"},
    };

on("change:pc_lvl sheet:opened", function() {  
    getAttrs(["pc_lvl"], function(values) {
        let LVL = values.pc_lvl;
        if (!spelltable.hasOwnProperty( LVL )) {
           console.log("Error: The item " + LVL + " is not found within the race Object.");
           return;
            } 
        setAttrs({                            
            "pc_spell_1": spelltable[LVL].first,
            "pc_spell_2": spelltable[LVL].second,
            "pc_spell_3": spelltable[LVL].third,
            "pc_spell_4": spelltable[LVL].fourth,
            "pc_spell_5": spelltable[LVL].fifth,
        });
    });
});

on("change:pc_class sheet:opened", function() {  
    getAttrs(["pc_class"], function(values) {
        let CLAS = values.pc_class;
        let m = 0;
        if (CLAS === "Mage") m = 1;
        if (CLAS === "Zélote") m = 1;
        setAttrs({                            
            pc_spell_ability: m
        });
    });
});

// === NPC CALC
    const math = {
        "1/4": {damage: "1d4", hp: "1", base: "+2", strong: "+2", weak: "-2"},
        "1/2": {damage: "1d6", hp: "2", base: "+2", strong: "+2", weak: "-2"},
        "1": {damage: "1d8", hp: "5", base: "+2", strong: "+3", weak: "-2"},
        "2": {damage: "1d10", hp: "9", base: "+3", strong: "+4", weak: "-1"},
        "3": {damage: "1d12", hp: "13", base: "+3", strong: "+5", weak: "-1"},
        "4": {damage: "2d6", hp: "17", base: "+4", strong: "+6", weak: "+0"},
        "5": {damage: "2d8", hp: "21", base: "+4", strong: "+7", weak: "+0"},
        "6": {damage: "2d10", hp: "25", base: "+5", strong: "+8", weak: "+1"},
        "7": {damage: "2d12", hp: "29", base: "+5", strong: "+9", weak: "+1"},
        "8": {damage: "3d8", hp: "33", base: "+6", strong: "+10", weak: "+2"},
        "9": {damage: "3d8+1", hp: "37", base: "+6", strong: "+11", weak: "+2"},
        "10": {damage: "3d8+2", hp: "41", base: "+7", strong: "+12", weak: "+3"},
        "11": {damage: "3d10", hp: "45", base: "+7", strong: "+12", weak: "+3"},
        "12": {damage: "3d10+1", hp: "49", base: "+8", strong: "+12", weak: "+4"},
        "13": {damage: "3d10+2", hp: "53", base: "+8", strong: "+12", weak: "+4"},
        "14": {damage: "3d12", hp: "57", base: "+9", strong: "+12", weak: "+5"},
        "15": {damage: "3d12+1", hp: "61", base: "+9", strong: "+12", weak: "+5"},
        "16": {damage: "3d12+2", hp: "65", base: "+10", strong: "+12", weak: "+6"},
        "17": {damage: "4d10", hp: "69", base: "+10", strong: "+12", weak: "+6"},
        "18": {damage: "4d10+1", hp: "73", base: "+10", strong: "+12", weak: "+7"},

    };

    const categorie = {
        "Brute": {strong: "STR/CON", strongdesc: "morale, holding the line, resistance", weak: "INT/DEX", weakdesc: "stealth, finesse, perception, tactics"},
        "Meneur": {strong: "INT/CHA", strongdesc: "magic, commands, with minions", weak: "STR/CON", weakdesc: "combat, being alone, resistance"},
        "Prédateur": {strong: "INT", strongdesc: "offensive, stealth, patience, cunning", weak: "CON", weakdesc: "resistance, morale, direct combat"},
        "Contrôleur": {strong: "WIS/INT", strongdesc: "forced movement, changing the environment", weak: "-", weakdesc: "melee combat, being locked down in one place"},
        "Sniper": {strong: "DEX/WIS", strongdesc: "ranged combat, perception", weak: "CON/STR", weakdesc: "melee, resistance, morale"},
        "Soldat": {strong: "STR/DEX", strongdesc: "combat, morale, unit discipline", weak: "-", weakdesc: "magic, speed, lack of leadership, stealth"},
    };  

    const tech = {
        "Drain de caractéristique": {desc: "Successful attacks temporarily (or permanently at HD 5+) reduce a hit PC’s ability by 1d6. Pick one ability to target"},
        "Adepte": {desc: "Pick up to two spells from the Arcane or Divine spellcaster list. The sum of these spell’s levels can’t exceed the monster’s HD. The spells can be cast once per encounter at will"},
        "Altération de l'environnement": {desc: "Area: Spread, 30’ / HD The monster can introduce new physical hazards or reshape the battlefield in some way. The GM selects one style of alteration: stone, plants, weather, mechanical, sensory, or magical"},
        "Décharge": {desc: "Area: Cone, 10’ / 2HD Damage: 1d6 / 2HD Check: PCs check to resist or dodge Notes: usually elemental or magic. 1 use per fight per 3 HD"},
        "Explosion": {desc: "Area: Sphere, 5’ / HD Damage: 1d6 / HD Check: PCs check to resist or dodge Notes: usually elemental or magic. 1 use per fight per 3 HD"},
        "Bonus conditionnel": {desc: "Gain a bonus of some kind when criteria are met (more damage when in a forest, extra AC when in darkness, etc)"},
        "Infliger une condition": {desc: "Successful attacks force a negative condition on their PC target: blind, deafened, paralyzed, stunned, charmed, etc. Pick one"},
        "Multi-attaque": {desc: "1 extra attack per 3 HD (6HD would have 3 attacks, 1 + 2 extra)"},
        "Résistance ou immunité": {desc: "Gain either 1/2 damage or immunity to certain weapons or damage types (fire, slashing, non-magical, non-silver, etc)"},
        "Bouger": {desc: "Target: 1 PC / 2 HD Check: Monster checks to hit each target. Each hit PC suffers forced movement up to 10’ per 5 HD"},
        "Mouvement spécial": {desc: "Gain a unique movement type or speed in certain circumstances: flying, burrowing, ethereal, underwater, leap, teleport, extreme speed, wallclimb, ignore harsh terrain in certain environments"},
    };

on("change:hd", function () {
    getAttrs(["hd"], function(values) {
        let valeur = values.hd
            if (!math.hasOwnProperty( valeur )) {
           console.log("Error: The item " + valeur + " is not found within the race Object.");
           return;
            } 
        setAttrs({
            "npc_bonus_atk": math[valeur].strong,
            "npc_damage": math[valeur].damage,
            "npc_hp_max": math[valeur].hp,
            "npc_base_mod": math[valeur].base,
            "npc_strong_mod": math[valeur].strong,
            "npc_weak_mod": math[valeur].weak
        });
    });
});

on("change:npc_type", function () {
    getAttrs(["npc_type"], function(values) {
        let role = values.npc_type
            if (!categorie.hasOwnProperty( role )) {
           console.log("Error: The item " + role + " is not found within the race Object.");
           return;
            } 
        setAttrs({
            "npc_strong_attribute": categorie[role].strong,
            "npc_strong_desc": categorie[role].strongdesc,
            "npc_weak_attribute": categorie[role].weak,
            "npc_weak_desc": categorie[role].weakdesc,
        });
    });
});

on("change:repeating_technique", function () {
    getAttrs(["repeating_technique_npc_technique_name"], function(values) {
        let x = values.repeating_technique_npc_technique_name
            if (!tech.hasOwnProperty( x )) {
           console.log("Error: The item " + x + " is not found within the race Object.");
           return;
            } 
        setAttrs({
            "repeating_technique_npc_technique_desc": tech[x].desc,
        });
    });
});

// === ITEMS LOAD CALC
const repeatingSum = (destination, section, fields, multiplier = 1) => {
    if (!Array.isArray(fields)) fields = [fields];
    getSectionIDs(`repeating_${section}`, idArray => {
        const attrArray = idArray.reduce( (m,id) => [...m, ...(fields.map(field => `repeating_${section}_${id}_${field}`))],[]);
        getAttrs(attrArray, v => {
            console.log("===== values of v: "+ JSON.stringify(v) +" =====");
                 // getValue: if not a number, returns 1 if it is 'on' (checkbox), otherwise returns 0..
            const getValue = (section, id,field) => parseFloat(v[`repeating_${section}_${id}_${field}`]) || (v[`repeating_${section}_${id}_${field}`] === 'on' ? 1 : 0); 
            const sumTotal = idArray.reduce((total, id) => total + fields.reduce((subtotal,field) => subtotal * getValue(section, id,field),1),0);
            setAttrs({[destination]: sumTotal * multiplier});    
        });
    });
};

on('change:repeating_inventory remove:repeating_inventory', function() {
    repeatingSum("pc_load","inventory","pc_item_load");
});
</script>